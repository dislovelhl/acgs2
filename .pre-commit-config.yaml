# ACGS-2 Pre-commit Configuration
# Quality gates for code commits

repos:
  # Ruff linting and formatting
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.7.1
    hooks:
      - id: ruff
      # Print statement detection (T201) - blocks print() in production Python code
      # Excludes: tests (debugging output), demos (user-facing CLI), CLI validators
      - id: ruff
        name: ruff-no-print
        args:
          - --select=T201
          - --per-file-ignores=**/tests/**:T201,**/test_*.py:T201,**/*_test.py:T201,**/demo*.py:T201,**/config_validator.py:T201
# MyPy is disabled in pre-commit due to directory naming conflicts
# Run mypy manually: cd acgs2-core/enhanced_agent_bus && mypy --strict --ignore-missing-imports .
# - repo: https://github.com/pre-commit/mirrors-mypy
#   rev: v1.13.0
#   hooks:
#     [
#       {
#         id: mypy,
#         additional_dependencies:
#           [types-redis, types-requests, types-setuptools],
#       },
#     ]
  # Python type checking (simplified) - set to manual due to package naming
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.14.1
    hooks:
      - id: mypy
        args: [--ignore-missing-imports, --namespace-packages, --explicit-package-bases]
        stages: [manual]  # Run manually: pre-commit run mypy --hook-stage manual

  # ACGS-2 Custom Quality Gates
  - repo: local
    hooks:
      - id: acgs2-quality-gate
        name: ACGS-2 Quality Gate
        entry: bash -c "cd acgs2-core && ../scripts/quality_gate.sh"
        language: system
        pass_filenames: false
        files: ^(acgs2-core/.*\.(py|yaml|yml)|scripts/.*)$
        exclude: ^acgs2-core/.*(__pycache__|venv|\.venv|node_modules)/.*

  # Performance Regression Check
  - repo: local
    hooks:
      - id: performance-regression-check
        name: Performance Regression Check
        entry: bash -c "./scripts/performance_regression_test.sh"
        language: system
        pass_filenames: false
        files: ^(acgs2-core/.*\.py)$
        stages: [manual]  # Only run manually or in CI

  # Test File Optimization Check
  - repo: local
    hooks:
      - id: test-file-optimization
        name: Test File Optimization Check
        entry: python scripts/optimize_test_files.py
        language: system
        pass_filenames: false
        files: ^acgs2-core/.*test.*\.py$
        stages: [manual]  # Only run when optimizing tests

  # Security scanning
  - repo: https://github.com/PyCQA/bandit
    rev: 1.8.0
    hooks:
      - id: bandit
        args: [-c, pyproject.toml]
        exclude: ^(acgs2-core|sdk)/.*(tests?|__pycache__|venv)/.*

  # Commit message validation
  - repo: https://github.com/compilerla/conventional-pre-commit
    rev: v3.6.0
    hooks:
      - id: conventional-pre-commit
        stages: [commit-msg]
        args: [] # allows default angular types

  # YAML validation
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v5.0.0
    hooks:
      - id: check-yaml
        exclude: ^.*/helm/.*/templates/.*\.yaml$  # Helm templates use Go templating
      - id: check-json
      - id: check-merge-conflict
      - id: check-added-large-files
      - id: check-case-conflict
      - id: check-executables-have-shebangs
      - id: check-shebang-scripts-are-executable
      - id: requirements-txt-fixer

# CI-specific configuration
ci:
  autofix_commit_msg: "ðŸ”§ [pre-commit.ci] auto fixes from pre-commit hooks"
  autofix_prs: true
  autoupdate_branch: ''
  autoupdate_commit_msg: 'ðŸ”„ [pre-commit.ci] pre-commit autoupdate'
  autoupdate_schedule: weekly
  skip: []
  submodules: false
