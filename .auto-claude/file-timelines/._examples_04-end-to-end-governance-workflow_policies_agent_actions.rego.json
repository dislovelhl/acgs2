{
  "file_path": "./examples/04-end-to-end-governance-workflow/policies/agent_actions.rego",
  "main_branch_history": [],
  "task_views": {
    "061-create-end-to-end-governance-workflow-examples-wit": {
      "task_id": "061-create-end-to-end-governance-workflow-examples-wit",
      "branch_point": {
        "commit_hash": "fc6e42927298263034acf989773f3200e422ad17",
        "content": "# Constitutional Hash: cdd01ef066bc6cf2\n# ACGS-2 Example 04: End-to-End Governance Workflow\n# Agent Actions Policy - Evaluates actions and calculates risk scores\n\npackage acgs2.agent_actions\n\nimport rego.v1\n\n# =============================================================================\n# ACTION RISK SCORING\n# =============================================================================\n\n# Base risk scores for each action type (0.0 to 1.0)\naction_risk_scores := {\n\t\"read_data\": 0.2,\n\t\"write_data\": 0.5,\n\t\"modify_config\": 0.6,\n\t\"deploy_model\": 0.7,\n\t\"delete_resource\": 0.9,\n\t\"access_pii\": 0.8,\n\t\"execute_code\": 0.85,\n}\n\n# Environment multipliers adjust risk based on environment\nenvironment_multipliers := {\n\t\"development\": 0.5,\n\t\"staging\": 0.75,\n\t\"production\": 1.0,\n}\n\n# =============================================================================\n# RISK CALCULATION\n# =============================================================================\n\n# Get base risk for the action type\nbase_risk := risk if {\n\taction_type := input.action.type\n\trisk := action_risk_scores[action_type]\n}\n\n# Default to high risk if action type unknown\nbase_risk := 0.8 if {\n\taction_type := input.action.type\n\tnot action_risk_scores[action_type]\n}\n\n# Get environment multiplier\nenv_multiplier := multiplier if {\n\tenvironment := input.context.environment\n\tmultiplier := environment_multipliers[environment]\n}\n\n# Default to production multiplier if environment unknown\nenv_multiplier := 1.0 if {\n\tenvironment := input.context.environment\n\tnot environment_multipliers[environment]\n}\n\n# Calculate resource sensitivity modifier\nresource_modifier := modifier if {\n\t# Higher sensitivity for PII, customer data, or production databases\n\tcontains(lower(input.action.resource), \"pii\")\n\tmodifier := 1.2\n} else := modifier if {\n\tcontains(lower(input.action.resource), \"customer\")\n\tmodifier := 1.15\n} else := modifier if {\n\tcontains(lower(input.action.resource), \"database\")\n\tinput.context.environment == \"production\"\n\tmodifier := 1.1\n} else := 1.0\n\n# Final risk score calculation (capped at 1.0)\nrisk_score := score if {\n\traw_score := base_risk * env_multiplier * resource_modifier\n\tscore := min([1.0, raw_score])\n}\n\n# =============================================================================\n# RISK CATEGORIZATION\n# =============================================================================\n\n# Categorize risk level based on score\ncategory := \"low\" if {\n\trisk_score <= 0.3\n}\n\ncategory := \"medium\" if {\n\trisk_score > 0.3\n\trisk_score <= 0.7\n}\n\ncategory := \"high\" if {\n\trisk_score > 0.7\n\trisk_score <= 0.9\n}\n\ncategory := \"critical\" if {\n\trisk_score > 0.9\n}\n\n# =============================================================================\n# ACTION EVALUATION RULES\n# =============================================================================\n\n# Default deny - actions must be explicitly allowed\ndefault allowed := false\n\n# Read data actions - allowed with basic checks\nallowed if {\n\tinput.action.type == \"read_data\"\n\tresource_accessible\n}\n\n# Resource is accessible if it's not explicitly restricted\nresource_accessible if {\n\tnot resource_restricted\n}\n\n# Restricted resources require additional authorization\nresource_restricted if {\n\tcontains(lower(input.action.resource), \"pii\")\n}\n\nresource_restricted if {\n\tcontains(lower(input.action.resource), \"secret\")\n}\n\nresource_restricted if {\n\tcontains(lower(input.action.resource), \"credential\")\n}\n\n# Write data actions - allowed with validation\nallowed if {\n\tinput.action.type == \"write_data\"\n\tvalid_write_operation\n}\n\nvalid_write_operation if {\n\t# Must have a stated purpose\n\tinput.action.parameters.purpose\n\t# Size must be reasonable (if specified)\n\tsize_reasonable\n}\n\nsize_reasonable if {\n\t# If size not specified, assume reasonable\n\tnot input.action.parameters.size_bytes\n}\n\nsize_reasonable if {\n\t# If specified, must be under 100MB\n\tsize := input.action.parameters.size_bytes\n\tsize <= 104857600\n}\n\n# Modify configuration - requires change ticket\nallowed if {\n\tinput.action.type == \"modify_config\"\n\tconfig_change_authorized\n}\n\nconfig_change_authorized if {\n\t# Must have change ticket\n\tinput.action.parameters.change_ticket\n\t# Change type must be specified\n\tinput.action.parameters.change_type\n}\n\n# Deploy model - requires validation and documentation\nallowed if {\n\tinput.action.type == \"deploy_model\"\n\tmodel_deployment_authorized\n}\n\nmodel_deployment_authorized if {\n\t# Model must be validated\n\tmodel_validated\n\t# Documentation must be complete\n\tdocumentation_complete\n}\n\nmodel_validated if {\n\tinput.action.parameters.bias_tested == true\n\tinput.action.parameters.version\n}\n\ndocumentation_complete if {\n\tinput.action.parameters.documentation_complete == true\n}\n\n# PII access - requires valid purpose and legal basis\nallowed if {\n\tinput.action.type == \"access_pii\"\n\tpii_access_authorized\n}\n\npii_access_authorized if {\n\t# Must have valid purpose\n\tinput.action.parameters.purpose\n\t# Must have legal basis\n\tinput.action.parameters.legal_basis\n\t# Purpose must be valid (checked in constitutional.rego)\n\tinput.action.parameters.purpose != \"training\"\n}\n\n# Delete resource - requires strong justification\nallowed if {\n\tinput.action.type == \"delete_resource\"\n\tdeletion_authorized\n}\n\ndeletion_authorized if {\n\t# Must have change ticket\n\tinput.action.parameters.change_ticket\n\t# Must have reason\n\tinput.action.parameters.reason\n\t# Reason must not be empty\n\tinput.action.parameters.reason != \"\"\n}\n\n# Execute code - highly restricted\nallowed if {\n\tinput.action.type == \"execute_code\"\n\tcode_execution_authorized\n}\n\ncode_execution_authorized if {\n\t# Must have strong justification\n\tinput.action.parameters.justification\n\tinput.action.parameters.justification != \"\"\n\t# Code must be provided for review\n\tinput.action.parameters.code\n\t# Must not be in production without approval context\n\tcode_execution_safe\n}\n\ncode_execution_safe if {\n\t# Safe if not in production\n\tinput.context.environment != \"production\"\n}\n\ncode_execution_safe if {\n\t# Safe in production only with emergency justification\n\tinput.context.environment == \"production\"\n\tinput.action.parameters.justification == \"emergency_patch\"\n}\n\n# =============================================================================\n# DENIAL REASONS\n# =============================================================================\n\n# Unknown action type\ndenial_reasons contains msg if {\n\taction_type := input.action.type\n\tnot action_risk_scores[action_type]\n\tmsg := sprintf(\"Unknown action type: %s (treating as high risk)\", [action_type])\n}\n\n# Read data denials\ndenial_reasons contains msg if {\n\tinput.action.type == \"read_data\"\n\tnot allowed\n\tresource_restricted\n\tmsg := sprintf(\"Access denied: resource '%s' is restricted and requires additional authorization\", [input.action.resource])\n}\n\n# Write data denials\ndenial_reasons contains msg if {\n\tinput.action.type == \"write_data\"\n\tnot allowed\n\tnot input.action.parameters.purpose\n\tmsg := \"Write operation requires a stated purpose\"\n}\n\ndenial_reasons contains msg if {\n\tinput.action.type == \"write_data\"\n\tnot allowed\n\tinput.action.parameters.size_bytes\n\tinput.action.parameters.size_bytes > 104857600\n\tmsg := sprintf(\"Write operation size exceeds limit: %d bytes (max: 100MB)\", [input.action.parameters.size_bytes])\n}\n\n# Modify config denials\ndenial_reasons contains msg if {\n\tinput.action.type == \"modify_config\"\n\tnot allowed\n\tnot input.action.parameters.change_ticket\n\tmsg := \"Configuration changes require a change ticket\"\n}\n\ndenial_reasons contains msg if {\n\tinput.action.type == \"modify_config\"\n\tnot allowed\n\tnot input.action.parameters.change_type\n\tmsg := \"Configuration changes require a specified change type\"\n}\n\n# Deploy model denials\ndenial_reasons contains msg if {\n\tinput.action.type == \"deploy_model\"\n\tnot allowed\n\tnot input.action.parameters.bias_tested\n\tmsg := \"Model deployment requires bias testing\"\n}\n\ndenial_reasons contains msg if {\n\tinput.action.type == \"deploy_model\"\n\tnot allowed\n\tinput.action.parameters.bias_tested == false\n\tmsg := \"Model has not passed bias testing\"\n}\n\ndenial_reasons contains msg if {\n\tinput.action.type == \"deploy_model\"\n\tnot allowed\n\tnot input.action.parameters.version\n\tmsg := \"Model deployment requires version specification\"\n}\n\ndenial_reasons contains msg if {\n\tinput.action.type == \"deploy_model\"\n\tnot allowed\n\tnot input.action.parameters.documentation_complete\n\tmsg := \"Model deployment requires complete documentation\"\n}\n\ndenial_reasons contains msg if {\n\tinput.action.type == \"deploy_model\"\n\tnot allowed\n\tinput.action.parameters.documentation_complete == false\n\tmsg := \"Model documentation is incomplete\"\n}\n\n# PII access denials\ndenial_reasons contains msg if {\n\tinput.action.type == \"access_pii\"\n\tnot allowed\n\tnot input.action.parameters.purpose\n\tmsg := \"PII access requires a stated purpose\"\n}\n\ndenial_reasons contains msg if {\n\tinput.action.type == \"access_pii\"\n\tnot allowed\n\tnot input.action.parameters.legal_basis\n\tmsg := \"PII access requires a legal basis\"\n}\n\ndenial_reasons contains msg if {\n\tinput.action.type == \"access_pii\"\n\tnot allowed\n\tinput.action.parameters.purpose == \"training\"\n\tmsg := \"PII access for training purposes is not permitted (constitutional violation)\"\n}\n\n# Delete resource denials\ndenial_reasons contains msg if {\n\tinput.action.type == \"delete_resource\"\n\tnot allowed\n\tnot input.action.parameters.change_ticket\n\tmsg := \"Resource deletion requires a change ticket\"\n}\n\ndenial_reasons contains msg if {\n\tinput.action.type == \"delete_resource\"\n\tnot allowed\n\tnot input.action.parameters.reason\n\tmsg := \"Resource deletion requires a stated reason\"\n}\n\ndenial_reasons contains msg if {\n\tinput.action.type == \"delete_resource\"\n\tnot allowed\n\tinput.action.parameters.reason == \"\"\n\tmsg := \"Resource deletion reason cannot be empty\"\n}\n\n# Execute code denials\ndenial_reasons contains msg if {\n\tinput.action.type == \"execute_code\"\n\tnot allowed\n\tnot input.action.parameters.justification\n\tmsg := \"Code execution requires justification\"\n}\n\ndenial_reasons contains msg if {\n\tinput.action.type == \"execute_code\"\n\tnot allowed\n\tinput.action.parameters.justification == \"\"\n\tmsg := \"Code execution justification cannot be empty\"\n}\n\ndenial_reasons contains msg if {\n\tinput.action.type == \"execute_code\"\n\tnot allowed\n\tnot input.action.parameters.code\n\tmsg := \"Code execution requires code to be provided for review\"\n}\n\ndenial_reasons contains msg if {\n\tinput.action.type == \"execute_code\"\n\tnot allowed\n\tinput.context.environment == \"production\"\n\tinput.action.parameters.justification != \"emergency_patch\"\n\tmsg := \"Code execution in production requires emergency justification\"\n}\n\n# =============================================================================\n# OUTPUT STRUCTURE\n# =============================================================================\n\n# Risk factors for transparency\nfactors := {\n\t\"action_type_risk\": base_risk,\n\t\"environment_multiplier\": env_multiplier,\n\t\"resource_sensitivity\": resource_modifier,\n\t\"final_risk_score\": risk_score,\n}\n\n# Complete evaluation result\nresult := {\n\t\"allowed\": allowed,\n\t\"risk_score\": risk_score,\n\t\"category\": category,\n\t\"factors\": factors,\n\t\"denial_reasons\": denial_reasons,\n\t\"action_type\": input.action.type,\n\t\"environment\": input.context.environment,\n\t\"evaluated_at\": time.now_ns(),\n}\n",
        "timestamp": "2026-01-04T05:35:49.744738"
      },
      "worktree_state": null,
      "task_intent": {
        "title": "061-create-end-to-end-governance-workflow-examples-wit",
        "description": "Create comprehensive examples demonstrating complete governance workflows from policy creation through enforcement to audit logging, targeting Enterprise DevOps/MLOps engineers deploying AI systems. The examples will show: defining constitutional policies, enforcing them on agent actions, handling HITL approvals, and auditing decisions.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-03T19:36:07.439790",
  "last_updated": "2026-01-04T05:35:49.784872"
}