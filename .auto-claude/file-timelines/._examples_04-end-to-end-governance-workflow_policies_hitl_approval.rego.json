{
  "file_path": "./examples/04-end-to-end-governance-workflow/policies/hitl_approval.rego",
  "main_branch_history": [],
  "task_views": {
    "061-create-end-to-end-governance-workflow-examples-wit": {
      "task_id": "061-create-end-to-end-governance-workflow-examples-wit",
      "branch_point": {
        "commit_hash": "fc6e42927298263034acf989773f3200e422ad17",
        "content": "# Constitutional Hash: cdd01ef066bc6cf2\n# ACGS-2 Example 04: End-to-End Governance Workflow\n# HITL Approval Policy - Determines when human approval is required\n\npackage acgs2.hitl\n\nimport rego.v1\n\n# =============================================================================\n# HITL THRESHOLDS\n# =============================================================================\n\n# Risk threshold above which HITL approval is required\n# Actions with risk_score >= 0.7 will require human review\nrisk_threshold := 0.7\n\n# =============================================================================\n# MAIN DECISION RULES\n# =============================================================================\n\n# Default deny - HITL not required unless explicitly triggered\ndefault hitl_required := false\n\n# HITL required if risk score exceeds threshold\nhitl_required if {\n\tinput.risk_score >= risk_threshold\n}\n\n# HITL required for specific action types (always-require approval)\nhitl_required if {\n\talways_require_approval\n}\n\n# =============================================================================\n# ALWAYS-REQUIRE APPROVAL RULES\n# =============================================================================\n\n# Deploy model to production always requires approval\nalways_require_approval if {\n\tinput.action.type == \"deploy_model\"\n\tinput.context.environment == \"production\"\n}\n\n# Deleting resources always requires approval (high risk of data loss)\nalways_require_approval if {\n\tinput.action.type == \"delete_resource\"\n}\n\n# Accessing PII always requires approval (privacy compliance)\nalways_require_approval if {\n\tinput.action.type == \"access_pii\"\n}\n\n# Executing code in any environment requires approval (security risk)\nalways_require_approval if {\n\tinput.action.type == \"execute_code\"\n}\n\n# =============================================================================\n# REVIEWER ASSIGNMENT - REQUIRED EXPERTISE\n# =============================================================================\n\n# Determine required reviewer expertise based on action type\n# Default to senior_devops if no specific expertise required\ndefault required_expertise := \"senior_devops\"\n\n# ML Safety Specialist for model deployments\nrequired_expertise := \"ml_safety_specialist\" if {\n\tinput.action.type == \"deploy_model\"\n}\n\n# Data Protection Officer for PII access\nrequired_expertise := \"data_protection_officer\" if {\n\tinput.action.type == \"access_pii\"\n}\n\n# Security Lead for configuration changes\nrequired_expertise := \"security_lead\" if {\n\tinput.action.type == \"modify_config\"\n}\n\n# Security Lead for code execution\nrequired_expertise := \"security_lead\" if {\n\tinput.action.type == \"execute_code\"\n}\n\n# Senior DevOps for resource deletion\nrequired_expertise := \"senior_devops\" if {\n\tinput.action.type == \"delete_resource\"\n}\n\n# =============================================================================\n# TIMEOUT CONFIGURATION\n# =============================================================================\n\n# Timeout duration based on risk level\n# Higher risk actions get more time for thorough review\n\n# 2 hours (7200 seconds) for medium-high risk (0.7-0.8)\ntimeout_seconds := 7200 if {\n\tinput.risk_score >= risk_threshold\n\tinput.risk_score < 0.8\n}\n\n# 4 hours (14400 seconds) for high-critical risk (0.8+)\ntimeout_seconds := 14400 if {\n\tinput.risk_score >= 0.8\n}\n\n# Default 2 hours if risk score not available but HITL required\ntimeout_seconds := 7200 if {\n\thitl_required\n\tnot input.risk_score\n}\n\n# =============================================================================\n# ESCALATION RULES\n# =============================================================================\n\n# Determine escalation target for high-risk or timeout scenarios\n# Returns null if no escalation needed\n\ndefault escalation_to := null\n\n# Escalate critical risk actions to security director\nescalation_to := \"security_director\" if {\n\tinput.risk_score >= 0.9\n}\n\n# Escalate high-risk PII access to compliance officer\nescalation_to := \"compliance_officer\" if {\n\tinput.action.type == \"access_pii\"\n\tinput.risk_score >= 0.8\n}\n\n# Escalate production model deployments with high risk\nescalation_to := \"ml_director\" if {\n\tinput.action.type == \"deploy_model\"\n\tinput.context.environment == \"production\"\n\tinput.risk_score >= 0.85\n}\n\n# Escalate production deletions with critical risk\nescalation_to := \"cto\" if {\n\tinput.action.type == \"delete_resource\"\n\tinput.context.environment == \"production\"\n\tinput.risk_score >= 0.95\n}\n\n# =============================================================================\n# RATIONALE GENERATION\n# =============================================================================\n\n# Generate human-readable rationale for why HITL is required\n\n# Risk-based rationale\nrationale := msg if {\n\thitl_required\n\tinput.risk_score >= risk_threshold\n\tnot always_require_approval\n\tmsg := sprintf(\"Risk score %.2f exceeds threshold %.2f, requiring human review\", [input.risk_score, risk_threshold])\n}\n\n# Action-based rationale: Production model deployment\nrationale := msg if {\n\talways_require_approval\n\tinput.action.type == \"deploy_model\"\n\tinput.context.environment == \"production\"\n\tmsg := \"Production model deployments always require human approval for safety validation\"\n}\n\n# Action-based rationale: Resource deletion\nrationale := msg if {\n\talways_require_approval\n\tinput.action.type == \"delete_resource\"\n\tmsg := \"Resource deletion operations always require human approval to prevent data loss\"\n}\n\n# Action-based rationale: PII access\nrationale := msg if {\n\talways_require_approval\n\tinput.action.type == \"access_pii\"\n\tmsg := \"PII access always requires human approval for privacy compliance (GDPR, HIPAA)\"\n}\n\n# Action-based rationale: Code execution\nrationale := msg if {\n\talways_require_approval\n\tinput.action.type == \"execute_code\"\n\tmsg := \"Code execution always requires human approval for security validation\"\n}\n\n# Combined rationale: Both risk and action type\nrationale := msg if {\n\thitl_required\n\talways_require_approval\n\tinput.risk_score >= risk_threshold\n\tmsg := sprintf(\"%s action with risk score %.2f requires mandatory human review\", [input.action.type, input.risk_score])\n}\n\n# Default rationale if none of the above match\nrationale := \"Human approval required based on governance policy\" if {\n\thitl_required\n\tnot input.risk_score\n}\n\n# =============================================================================\n# APPROVAL PRIORITY\n# =============================================================================\n\n# Determine priority level for approval queue\n# Higher priority = faster review required\n\ndefault priority := \"normal\"\n\n# Critical priority for high-risk actions\npriority := \"critical\" if {\n\tinput.risk_score >= 0.9\n}\n\n# High priority for production operations\npriority := \"high\" if {\n\tinput.context.environment == \"production\"\n\tinput.risk_score >= 0.7\n}\n\n# High priority for PII operations\npriority := \"high\" if {\n\tinput.action.type == \"access_pii\"\n}\n\n# Medium priority for staging high-risk actions\npriority := \"medium\" if {\n\tinput.context.environment == \"staging\"\n\tinput.risk_score >= 0.7\n}\n\n# =============================================================================\n# BYPASS DETECTION\n# =============================================================================\n\n# Detect and flag attempts to bypass HITL approval\n\nbypass_attempted := true if {\n\tinput.action.parameters.bypass_review == true\n\thitl_required\n}\n\nbypass_warning := msg if {\n\tbypass_attempted\n\tmsg := \"WARNING: Attempt to bypass required human review detected and blocked\"\n}\n\n# =============================================================================\n# OUTPUT STRUCTURE\n# =============================================================================\n\n# Complete HITL determination result\nresult := output if {\n\thitl_required\n\toutput := {\n\t\t\"hitl_required\": true,\n\t\t\"required_expertise\": required_expertise,\n\t\t\"timeout_seconds\": timeout_seconds,\n\t\t\"escalation_to\": escalation_to,\n\t\t\"rationale\": rationale,\n\t\t\"priority\": priority,\n\t\t\"bypass_attempted\": bypass_attempted,\n\t\t\"action_type\": input.action.type,\n\t\t\"environment\": input.context.environment,\n\t\t\"risk_score\": input.risk_score,\n\t}\n}\n\n# HITL not required - minimal output\nresult := output if {\n\tnot hitl_required\n\toutput := {\n\t\t\"hitl_required\": false,\n\t\t\"rationale\": \"Action does not meet HITL approval criteria\",\n\t\t\"action_type\": input.action.type,\n\t\t\"environment\": input.context.environment,\n\t\t\"risk_score\": input.risk_score,\n\t}\n}\n",
        "timestamp": "2026-01-04T05:35:49.744738"
      },
      "worktree_state": null,
      "task_intent": {
        "title": "061-create-end-to-end-governance-workflow-examples-wit",
        "description": "Create comprehensive examples demonstrating complete governance workflows from policy creation through enforcement to audit logging, targeting Enterprise DevOps/MLOps engineers deploying AI systems. The examples will show: defining constitutional policies, enforcing them on agent actions, handling HITL approvals, and auditing decisions.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-03T19:36:07.496986",
  "last_updated": "2026-01-04T05:35:49.836943"
}