{
  "file_path": "claude-flow/src/commands/analyze.ts",
  "main_branch_history": [],
  "task_views": {
    "059-add-jsdoc-coverage-for-claude-flow-typescript-serv": {
      "task_id": "059-add-jsdoc-coverage-for-claude-flow-typescript-serv",
      "branch_point": {
        "commit_hash": "fc6e42927298263034acf989773f3200e422ad17",
        "content": "import { Command } from 'commander';\nimport chalk from 'chalk';\nimport ora from 'ora';\nimport { performAnalysis } from '../services/analysisService';\nimport { getLogger, cliOutput } from '../utils/logging_config';\n\n// Initialize logger for this module\nconst logger = getLogger('commands/analyze');\n\n// Type definitions for analysis results\nimport { getLogger } from '../../../sdk/typescript/src/utils/logger';\nconst logger = getLogger('analyze');\n\n\ninterface AnalysisFinding {\n  message: string;\n  severity: 'critical' | 'high' | 'medium' | 'low' | 'info';\n  file?: string;\n  line?: number;\n  category?: string;\n  recommendation?: string;\n}\n\ninterface AnalysisRecommendation {\n  description: string;\n  priority?: string;\n  estimatedEffort?: string;\n  benefits?: string;\n}\n\ninterface AnalysisSummary {\n  filesAnalyzed: number;\n  totalFindings?: number;\n}\n\ninterface AnalysisResult {\n  focus: string;\n  target: string;\n  depth: string;\n  summary: AnalysisSummary;\n  findings?: AnalysisFinding[];\n  recommendations?: AnalysisRecommendation[];\n  metrics?: Record<string, string | number>;\n}\n\ntype SeverityLevel = 'critical' | 'high' | 'medium' | 'low' | 'info';\n\nexport const analyzeCommand = new Command('analyze')\n  .description('Code analysis and quality assessment')\n  .argument('[target]', 'Target directory or file to analyze', '.')\n  .option('-f, --focus <type>', 'Analysis focus (quality, security, performance, architecture)', 'quality')\n  .option('-d, --depth <level>', 'Analysis depth (quick, deep)', 'quick')\n  .option('--format <format>', 'Output format (text, json, report)', 'text')\n  .option('--include-patterns <patterns>', 'File patterns to include (comma-separated)', '*.py,*.js,*.ts,*.java,*.go,*.rs')\n  .option('--exclude-patterns <patterns>', 'File patterns to exclude (comma-separated)', 'node_modules/**,*.pyc,__pycache__/**,.git/**')\n  .action(async (target: string, options) => {\n    const spinner = ora('Initializing analysis...').start();\n\n    try {\n        logger.info(chalk.yellow(`\\n\ud83d\udccb Valid focuses: ${validFocuses.join(', ')}`);\n        logger.info(chalk.gray(`\\n\ud83d\udca1 Choose based on your analysis needs:`);\n        logger.info(chalk.gray(`   \u2022 quality: Code maintainability and best practices`);\n        logger.info(chalk.gray(`   \u2022 security: Vulnerability and security issues`);\n        logger.info(chalk.gray(`   \u2022 performance: Performance bottlenecks and optimizations`);\n        logger.info(chalk.gray(`   \u2022 architecture: Design patterns and structural issues`);\n        console.log(chalk.gray(`   \u2022 quality: Code maintainability and best practices`));\n        console.log(chalk.gray(`   \u2022 security: Vulnerability and security issues`));\n        console.log(chalk.gray(`   \u2022 performance: Performance bottlenecks and optimizations`));\n        console.log(chalk.gray(`   \u2022 architecture: Design patterns and structural issues`));\n        process.exit(1);\n      }\n\n        logger.info(chalk.yellow(`\\n\ud83d\udccb Valid depths: ${validDepths.join(', ')}`);\n      const validDepths = ['quick', 'deep'];\n      if (!validDepths.includes(options.depth)) {\n        spinner.fail(chalk.red(`\u274c Invalid depth: ${options.depth}`));\n        logger.warn('invalid_depth', { depth: options.depth, validDepths });\n        cliOutput(chalk.yellow(`\\n\ud83d\udccb Valid depths: ${validDepths.join(', ')}`));\n        process.exit(1);\n      }\n\n        logger.info(chalk.yellow(`\\n\ud83d\udccb Valid formats: ${validFormats.join(', ')}`);\n      const validFormats = ['text', 'json', 'report'];\n      if (!validFormats.includes(options.format)) {\n        spinner.fail(chalk.red(`\u274c Invalid format: ${options.format}`));\n        logger.warn('invalid_format', { format: options.format, validFormats });\n        cliOutput(chalk.yellow(`\\n\ud83d\udccb Valid formats: ${validFormats.join(', ')}`));\n        process.exit(1);\n      }\n\n      // Parse patterns\n      const includePatterns = options.includePatterns.split(',').map((p: string) => p.trim());\n      const excludePatterns = options.excludePatterns.split(',').map((p: string) => p.trim());\n\n      spinner.text = `Analyzing ${target} with ${options.focus} focus (${options.depth} depth)...`;\n      logger.info('analysis_started', { target, focus: options.focus, depth: options.depth });\n\n      // Perform the analysis\n      const result = await performAnalysis({\n        target,\n        focus: options.focus,\n        depth: options.depth,\n        format: options.format,\n        includePatterns,\n        excludePatterns\n      });\n\n        logger.info(JSON.stringify(result, null, 2);\n\n      // Display results based on format\n      if (options.format === 'json') {\n        cliOutput(JSON.stringify(result, null, 2));\n      } else if (options.format === 'report') {\n        displayReportFormat(result);\n      } else {\n        displayTextFormat(result);\n      }\n\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : String(error);\n      spinner.fail(chalk.red(`\u274c Analysis failed: ${errorMessage}`));\n      logger.error('analysis_failed', { error: errorMessage, target });\n      process.exit(1);\n  logger.info(chalk.blue(`\\n\ud83d\udcca Analysis Results - ${result.focus.toUpperCase()} Focus`);\n  logger.info(chalk.gray(`Target: ${result.target}`);\n  logger.info(chalk.gray(`Files analyzed: ${result.summary.filesAnalyzed}`);\n  logger.info(chalk.gray(`Analysis depth: ${result.depth}`);\n  logger.info(chalk.gray(`Generated: ${new Date().toISOString()}`);\n  console.log(chalk.gray(`Target: ${result.target}`));\n  console.log(chalk.gray(`Files analyzed: ${result.summary.filesAnalyzed}`));\n    logger.info(chalk.yellow(`\\n\u26a0\ufe0f  Findings (${result.findings.length}):`);\n  console.log(chalk.gray(`Generated: ${new Date().toISOString()}`));\n\n  if (result.findings && result.findings.length > 0) {\n    cliOutput(chalk.yellow(`\\n\u26a0\ufe0f  Findings (${result.findings.length}):`));\n\n    // Group by severity\n    const bySeverity = result.findings.reduce<Record<SeverityLevel, AnalysisFinding[]>>(\n      (acc, finding) => {\n        acc[finding.severity] = acc[finding.severity] || [];\n        acc[finding.severity].push(finding);\n        return acc;\n      },\n      { critical: [], high: [], medium: [], low: [], info: [] }\n    );\n\n        logger.info(severityColorFn(`\\n${severity.toUpperCase()} (${bySeverity[severity].length}):`);\n    severityLevels.forEach(severity => {\n      if (bySeverity[severity] && bySeverity[severity].length > 0) {\n          logger.info(chalk.gray(`  \u2022 ${finding.message}`);\n        console.log(severityColorFn(`\\n${severity.toUpperCase()} (${bySeverity[severity].length}):`));\n            logger.info(chalk.gray(`    \ud83d\udcc1 ${finding.file}${finding.line ? `:${finding.line}` : ''}`);\n        bySeverity[severity].forEach((finding) => {\n          console.log(chalk.gray(`  \u2022 ${finding.message}`));\n            logger.info(chalk.gray(`    \ud83d\udca1 ${finding.recommendation}`);\n            console.log(chalk.gray(`    \ud83d\udcc1 ${finding.file}${finding.line ? `:${finding.line}` : ''}`));\n          }\n          if (finding.recommendation) {\n            cliOutput(chalk.gray(`    \ud83d\udca1 ${finding.recommendation}`));\n          }\n        });\n      }\n    logger.info(chalk.green(`\\n\ud83d\ude80 Recommendations:`);\n  }\n      logger.info(chalk.gray(`  ${index + 1}. ${rec.description}`);\n  if (result.recommendations && result.recommendations.length > 0) {\n        logger.info(chalk.gray(`     Priority: ${rec.priority}`);\n    result.recommendations.forEach((rec, index) => {\n      console.log(chalk.gray(`  ${index + 1}. ${rec.description}`));\n        logger.info(chalk.gray(`     Effort: ${rec.estimatedEffort}`);\n        console.log(chalk.gray(`     Priority: ${rec.priority}`));\n      }\n      if (rec.estimatedEffort) {\n        cliOutput(chalk.gray(`     Effort: ${rec.estimatedEffort}`));\n      }\n    logger.info(chalk.blue(`\\n\ud83d\udcc8 Metrics:`);\n  }\n      logger.info(chalk.gray(`  \u2022 ${key}: ${value}`);\n  if (result.metrics) {\n    cliOutput(chalk.blue(`\\n\ud83d\udcc8 Metrics:`));\n    Object.entries(result.metrics).forEach(([key, value]) => {\n      cliOutput(chalk.gray(`  \u2022 ${key}: ${value}`));\n    });\n  logger.info(chalk.blue(`\\n\ud83d\udccb Analysis Report - ${result.focus.toUpperCase()} Focus`);\n  logger.info('='.repeat(60);\n\n  logger.info(chalk.bold('\\nEXECUTIVE SUMMARY');\n  logger.info(`Analysis performed on: ${result.target}`;\n  logger.info(`Focus area: ${result.focus}`;\n  logger.info(`Analysis depth: ${result.depth}`;\n  logger.info(`Files analyzed: ${result.summary.filesAnalyzed}`;\n  logger.info(`Total findings: ${result.findings?.length || 0}`;\n  logger.info(`Generated: ${new Date().toISOString()}`;\n  console.log(`Analysis depth: ${result.depth}`);\n  console.log(`Files analyzed: ${result.summary.filesAnalyzed}`);\n    logger.info(chalk.bold('\\nFINDINGS BY SEVERITY');\n  console.log(`Generated: ${new Date().toISOString()}`);\n\n  if (result.findings && result.findings.length > 0) {\n    cliOutput(chalk.bold('\\nFINDINGS BY SEVERITY'));\n\n    const severityStats = result.findings.reduce<Record<string, number>>(\n      (acc, finding) => {\n        acc[finding.severity] = (acc[finding.severity] || 0) + 1;\n        return acc;\n      },\n      {}\n      logger.info(colorFn(`\u2022 ${severity.toUpperCase()}: ${count}`);\n\n    Object.entries(severityStats).forEach(([severity, count]) => {\n    logger.info(chalk.bold('\\nDETAILED FINDINGS');\n      console.log(colorFn(`\u2022 ${severity.toUpperCase()}: ${count}`));\n    });\n      logger.info(colorFn(`\\n${index + 1}. ${finding.message}`);\n      logger.info(`   Severity: ${finding.severity.toUpperCase()}`;\n    result.findings.forEach((finding, index) => {\n        logger.info(`   Location: ${finding.file}${finding.line ? `:${finding.line}` : ''}`;\n      console.log(colorFn(`\\n${index + 1}. ${finding.message}`));\n      console.log(`   Severity: ${finding.severity.toUpperCase()}`);\n        logger.info(`   Category: ${finding.category}`;\n        console.log(`   Location: ${finding.file}${finding.line ? `:${finding.line}` : ''}`);\n      }\n        logger.info(`   Recommendation: ${finding.recommendation}`;\n        console.log(`   Category: ${finding.category}`);\n      }\n      if (finding.recommendation) {\n        cliOutput(`   Recommendation: ${finding.recommendation}`);\n      }\n    logger.info(chalk.bold('\\nRECOMMENDATIONS');\n  }\n      logger.info(`\\n${index + 1}. ${rec.description}`;\n      logger.info(`   Priority: ${rec.priority || 'Medium'}`;\n      logger.info(`   Estimated Effort: ${rec.estimatedEffort || 'Unknown'}`;\n    result.recommendations.forEach((rec, index) => {\n        logger.info(`   Benefits: ${rec.benefits}`;\n      console.log(`   Priority: ${rec.priority || 'Medium'}`);\n      console.log(`   Estimated Effort: ${rec.estimatedEffort || 'Unknown'}`);\n      if (rec.benefits) {\n        cliOutput(`   Benefits: ${rec.benefits}`);\n      }\n    logger.info(chalk.bold('\\nMETRICS');\n  }\n      logger.info(`\u2022 ${key}: ${value}`;\n  if (result.metrics) {\n    cliOutput(chalk.bold('\\nMETRICS'));\n    Object.entries(result.metrics).forEach(([key, value]) => {\n  logger.info('\\n' + '='.repeat(60);\n  logger.info(chalk.green('Report generated successfully');\n  }\n\n  cliOutput('\\n' + '='.repeat(60));\n  cliOutput(chalk.green('Report generated successfully'));\n}\n\nfunction getSeverityColor(severity: string): (text: string) => string {\n  switch (severity.toLowerCase()) {\n    case 'critical': return chalk.red;\n    case 'high': return chalk.red;\n    case 'medium': return chalk.yellow;\n    case 'low': return chalk.blue;\n    case 'info': return chalk.gray;\n    default: return chalk.gray;\n  }\n}\n",
        "timestamp": "2026-01-04T05:35:52.969195"
      },
      "worktree_state": null,
      "task_intent": {
        "title": "Add JSDoc coverage for claude-flow TypeScript service public exports",
        "description": "Add comprehensive JSDoc documentation to the 45 exported functions/classes across 17 TypeScript files in the claude-flow CLI tool to improve API documentation for enterprise users",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-04T05:35:52.992893",
  "last_updated": "2026-01-04T05:35:52.996034"
}