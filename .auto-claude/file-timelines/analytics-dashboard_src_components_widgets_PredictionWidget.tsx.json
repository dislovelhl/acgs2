{
  "file_path": "analytics-dashboard/src/components/widgets/PredictionWidget.tsx",
  "main_branch_history": [],
  "task_views": {
    "054-extract-duplicated-loadingstate-and-api-config-in-": {
      "task_id": "054-extract-duplicated-loadingstate-and-api-config-in-",
      "branch_point": {
        "commit_hash": "4a99fe22e8e0087919301b1aa185d4e2c6da716c",
        "content": "/**\n * PredictionWidget Component\n *\n * Displays violation forecast chart with:\n * - 30-day time-series predictions using Prophet forecasting\n * - Confidence intervals (lower/upper bounds)\n * - Trend direction analysis\n * - Summary statistics\n */\n\nimport { useCallback, useEffect, useState } from \"react\";\nimport {\n  AlertCircle,\n  Calendar,\n  RefreshCw,\n  TrendingDown,\n  TrendingUp,\n  Minus,\n} from \"lucide-react\";\nimport {\n  Area,\n  ComposedChart,\n  Line,\n  ResponsiveContainer,\n  Tooltip,\n  XAxis,\n  YAxis,\n} from \"recharts\";\n\n/** Prediction point data structure from the API */\ninterface PredictionPoint {\n  date: string;\n  predicted_value: number;\n  lower_bound: number;\n  upper_bound: number;\n  trend: number;\n}\n\n/** Summary statistics from the API */\ninterface PredictionSummary {\n  status: string;\n  mean_predicted_violations: number | null;\n  max_predicted_violations: number | null;\n  min_predicted_violations: number | null;\n  total_predicted_violations: number | null;\n  trend_direction: string | null;\n  reason: string | null;\n}\n\n/** Predictions response from the API */\ninterface PredictionsResponse {\n  forecast_timestamp: string;\n  historical_days: number;\n  forecast_days: number;\n  model_trained: boolean;\n  predictions: PredictionPoint[];\n  summary: PredictionSummary;\n  error_message: string | null;\n}\n\n/** Chart data point with calculated confidence band */\ninterface ChartDataPoint {\n  date: string;\n  displayDate: string;\n  predicted: number;\n  lower: number;\n  upper: number;\n  confidenceRange: [number, number];\n}\n\n/** Widget loading state */\ntype LoadingState = \"idle\" | \"loading\" | \"success\" | \"error\";\n\n/** API URL from environment */\nconst API_BASE_URL =\n  import.meta.env.VITE_ANALYTICS_API_URL || \"http://localhost:8080\";\n\n/**\n * Gets the trend direction icon based on trend direction\n */\nfunction getTrendIcon(direction: string | null): JSX.Element {\n  switch (direction) {\n    case \"increasing\":\n      return <TrendingUp className=\"h-4 w-4 text-red-600\" />;\n    case \"decreasing\":\n      return <TrendingDown className=\"h-4 w-4 text-green-600\" />;\n    case \"stable\":\n      return <Minus className=\"h-4 w-4 text-blue-600\" />;\n    default:\n      return <Minus className=\"h-4 w-4 text-gray-400\" />;\n  }\n}\n\n/**\n * Gets the color for trend direction\n */\nfunction getTrendColor(direction: string | null): string {\n  switch (direction) {\n    case \"increasing\":\n      return \"text-red-600\";\n    case \"decreasing\":\n      return \"text-green-600\";\n    case \"stable\":\n      return \"text-blue-600\";\n    default:\n      return \"text-gray-600\";\n  }\n}\n\n/**\n * Formats the timestamp for display\n */\nfunction formatTimestamp(timestamp: string): string {\n  try {\n    const date = new Date(timestamp);\n    return date.toLocaleString(undefined, {\n      dateStyle: \"short\",\n      timeStyle: \"short\",\n    });\n  } catch {\n    return \"Unknown\";\n  }\n}\n\n/**\n * Formats a date string for chart display (MM/DD)\n */\nfunction formatChartDate(dateString: string): string {\n  try {\n    const date = new Date(dateString);\n    return `${date.getMonth() + 1}/${date.getDate()}`;\n  } catch {\n    return dateString;\n  }\n}\n\n/**\n * Custom tooltip component for the chart\n */\nfunction CustomTooltip({\n  active,\n  payload,\n}: {\n  active?: boolean;\n  payload?: Array<{\n    payload: ChartDataPoint;\n  }>;\n}): JSX.Element | null {\n  if (!active || !payload || payload.length === 0) {\n    return null;\n  }\n\n  const data = payload[0].payload;\n\n  return (\n    <div className=\"rounded-lg border border-gray-200 bg-white p-3 shadow-lg\">\n      <p className=\"mb-2 text-sm font-medium text-gray-900\">{data.date}</p>\n      <div className=\"space-y-1 text-xs\">\n        <div className=\"flex items-center justify-between gap-4\">\n          <span className=\"text-gray-600\">Predicted:</span>\n          <span className=\"font-semibold text-indigo-600\">\n            {data.predicted.toFixed(1)} violations\n          </span>\n        </div>\n        <div className=\"flex items-center justify-between gap-4\">\n          <span className=\"text-gray-600\">Range:</span>\n          <span className=\"text-gray-700\">\n            {data.lower.toFixed(1)} - {data.upper.toFixed(1)}\n          </span>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n/**\n * PredictionWidget - Displays violation forecast chart with predictions\n *\n * Features:\n * - Fetches predictions from the analytics API\n * - Shows loading, error, and success states\n * - Displays interactive chart with confidence intervals\n * - Shows summary statistics and trend direction\n * - Supports manual refresh\n */\nexport function PredictionWidget(): JSX.Element {\n  const [data, setData] = useState<PredictionsResponse | null>(null);\n  const [loadingState, setLoadingState] = useState<LoadingState>(\"idle\");\n  const [error, setError] = useState<string | null>(null);\n\n  /**\n   * Fetches prediction data from the API\n   */\n  const fetchPredictions = useCallback(async () => {\n    setLoadingState(\"loading\");\n    setError(null);\n\n    try {\n      const url = new URL(`${API_BASE_URL}/predictions`);\n\n      const response = await fetch(url.toString(), {\n        method: \"GET\",\n        headers: {\n          Accept: \"application/json\",\n        },\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(\n          errorData.detail || `Failed to fetch predictions: ${response.status}`\n        );\n      }\n\n      const responseData: PredictionsResponse = await response.json();\n      setData(responseData);\n      setLoadingState(\"success\");\n    } catch (err) {\n      const message =\n        err instanceof Error ? err.message : \"Failed to load predictions\";\n      setError(message);\n      setLoadingState(\"error\");\n    }\n  }, []);\n\n  // Fetch predictions on mount\n  useEffect(() => {\n    fetchPredictions();\n  }, [fetchPredictions]);\n\n  /**\n   * Handle refresh button click\n   */\n  const handleRefresh = () => {\n    fetchPredictions();\n  };\n\n  /**\n   * Transform API predictions to chart data\n   */\n  const chartData: ChartDataPoint[] =\n    data?.predictions.map((point) => ({\n      date: point.date,\n      displayDate: formatChartDate(point.date),\n      predicted: point.predicted_value,\n      lower: point.lower_bound,\n      upper: point.upper_bound,\n      confidenceRange: [point.lower_bound, point.upper_bound] as [\n        number,\n        number,\n      ],\n    })) || [];\n\n  // Loading state\n  if (loadingState === \"loading\" && !data) {\n    return (\n      <div className=\"h-full rounded-lg bg-white p-4 shadow\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <Calendar className=\"h-5 w-5 text-purple-600\" />\n            <h3 className=\"text-lg font-semibold text-gray-900\">\n              Violation Forecast\n            </h3>\n          </div>\n        </div>\n        <div className=\"mt-4 flex h-48 items-center justify-center\">\n          <div className=\"text-center\">\n            <RefreshCw className=\"mx-auto h-8 w-8 animate-spin text-purple-500\" />\n            <p className=\"mt-2 text-sm text-gray-500\">\n              Generating predictions...\n            </p>\n          </div>\n        </div>\n        <div className=\"mt-4 space-y-2\">\n          <div className=\"h-3 w-3/4 animate-pulse rounded bg-gray-200\" />\n          <div className=\"h-3 w-1/2 animate-pulse rounded bg-gray-200\" />\n        </div>\n      </div>\n    );\n  }\n\n  // Error state\n  if (loadingState === \"error\") {\n    return (\n      <div className=\"h-full rounded-lg bg-white p-4 shadow\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <Calendar className=\"h-5 w-5 text-purple-600\" />\n            <h3 className=\"text-lg font-semibold text-gray-900\">\n              Violation Forecast\n            </h3>\n          </div>\n          <button\n            onClick={handleRefresh}\n            className=\"rounded p-1 text-gray-400 transition-colors hover:bg-gray-100 hover:text-gray-600\"\n            title=\"Retry\"\n            aria-label=\"Retry loading predictions\"\n          >\n            <RefreshCw className=\"h-4 w-4\" />\n          </button>\n        </div>\n        <div className=\"mt-4 flex flex-col items-center justify-center py-8\">\n          <AlertCircle className=\"h-8 w-8 text-red-500\" />\n          <p className=\"mt-2 text-center text-sm text-red-600\">{error}</p>\n          <button\n            onClick={handleRefresh}\n            className=\"mt-4 rounded-md bg-red-50 px-4 py-2 text-sm font-medium text-red-700 transition-colors hover:bg-red-100\"\n          >\n            Try Again\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  // No predictions / model not trained state\n  if (data && (!data.model_trained || data.predictions.length === 0)) {\n    return (\n      <div className=\"flex h-full flex-col rounded-lg bg-white p-4 shadow\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <Calendar className=\"h-5 w-5 text-purple-600\" />\n            <h3 className=\"text-lg font-semibold text-gray-900\">\n              Violation Forecast\n            </h3>\n          </div>\n          <button\n            onClick={handleRefresh}\n            disabled={loadingState === \"loading\"}\n            className=\"rounded p-1 text-gray-400 transition-colors hover:bg-gray-100 hover:text-gray-600 disabled:cursor-not-allowed disabled:opacity-50\"\n            title=\"Refresh predictions\"\n            aria-label=\"Refresh predictions\"\n          >\n            <RefreshCw\n              className={`h-4 w-4 ${loadingState === \"loading\" ? \"animate-spin\" : \"\"}`}\n            />\n          </button>\n        </div>\n\n        {/* Insufficient data state */}\n        <div className=\"flex flex-1 flex-col items-center justify-center py-8\">\n          <Calendar className=\"h-12 w-12 text-gray-400\" />\n          <p className=\"mt-3 text-lg font-medium text-gray-900\">\n            Insufficient Data for Predictions\n          </p>\n          <p className=\"mt-1 max-w-xs text-center text-sm text-gray-500\">\n            {data.error_message ||\n              \"Collect at least 2 weeks of governance events to enable violation forecasting.\"}\n          </p>\n          {data.historical_days > 0 && (\n            <p className=\"mt-2 text-xs text-gray-400\">\n              Current data: {data.historical_days} days (minimum 14 required)\n            </p>\n          )}\n        </div>\n      </div>\n    );\n  }\n\n  // Success state with chart\n  const summary = data?.summary;\n  const trendDirection = summary?.trend_direction;\n\n  return (\n    <div className=\"flex h-full flex-col rounded-lg bg-white p-4 shadow\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center gap-2\">\n          <Calendar className=\"h-5 w-5 text-purple-600\" />\n          <h3 className=\"text-lg font-semibold text-gray-900\">\n            Violation Forecast\n          </h3>\n          {trendDirection && (\n            <span\n              className={`flex items-center gap-1 rounded-full px-2 py-0.5 text-xs font-medium ${\n                trendDirection === \"increasing\"\n                  ? \"bg-red-100 text-red-800\"\n                  : trendDirection === \"decreasing\"\n                    ? \"bg-green-100 text-green-800\"\n                    : \"bg-blue-100 text-blue-800\"\n              }`}\n            >\n              {getTrendIcon(trendDirection)}\n              <span className=\"capitalize\">{trendDirection}</span>\n            </span>\n          )}\n        </div>\n        <button\n          onClick={handleRefresh}\n          disabled={loadingState === \"loading\"}\n          className=\"rounded p-1 text-gray-400 transition-colors hover:bg-gray-100 hover:text-gray-600 disabled:cursor-not-allowed disabled:opacity-50\"\n          title=\"Refresh predictions\"\n          aria-label=\"Refresh predictions\"\n        >\n          <RefreshCw\n            className={`h-4 w-4 ${loadingState === \"loading\" ? \"animate-spin\" : \"\"}`}\n          />\n        </button>\n      </div>\n\n      {/* Chart */}\n      <div className=\"mt-4 flex-1\">\n        <ResponsiveContainer width=\"100%\" height=\"100%\">\n          <ComposedChart\n            data={chartData}\n            margin={{ top: 10, right: 10, left: 0, bottom: 0 }}\n          >\n            <defs>\n              <linearGradient\n                id=\"confidenceGradient\"\n                x1=\"0\"\n                y1=\"0\"\n                x2=\"0\"\n                y2=\"1\"\n              >\n                <stop offset=\"5%\" stopColor=\"#8B5CF6\" stopOpacity={0.2} />\n                <stop offset=\"95%\" stopColor=\"#8B5CF6\" stopOpacity={0.05} />\n              </linearGradient>\n            </defs>\n            <XAxis\n              dataKey=\"displayDate\"\n              tick={{ fontSize: 11, fill: \"#6B7280\" }}\n              tickLine={false}\n              axisLine={{ stroke: \"#E5E7EB\" }}\n              interval=\"preserveStartEnd\"\n            />\n            <YAxis\n              tick={{ fontSize: 11, fill: \"#6B7280\" }}\n              tickLine={false}\n              axisLine={{ stroke: \"#E5E7EB\" }}\n              domain={[\"auto\", \"auto\"]}\n              tickFormatter={(value) => value.toFixed(0)}\n            />\n            <Tooltip content={<CustomTooltip />} />\n            {/* Confidence interval area */}\n            <Area\n              type=\"monotone\"\n              dataKey=\"confidenceRange\"\n              fill=\"url(#confidenceGradient)\"\n              stroke=\"none\"\n              isAnimationActive={false}\n            />\n            {/* Lower bound line (dashed) */}\n            <Line\n              type=\"monotone\"\n              dataKey=\"lower\"\n              stroke=\"#C4B5FD\"\n              strokeWidth={1}\n              strokeDasharray=\"4 4\"\n              dot={false}\n              isAnimationActive={false}\n            />\n            {/* Upper bound line (dashed) */}\n            <Line\n              type=\"monotone\"\n              dataKey=\"upper\"\n              stroke=\"#C4B5FD\"\n              strokeWidth={1}\n              strokeDasharray=\"4 4\"\n              dot={false}\n              isAnimationActive={false}\n            />\n            {/* Predicted value line */}\n            <Line\n              type=\"monotone\"\n              dataKey=\"predicted\"\n              stroke=\"#7C3AED\"\n              strokeWidth={2}\n              dot={false}\n              activeDot={{\n                r: 4,\n                fill: \"#7C3AED\",\n                stroke: \"#fff\",\n                strokeWidth: 2,\n              }}\n              isAnimationActive={false}\n            />\n          </ComposedChart>\n        </ResponsiveContainer>\n      </div>\n\n      {/* Summary Statistics */}\n      {summary && summary.status === \"success\" && (\n        <div className=\"mt-4 grid grid-cols-4 gap-3 rounded-lg bg-purple-50 p-3\">\n          <div className=\"text-center\">\n            <p className=\"text-xs text-gray-500\">Mean/Day</p>\n            <p className=\"text-sm font-semibold text-purple-700\">\n              {summary.mean_predicted_violations?.toFixed(1) || \"N/A\"}\n            </p>\n          </div>\n          <div className=\"text-center\">\n            <p className=\"text-xs text-gray-500\">Max</p>\n            <p className=\"text-sm font-semibold text-purple-700\">\n              {summary.max_predicted_violations?.toFixed(1) || \"N/A\"}\n            </p>\n          </div>\n          <div className=\"text-center\">\n            <p className=\"text-xs text-gray-500\">Min</p>\n            <p className=\"text-sm font-semibold text-purple-700\">\n              {summary.min_predicted_violations?.toFixed(1) || \"N/A\"}\n            </p>\n          </div>\n          <div className=\"text-center\">\n            <p className=\"text-xs text-gray-500\">Total</p>\n            <p className=\"text-sm font-semibold text-purple-700\">\n              {summary.total_predicted_violations?.toFixed(0) || \"N/A\"}\n            </p>\n          </div>\n        </div>\n      )}\n\n      {/* Footer with metadata */}\n      <div className=\"mt-4 flex items-center justify-between border-t border-gray-100 pt-3 text-xs text-gray-500\">\n        <div className=\"flex items-center gap-4\">\n          <span>\n            Forecast:{\" \"}\n            <span className=\"font-medium text-gray-700\">\n              {data?.forecast_days || 0} days\n            </span>\n          </span>\n          <span>\n            Training:{\" \"}\n            <span className=\"font-medium text-gray-700\">\n              {data?.historical_days || 0} days\n            </span>\n          </span>\n          {trendDirection && (\n            <span className=\"flex items-center gap-1\">\n              Trend:{\" \"}\n              <span className={`font-medium capitalize ${getTrendColor(trendDirection)}`}>\n                {trendDirection}\n              </span>\n            </span>\n          )}\n        </div>\n        {data?.forecast_timestamp && (\n          <span title={data.forecast_timestamp}>\n            {formatTimestamp(data.forecast_timestamp)}\n          </span>\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport default PredictionWidget;\n",
        "timestamp": "2026-01-03T18:35:24.567548"
      },
      "worktree_state": {
        "content": "/**\n * PredictionWidget Component\n *\n * Displays violation forecast chart with:\n * - 30-day time-series predictions using Prophet forecasting\n * - Confidence intervals (lower/upper bounds)\n * - Trend direction analysis\n * - Summary statistics\n */\n\nimport { useCallback, useEffect, useState } from \"react\";\nimport {\n  AlertCircle,\n  Calendar,\n  RefreshCw,\n  TrendingDown,\n  TrendingUp,\n  Minus,\n} from \"lucide-react\";\nimport {\n  Area,\n  ComposedChart,\n  Line,\n  ResponsiveContainer,\n  Tooltip,\n  XAxis,\n  YAxis,\n} from \"recharts\";\nimport { LoadingState, API_BASE_URL } from \"../../lib\";\n\n/** Prediction point data structure from the API */\ninterface PredictionPoint {\n  date: string;\n  predicted_value: number;\n  lower_bound: number;\n  upper_bound: number;\n  trend: number;\n}\n\n/** Summary statistics from the API */\ninterface PredictionSummary {\n  status: string;\n  mean_predicted_violations: number | null;\n  max_predicted_violations: number | null;\n  min_predicted_violations: number | null;\n  total_predicted_violations: number | null;\n  trend_direction: string | null;\n  reason: string | null;\n}\n\n/** Predictions response from the API */\ninterface PredictionsResponse {\n  forecast_timestamp: string;\n  historical_days: number;\n  forecast_days: number;\n  model_trained: boolean;\n  predictions: PredictionPoint[];\n  summary: PredictionSummary;\n  error_message: string | null;\n}\n\n/** Chart data point with calculated confidence band */\ninterface ChartDataPoint {\n  date: string;\n  displayDate: string;\n  predicted: number;\n  lower: number;\n  upper: number;\n  confidenceRange: [number, number];\n}\n\n/**\n * Gets the trend direction icon based on trend direction\n */\nfunction getTrendIcon(direction: string | null): JSX.Element {\n  switch (direction) {\n    case \"increasing\":\n      return <TrendingUp className=\"h-4 w-4 text-red-600\" />;\n    case \"decreasing\":\n      return <TrendingDown className=\"h-4 w-4 text-green-600\" />;\n    case \"stable\":\n      return <Minus className=\"h-4 w-4 text-blue-600\" />;\n    default:\n      return <Minus className=\"h-4 w-4 text-gray-400\" />;\n  }\n}\n\n/**\n * Gets the color for trend direction\n */\nfunction getTrendColor(direction: string | null): string {\n  switch (direction) {\n    case \"increasing\":\n      return \"text-red-600\";\n    case \"decreasing\":\n      return \"text-green-600\";\n    case \"stable\":\n      return \"text-blue-600\";\n    default:\n      return \"text-gray-600\";\n  }\n}\n\n/**\n * Formats the timestamp for display\n */\nfunction formatTimestamp(timestamp: string): string {\n  try {\n    const date = new Date(timestamp);\n    return date.toLocaleString(undefined, {\n      dateStyle: \"short\",\n      timeStyle: \"short\",\n    });\n  } catch {\n    return \"Unknown\";\n  }\n}\n\n/**\n * Formats a date string for chart display (MM/DD)\n */\nfunction formatChartDate(dateString: string): string {\n  try {\n    const date = new Date(dateString);\n    return `${date.getMonth() + 1}/${date.getDate()}`;\n  } catch {\n    return dateString;\n  }\n}\n\n/**\n * Custom tooltip component for the chart\n */\nfunction CustomTooltip({\n  active,\n  payload,\n}: {\n  active?: boolean;\n  payload?: Array<{\n    payload: ChartDataPoint;\n  }>;\n}): JSX.Element | null {\n  if (!active || !payload || payload.length === 0) {\n    return null;\n  }\n\n  const data = payload[0].payload;\n\n  return (\n    <div className=\"rounded-lg border border-gray-200 bg-white p-3 shadow-lg\">\n      <p className=\"mb-2 text-sm font-medium text-gray-900\">{data.date}</p>\n      <div className=\"space-y-1 text-xs\">\n        <div className=\"flex items-center justify-between gap-4\">\n          <span className=\"text-gray-600\">Predicted:</span>\n          <span className=\"font-semibold text-indigo-600\">\n            {data.predicted.toFixed(1)} violations\n          </span>\n        </div>\n        <div className=\"flex items-center justify-between gap-4\">\n          <span className=\"text-gray-600\">Range:</span>\n          <span className=\"text-gray-700\">\n            {data.lower.toFixed(1)} - {data.upper.toFixed(1)}\n          </span>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n/**\n * PredictionWidget - Displays violation forecast chart with predictions\n *\n * Features:\n * - Fetches predictions from the analytics API\n * - Shows loading, error, and success states\n * - Displays interactive chart with confidence intervals\n * - Shows summary statistics and trend direction\n * - Supports manual refresh\n */\nexport function PredictionWidget(): JSX.Element {\n  const [data, setData] = useState<PredictionsResponse | null>(null);\n  const [loadingState, setLoadingState] = useState<LoadingState>(\"idle\");\n  const [error, setError] = useState<string | null>(null);\n\n  /**\n   * Fetches prediction data from the API\n   */\n  const fetchPredictions = useCallback(async () => {\n    setLoadingState(\"loading\");\n    setError(null);\n\n    try {\n      const url = new URL(`${API_BASE_URL}/predictions`);\n\n      const response = await fetch(url.toString(), {\n        method: \"GET\",\n        headers: {\n          Accept: \"application/json\",\n        },\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(\n          errorData.detail || `Failed to fetch predictions: ${response.status}`\n        );\n      }\n\n      const responseData: PredictionsResponse = await response.json();\n      setData(responseData);\n      setLoadingState(\"success\");\n    } catch (err) {\n      const message =\n        err instanceof Error ? err.message : \"Failed to load predictions\";\n      setError(message);\n      setLoadingState(\"error\");\n    }\n  }, []);\n\n  // Fetch predictions on mount\n  useEffect(() => {\n    fetchPredictions();\n  }, [fetchPredictions]);\n\n  /**\n   * Handle refresh button click\n   */\n  const handleRefresh = () => {\n    fetchPredictions();\n  };\n\n  /**\n   * Transform API predictions to chart data\n   */\n  const chartData: ChartDataPoint[] =\n    data?.predictions.map((point) => ({\n      date: point.date,\n      displayDate: formatChartDate(point.date),\n      predicted: point.predicted_value,\n      lower: point.lower_bound,\n      upper: point.upper_bound,\n      confidenceRange: [point.lower_bound, point.upper_bound] as [\n        number,\n        number,\n      ],\n    })) || [];\n\n  // Loading state\n  if (loadingState === \"loading\" && !data) {\n    return (\n      <div className=\"h-full rounded-lg bg-white p-4 shadow\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <Calendar className=\"h-5 w-5 text-purple-600\" />\n            <h3 className=\"text-lg font-semibold text-gray-900\">\n              Violation Forecast\n            </h3>\n          </div>\n        </div>\n        <div className=\"mt-4 flex h-48 items-center justify-center\">\n          <div className=\"text-center\">\n            <RefreshCw className=\"mx-auto h-8 w-8 animate-spin text-purple-500\" />\n            <p className=\"mt-2 text-sm text-gray-500\">\n              Generating predictions...\n            </p>\n          </div>\n        </div>\n        <div className=\"mt-4 space-y-2\">\n          <div className=\"h-3 w-3/4 animate-pulse rounded bg-gray-200\" />\n          <div className=\"h-3 w-1/2 animate-pulse rounded bg-gray-200\" />\n        </div>\n      </div>\n    );\n  }\n\n  // Error state\n  if (loadingState === \"error\") {\n    return (\n      <div className=\"h-full rounded-lg bg-white p-4 shadow\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <Calendar className=\"h-5 w-5 text-purple-600\" />\n            <h3 className=\"text-lg font-semibold text-gray-900\">\n              Violation Forecast\n            </h3>\n          </div>\n          <button\n            onClick={handleRefresh}\n            className=\"rounded p-1 text-gray-400 transition-colors hover:bg-gray-100 hover:text-gray-600\"\n            title=\"Retry\"\n            aria-label=\"Retry loading predictions\"\n          >\n            <RefreshCw className=\"h-4 w-4\" />\n          </button>\n        </div>\n        <div className=\"mt-4 flex flex-col items-center justify-center py-8\">\n          <AlertCircle className=\"h-8 w-8 text-red-500\" />\n          <p className=\"mt-2 text-center text-sm text-red-600\">{error}</p>\n          <button\n            onClick={handleRefresh}\n            className=\"mt-4 rounded-md bg-red-50 px-4 py-2 text-sm font-medium text-red-700 transition-colors hover:bg-red-100\"\n          >\n            Try Again\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  // No predictions / model not trained state\n  if (data && (!data.model_trained || data.predictions.length === 0)) {\n    return (\n      <div className=\"flex h-full flex-col rounded-lg bg-white p-4 shadow\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <Calendar className=\"h-5 w-5 text-purple-600\" />\n            <h3 className=\"text-lg font-semibold text-gray-900\">\n              Violation Forecast\n            </h3>\n          </div>\n          <button\n            onClick={handleRefresh}\n            disabled={loadingState === \"loading\"}\n            className=\"rounded p-1 text-gray-400 transition-colors hover:bg-gray-100 hover:text-gray-600 disabled:cursor-not-allowed disabled:opacity-50\"\n            title=\"Refresh predictions\"\n            aria-label=\"Refresh predictions\"\n          >\n            <RefreshCw\n              className={`h-4 w-4 ${loadingState === \"loading\" ? \"animate-spin\" : \"\"}`}\n            />\n          </button>\n        </div>\n\n        {/* Insufficient data state */}\n        <div className=\"flex flex-1 flex-col items-center justify-center py-8\">\n          <Calendar className=\"h-12 w-12 text-gray-400\" />\n          <p className=\"mt-3 text-lg font-medium text-gray-900\">\n            Insufficient Data for Predictions\n          </p>\n          <p className=\"mt-1 max-w-xs text-center text-sm text-gray-500\">\n            {data.error_message ||\n              \"Collect at least 2 weeks of governance events to enable violation forecasting.\"}\n          </p>\n          {data.historical_days > 0 && (\n            <p className=\"mt-2 text-xs text-gray-400\">\n              Current data: {data.historical_days} days (minimum 14 required)\n            </p>\n          )}\n        </div>\n      </div>\n    );\n  }\n\n  // Success state with chart\n  const summary = data?.summary;\n  const trendDirection = summary?.trend_direction;\n\n  return (\n    <div className=\"flex h-full flex-col rounded-lg bg-white p-4 shadow\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center gap-2\">\n          <Calendar className=\"h-5 w-5 text-purple-600\" />\n          <h3 className=\"text-lg font-semibold text-gray-900\">\n            Violation Forecast\n          </h3>\n          {trendDirection && (\n            <span\n              className={`flex items-center gap-1 rounded-full px-2 py-0.5 text-xs font-medium ${\n                trendDirection === \"increasing\"\n                  ? \"bg-red-100 text-red-800\"\n                  : trendDirection === \"decreasing\"\n                    ? \"bg-green-100 text-green-800\"\n                    : \"bg-blue-100 text-blue-800\"\n              }`}\n            >\n              {getTrendIcon(trendDirection)}\n              <span className=\"capitalize\">{trendDirection}</span>\n            </span>\n          )}\n        </div>\n        <button\n          onClick={handleRefresh}\n          disabled={loadingState === \"loading\"}\n          className=\"rounded p-1 text-gray-400 transition-colors hover:bg-gray-100 hover:text-gray-600 disabled:cursor-not-allowed disabled:opacity-50\"\n          title=\"Refresh predictions\"\n          aria-label=\"Refresh predictions\"\n        >\n          <RefreshCw\n            className={`h-4 w-4 ${loadingState === \"loading\" ? \"animate-spin\" : \"\"}`}\n          />\n        </button>\n      </div>\n\n      {/* Chart */}\n      <div className=\"mt-4 flex-1\">\n        <ResponsiveContainer width=\"100%\" height=\"100%\">\n          <ComposedChart\n            data={chartData}\n            margin={{ top: 10, right: 10, left: 0, bottom: 0 }}\n          >\n            <defs>\n              <linearGradient\n                id=\"confidenceGradient\"\n                x1=\"0\"\n                y1=\"0\"\n                x2=\"0\"\n                y2=\"1\"\n              >\n                <stop offset=\"5%\" stopColor=\"#8B5CF6\" stopOpacity={0.2} />\n                <stop offset=\"95%\" stopColor=\"#8B5CF6\" stopOpacity={0.05} />\n              </linearGradient>\n            </defs>\n            <XAxis\n              dataKey=\"displayDate\"\n              tick={{ fontSize: 11, fill: \"#6B7280\" }}\n              tickLine={false}\n              axisLine={{ stroke: \"#E5E7EB\" }}\n              interval=\"preserveStartEnd\"\n            />\n            <YAxis\n              tick={{ fontSize: 11, fill: \"#6B7280\" }}\n              tickLine={false}\n              axisLine={{ stroke: \"#E5E7EB\" }}\n              domain={[\"auto\", \"auto\"]}\n              tickFormatter={(value) => value.toFixed(0)}\n            />\n            <Tooltip content={<CustomTooltip />} />\n            {/* Confidence interval area */}\n            <Area\n              type=\"monotone\"\n              dataKey=\"confidenceRange\"\n              fill=\"url(#confidenceGradient)\"\n              stroke=\"none\"\n              isAnimationActive={false}\n            />\n            {/* Lower bound line (dashed) */}\n            <Line\n              type=\"monotone\"\n              dataKey=\"lower\"\n              stroke=\"#C4B5FD\"\n              strokeWidth={1}\n              strokeDasharray=\"4 4\"\n              dot={false}\n              isAnimationActive={false}\n            />\n            {/* Upper bound line (dashed) */}\n            <Line\n              type=\"monotone\"\n              dataKey=\"upper\"\n              stroke=\"#C4B5FD\"\n              strokeWidth={1}\n              strokeDasharray=\"4 4\"\n              dot={false}\n              isAnimationActive={false}\n            />\n            {/* Predicted value line */}\n            <Line\n              type=\"monotone\"\n              dataKey=\"predicted\"\n              stroke=\"#7C3AED\"\n              strokeWidth={2}\n              dot={false}\n              activeDot={{\n                r: 4,\n                fill: \"#7C3AED\",\n                stroke: \"#fff\",\n                strokeWidth: 2,\n              }}\n              isAnimationActive={false}\n            />\n          </ComposedChart>\n        </ResponsiveContainer>\n      </div>\n\n      {/* Summary Statistics */}\n      {summary && summary.status === \"success\" && (\n        <div className=\"mt-4 grid grid-cols-4 gap-3 rounded-lg bg-purple-50 p-3\">\n          <div className=\"text-center\">\n            <p className=\"text-xs text-gray-500\">Mean/Day</p>\n            <p className=\"text-sm font-semibold text-purple-700\">\n              {summary.mean_predicted_violations?.toFixed(1) || \"N/A\"}\n            </p>\n          </div>\n          <div className=\"text-center\">\n            <p className=\"text-xs text-gray-500\">Max</p>\n            <p className=\"text-sm font-semibold text-purple-700\">\n              {summary.max_predicted_violations?.toFixed(1) || \"N/A\"}\n            </p>\n          </div>\n          <div className=\"text-center\">\n            <p className=\"text-xs text-gray-500\">Min</p>\n            <p className=\"text-sm font-semibold text-purple-700\">\n              {summary.min_predicted_violations?.toFixed(1) || \"N/A\"}\n            </p>\n          </div>\n          <div className=\"text-center\">\n            <p className=\"text-xs text-gray-500\">Total</p>\n            <p className=\"text-sm font-semibold text-purple-700\">\n              {summary.total_predicted_violations?.toFixed(0) || \"N/A\"}\n            </p>\n          </div>\n        </div>\n      )}\n\n      {/* Footer with metadata */}\n      <div className=\"mt-4 flex items-center justify-between border-t border-gray-100 pt-3 text-xs text-gray-500\">\n        <div className=\"flex items-center gap-4\">\n          <span>\n            Forecast:{\" \"}\n            <span className=\"font-medium text-gray-700\">\n              {data?.forecast_days || 0} days\n            </span>\n          </span>\n          <span>\n            Training:{\" \"}\n            <span className=\"font-medium text-gray-700\">\n              {data?.historical_days || 0} days\n            </span>\n          </span>\n          {trendDirection && (\n            <span className=\"flex items-center gap-1\">\n              Trend:{\" \"}\n              <span className={`font-medium capitalize ${getTrendColor(trendDirection)}`}>\n                {trendDirection}\n              </span>\n            </span>\n          )}\n        </div>\n        {data?.forecast_timestamp && (\n          <span title={data.forecast_timestamp}>\n            {formatTimestamp(data.forecast_timestamp)}\n          </span>\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport default PredictionWidget;\n",
        "last_modified": "2026-01-03T19:10:12.020858"
      },
      "task_intent": {
        "title": "054-extract-duplicated-loadingstate-and-api-config-in-",
        "description": "The analytics-dashboard has 4 widget components (PredictionWidget, AnomalyWidget, InsightWidget, QueryInterface) that each independently define the same LoadingState type and API_BASE_URL constant. This pattern is repeated across 7+ files when including tests, leading to maintenance burden and potential inconsistencies.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    },
    "052-replace-recharts-with-lightweight-chart-library": {
      "task_id": "052-replace-recharts-with-lightweight-chart-library",
      "branch_point": {
        "commit_hash": "fc6e42927298263034acf989773f3200e422ad17",
        "content": "/**\n * PredictionWidget Component\n *\n * Displays violation forecast chart with:\n * - 30-day time-series predictions using Prophet forecasting\n * - Confidence intervals (lower/upper bounds)\n * - Trend direction analysis\n * - Summary statistics\n */\n\nimport { memo, useCallback, useEffect, useMemo, useState } from \"react\";\nimport {\n  AlertCircle,\n  Calendar,\n  RefreshCw,\n  TrendingDown,\n  TrendingUp,\n  Minus,\n} from \"lucide-react\";\nimport {\n  Area,\n  ComposedChart,\n  Line,\n  ResponsiveContainer,\n  Tooltip,\n  XAxis,\n  YAxis,\n} from \"recharts\";\nimport { LoadingState, API_BASE_URL } from \"../../lib\";\n\n/** Prediction point data structure from the API */\ninterface PredictionPoint {\n  date: string;\n  predicted_value: number;\n  lower_bound: number;\n  upper_bound: number;\n  trend: number;\n}\n\n/** Summary statistics from the API */\ninterface PredictionSummary {\n  status: string;\n  mean_predicted_violations: number | null;\n  max_predicted_violations: number | null;\n  min_predicted_violations: number | null;\n  total_predicted_violations: number | null;\n  trend_direction: string | null;\n  reason: string | null;\n}\n\n/** Predictions response from the API */\ninterface PredictionsResponse {\n  forecast_timestamp: string;\n  historical_days: number;\n  forecast_days: number;\n  model_trained: boolean;\n  predictions: PredictionPoint[];\n  summary: PredictionSummary;\n  error_message: string | null;\n}\n\n/** Chart data point with calculated confidence band */\ninterface ChartDataPoint {\n  date: string;\n  displayDate: string;\n  predicted: number;\n  lower: number;\n  upper: number;\n  confidenceRange: [number, number];\n}\n\n/**\n * Gets the trend direction icon based on trend direction\n */\nfunction getTrendIcon(direction: string | null): JSX.Element {\n  switch (direction) {\n    case \"increasing\":\n      return <TrendingUp className=\"h-4 w-4 text-red-600\" />;\n    case \"decreasing\":\n      return <TrendingDown className=\"h-4 w-4 text-green-600\" />;\n    case \"stable\":\n      return <Minus className=\"h-4 w-4 text-blue-600\" />;\n    default:\n      return <Minus className=\"h-4 w-4 text-gray-400\" />;\n  }\n}\n\n/**\n * Gets the color for trend direction\n */\nfunction getTrendColor(direction: string | null): string {\n  switch (direction) {\n    case \"increasing\":\n      return \"text-red-600\";\n    case \"decreasing\":\n      return \"text-green-600\";\n    case \"stable\":\n      return \"text-blue-600\";\n    default:\n      return \"text-gray-600\";\n  }\n}\n\n/**\n * Formats the timestamp for display\n */\nfunction formatTimestamp(timestamp: string): string {\n  try {\n    const date = new Date(timestamp);\n    return date.toLocaleString(undefined, {\n      dateStyle: \"short\",\n      timeStyle: \"short\",\n    });\n  } catch {\n    return \"Unknown\";\n  }\n}\n\n/**\n * Formats a date string for chart display (MM/DD)\n */\nfunction formatChartDate(dateString: string): string {\n  try {\n    const date = new Date(dateString);\n    return `${date.getMonth() + 1}/${date.getDate()}`;\n  } catch {\n    return dateString;\n  }\n}\n\n/**\n * Custom tooltip component for the chart\n *\n * @memoization Wrapped with React.memo to prevent unnecessary re-renders.\n * Performance benefits:\n * - Recharts frequently re-renders tooltips on mouse movements\n * - Memoization ensures tooltip only updates when active state or payload data changes\n * - Reduces DOM reconciliation overhead during chart interactions\n * - Prevents expensive formatting operations from running on every mouse move\n */\nconst CustomTooltip = memo(function CustomTooltip({\n  active,\n  payload,\n}: {\n  active?: boolean;\n  payload?: Array<{\n    payload: ChartDataPoint;\n  }>;\n}): JSX.Element | null {\n  if (!active || !payload || payload.length === 0) {\n    return null;\n  }\n\n  const data = payload[0].payload;\n\n  return (\n    <div className=\"rounded-lg border border-gray-200 bg-white p-3 shadow-lg\">\n      <p className=\"mb-2 text-sm font-medium text-gray-900\">{data.date}</p>\n      <div className=\"space-y-1 text-xs\">\n        <div className=\"flex items-center justify-between gap-4\">\n          <span className=\"text-gray-600\">Predicted:</span>\n          <span className=\"font-semibold text-indigo-600\">\n            {data.predicted.toFixed(1)} violations\n          </span>\n        </div>\n        <div className=\"flex items-center justify-between gap-4\">\n          <span className=\"text-gray-600\">Range:</span>\n          <span className=\"text-gray-700\">\n            {data.lower.toFixed(1)} - {data.upper.toFixed(1)}\n          </span>\n        </div>\n      </div>\n    </div>\n  );\n});\n\n/**\n * PredictionWidget - Displays violation forecast chart with predictions\n *\n * Features:\n * - Fetches predictions from the analytics API\n * - Shows loading, error, and success states\n * - Displays interactive chart with confidence intervals\n * - Shows summary statistics and trend direction\n * - Supports manual refresh\n *\n * @memoization Wrapped with React.memo to optimize parent re-renders.\n * Performance benefits:\n * - Widget has no props, so it only re-renders when internal state changes\n * - Prevents unnecessary re-renders when parent dashboard updates other widgets\n * - Reduces cost of re-rendering complex Recharts components\n * - Works in conjunction with useMemo for chartData transformation\n *\n * Memoization strategy:\n * - Component level: React.memo prevents re-renders from parent\n * - Data transformation: useMemo caches chartData calculations\n * - API calls: useCallback stabilizes fetchPredictions reference\n * - Nested components: CustomTooltip memoized for chart interaction performance\n */\nexport const PredictionWidget = memo(function PredictionWidget(): JSX.Element {\n  const [data, setData] = useState<PredictionsResponse | null>(null);\n  const [loadingState, setLoadingState] = useState<LoadingState>(\"idle\");\n  const [error, setError] = useState<string | null>(null);\n\n  /**\n   * Fetches prediction data from the API\n   *\n   * @memoization Wrapped with useCallback to maintain stable function reference.\n   * Performance benefits:\n   * - Prevents useEffect from re-fetching on every render\n   * - Allows useEffect dependency array to work correctly\n   * - Reduces unnecessary API calls and network traffic\n   * - Empty dependency array ensures function is created once per component lifecycle\n   */\n  const fetchPredictions = useCallback(async () => {\n    setLoadingState(\"loading\");\n    setError(null);\n\n    try {\n      const url = new URL(`${API_BASE_URL}/predictions`);\n\n      const response = await fetch(url.toString(), {\n        method: \"GET\",\n        headers: {\n          Accept: \"application/json\",\n        },\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(\n          errorData.detail || `Failed to fetch predictions: ${response.status}`\n        );\n      }\n\n      const responseData: PredictionsResponse = await response.json();\n      setData(responseData);\n      setLoadingState(\"success\");\n    } catch (err) {\n      const message =\n        err instanceof Error ? err.message : \"Failed to load predictions\";\n      setError(message);\n      setLoadingState(\"error\");\n    }\n  }, []);\n\n  // Fetch predictions on mount\n  useEffect(() => {\n    fetchPredictions();\n  }, [fetchPredictions]);\n\n  /**\n   * Handle refresh button click\n   */\n  const handleRefresh = () => {\n    fetchPredictions();\n  };\n\n  /**\n   * Transform API predictions to chart data\n   *\n   * @memoization Wrapped with useMemo to cache expensive data transformations.\n   * Performance benefits:\n   * - Prevents re-calculating chart data on every render (e.g., during loading state updates)\n   * - Reduces array mapping operations (typically 30+ prediction points)\n   * - Avoids triggering Recharts re-renders with new array references\n   * - Only recalculates when predictions data actually changes\n   *\n   * Transformation cost:\n   * - Maps ~30 prediction points on each calculation\n   * - Formats dates and creates tuple objects for each point\n   * - Without memoization, runs on every state update (loading, error states)\n   */\n  const chartData: ChartDataPoint[] = useMemo(\n    () =>\n      data?.predictions.map((point) => ({\n        date: point.date,\n        displayDate: formatChartDate(point.date),\n        predicted: point.predicted_value,\n        lower: point.lower_bound,\n        upper: point.upper_bound,\n        confidenceRange: [point.lower_bound, point.upper_bound] as [\n          number,\n          number,\n        ],\n      })) || [],\n    [data?.predictions]\n  );\n\n  // Loading state\n  if (loadingState === \"loading\" && !data) {\n    return (\n      <div className=\"h-full rounded-lg bg-white p-4 shadow\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <Calendar className=\"h-5 w-5 text-purple-600\" />\n            <h3 className=\"text-lg font-semibold text-gray-900\">\n              Violation Forecast\n            </h3>\n          </div>\n        </div>\n        <div className=\"mt-4 flex h-48 items-center justify-center\">\n          <div className=\"text-center\">\n            <RefreshCw className=\"mx-auto h-8 w-8 animate-spin text-purple-500\" />\n            <p className=\"mt-2 text-sm text-gray-500\">\n              Generating predictions...\n            </p>\n          </div>\n        </div>\n        <div className=\"mt-4 space-y-2\">\n          <div className=\"h-3 w-3/4 animate-pulse rounded bg-gray-200\" />\n          <div className=\"h-3 w-1/2 animate-pulse rounded bg-gray-200\" />\n        </div>\n      </div>\n    );\n  }\n\n  // Error state\n  if (loadingState === \"error\") {\n    return (\n      <div className=\"h-full rounded-lg bg-white p-4 shadow\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <Calendar className=\"h-5 w-5 text-purple-600\" />\n            <h3 className=\"text-lg font-semibold text-gray-900\">\n              Violation Forecast\n            </h3>\n          </div>\n          <button\n            onClick={handleRefresh}\n            className=\"rounded p-1 text-gray-400 transition-colors hover:bg-gray-100 hover:text-gray-600\"\n            title=\"Retry\"\n            aria-label=\"Retry loading predictions\"\n          >\n            <RefreshCw className=\"h-4 w-4\" />\n          </button>\n        </div>\n        <div className=\"mt-4 flex flex-col items-center justify-center py-8\">\n          <AlertCircle className=\"h-8 w-8 text-red-500\" />\n          <p className=\"mt-2 text-center text-sm text-red-600\">{error}</p>\n          <button\n            onClick={handleRefresh}\n            className=\"mt-4 rounded-md bg-red-50 px-4 py-2 text-sm font-medium text-red-700 transition-colors hover:bg-red-100\"\n          >\n            Try Again\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  // No predictions / model not trained state\n  if (data && (!data.model_trained || data.predictions.length === 0)) {\n    return (\n      <div className=\"flex h-full flex-col rounded-lg bg-white p-4 shadow\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <Calendar className=\"h-5 w-5 text-purple-600\" />\n            <h3 className=\"text-lg font-semibold text-gray-900\">\n              Violation Forecast\n            </h3>\n          </div>\n          <button\n            onClick={handleRefresh}\n            disabled={loadingState === \"loading\"}\n            className=\"rounded p-1 text-gray-400 transition-colors hover:bg-gray-100 hover:text-gray-600 disabled:cursor-not-allowed disabled:opacity-50\"\n            title=\"Refresh predictions\"\n            aria-label=\"Refresh predictions\"\n          >\n            <RefreshCw\n              className={`h-4 w-4 ${loadingState === \"loading\" ? \"animate-spin\" : \"\"}`}\n            />\n          </button>\n        </div>\n\n        {/* Insufficient data state */}\n        <div className=\"flex flex-1 flex-col items-center justify-center py-8\">\n          <Calendar className=\"h-12 w-12 text-gray-400\" />\n          <p className=\"mt-3 text-lg font-medium text-gray-900\">\n            Insufficient Data for Predictions\n          </p>\n          <p className=\"mt-1 max-w-xs text-center text-sm text-gray-500\">\n            {data.error_message ||\n              \"Collect at least 2 weeks of governance events to enable violation forecasting.\"}\n          </p>\n          {data.historical_days > 0 && (\n            <p className=\"mt-2 text-xs text-gray-400\">\n              Current data: {data.historical_days} days (minimum 14 required)\n            </p>\n          )}\n        </div>\n      </div>\n    );\n  }\n\n  // Success state with chart\n  const summary = data?.summary;\n  const trendDirection = summary?.trend_direction;\n\n  return (\n    <div className=\"flex h-full flex-col rounded-lg bg-white p-4 shadow\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center gap-2\">\n          <Calendar className=\"h-5 w-5 text-purple-600\" />\n          <h3 className=\"text-lg font-semibold text-gray-900\">\n            Violation Forecast\n          </h3>\n          {trendDirection && (\n            <span\n              className={`flex items-center gap-1 rounded-full px-2 py-0.5 text-xs font-medium ${\n                trendDirection === \"increasing\"\n                  ? \"bg-red-100 text-red-800\"\n                  : trendDirection === \"decreasing\"\n                    ? \"bg-green-100 text-green-800\"\n                    : \"bg-blue-100 text-blue-800\"\n              }`}\n            >\n              {getTrendIcon(trendDirection)}\n              <span className=\"capitalize\">{trendDirection}</span>\n            </span>\n          )}\n        </div>\n        <button\n          onClick={handleRefresh}\n          disabled={loadingState === \"loading\"}\n          className=\"rounded p-1 text-gray-400 transition-colors hover:bg-gray-100 hover:text-gray-600 disabled:cursor-not-allowed disabled:opacity-50\"\n          title=\"Refresh predictions\"\n          aria-label=\"Refresh predictions\"\n        >\n          <RefreshCw\n            className={`h-4 w-4 ${loadingState === \"loading\" ? \"animate-spin\" : \"\"}`}\n          />\n        </button>\n      </div>\n\n      {/* Chart */}\n      <div className=\"mt-4 flex-1\">\n        <ResponsiveContainer width=\"100%\" height=\"100%\">\n          <ComposedChart\n            data={chartData}\n            margin={{ top: 10, right: 10, left: 0, bottom: 0 }}\n          >\n            <defs>\n              <linearGradient\n                id=\"confidenceGradient\"\n                x1=\"0\"\n                y1=\"0\"\n                x2=\"0\"\n                y2=\"1\"\n              >\n                <stop offset=\"5%\" stopColor=\"#8B5CF6\" stopOpacity={0.2} />\n                <stop offset=\"95%\" stopColor=\"#8B5CF6\" stopOpacity={0.05} />\n              </linearGradient>\n            </defs>\n            <XAxis\n              dataKey=\"displayDate\"\n              tick={{ fontSize: 11, fill: \"#6B7280\" }}\n              tickLine={false}\n              axisLine={{ stroke: \"#E5E7EB\" }}\n              interval=\"preserveStartEnd\"\n            />\n            <YAxis\n              tick={{ fontSize: 11, fill: \"#6B7280\" }}\n              tickLine={false}\n              axisLine={{ stroke: \"#E5E7EB\" }}\n              domain={[\"auto\", \"auto\"]}\n              tickFormatter={(value) => value.toFixed(0)}\n            />\n            <Tooltip content={<CustomTooltip />} />\n            {/* Confidence interval area */}\n            <Area\n              type=\"monotone\"\n              dataKey=\"confidenceRange\"\n              fill=\"url(#confidenceGradient)\"\n              stroke=\"none\"\n              isAnimationActive={false}\n            />\n            {/* Lower bound line (dashed) */}\n            <Line\n              type=\"monotone\"\n              dataKey=\"lower\"\n              stroke=\"#C4B5FD\"\n              strokeWidth={1}\n              strokeDasharray=\"4 4\"\n              dot={false}\n              isAnimationActive={false}\n            />\n            {/* Upper bound line (dashed) */}\n            <Line\n              type=\"monotone\"\n              dataKey=\"upper\"\n              stroke=\"#C4B5FD\"\n              strokeWidth={1}\n              strokeDasharray=\"4 4\"\n              dot={false}\n              isAnimationActive={false}\n            />\n            {/* Predicted value line */}\n            <Line\n              type=\"monotone\"\n              dataKey=\"predicted\"\n              stroke=\"#7C3AED\"\n              strokeWidth={2}\n              dot={false}\n              activeDot={{\n                r: 4,\n                fill: \"#7C3AED\",\n                stroke: \"#fff\",\n                strokeWidth: 2,\n              }}\n              isAnimationActive={false}\n            />\n          </ComposedChart>\n        </ResponsiveContainer>\n      </div>\n\n      {/* Summary Statistics */}\n      {summary && summary.status === \"success\" && (\n        <div className=\"mt-4 grid grid-cols-4 gap-3 rounded-lg bg-purple-50 p-3\">\n          <div className=\"text-center\">\n            <p className=\"text-xs text-gray-500\">Mean/Day</p>\n            <p className=\"text-sm font-semibold text-purple-700\">\n              {summary.mean_predicted_violations?.toFixed(1) || \"N/A\"}\n            </p>\n          </div>\n          <div className=\"text-center\">\n            <p className=\"text-xs text-gray-500\">Max</p>\n            <p className=\"text-sm font-semibold text-purple-700\">\n              {summary.max_predicted_violations?.toFixed(1) || \"N/A\"}\n            </p>\n          </div>\n          <div className=\"text-center\">\n            <p className=\"text-xs text-gray-500\">Min</p>\n            <p className=\"text-sm font-semibold text-purple-700\">\n              {summary.min_predicted_violations?.toFixed(1) || \"N/A\"}\n            </p>\n          </div>\n          <div className=\"text-center\">\n            <p className=\"text-xs text-gray-500\">Total</p>\n            <p className=\"text-sm font-semibold text-purple-700\">\n              {summary.total_predicted_violations?.toFixed(0) || \"N/A\"}\n            </p>\n          </div>\n        </div>\n      )}\n\n      {/* Footer with metadata */}\n      <div className=\"mt-4 flex items-center justify-between border-t border-gray-100 pt-3 text-xs text-gray-500\">\n        <div className=\"flex items-center gap-4\">\n          <span>\n            Forecast:{\" \"}\n            <span className=\"font-medium text-gray-700\">\n              {data?.forecast_days || 0} days\n            </span>\n          </span>\n          <span>\n            Training:{\" \"}\n            <span className=\"font-medium text-gray-700\">\n              {data?.historical_days || 0} days\n            </span>\n          </span>\n          {trendDirection && (\n            <span className=\"flex items-center gap-1\">\n              Trend:{\" \"}\n              <span className={`font-medium capitalize ${getTrendColor(trendDirection)}`}>\n                {trendDirection}\n              </span>\n            </span>\n          )}\n        </div>\n        {data?.forecast_timestamp && (\n          <span title={data.forecast_timestamp}>\n            {formatTimestamp(data.forecast_timestamp)}\n          </span>\n        )}\n      </div>\n    </div>\n  );\n});\n\nexport default PredictionWidget;\n",
        "timestamp": "2026-01-04T05:36:13.611399"
      },
      "worktree_state": null,
      "task_intent": {
        "title": "052-replace-recharts-with-lightweight-chart-library",
        "description": "Replace recharts (~500KB unparsed, ~150KB gzipped) with a lightweight charting library like visx (~40KB) or uPlot (~30KB) to reduce bundle size and improve dashboard performance. Used in PredictionWidget (analytics-dashboard) and MetricsChart (observability dashboard).",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-03T18:35:24.592055",
  "last_updated": "2026-01-04T05:36:13.661884"
}