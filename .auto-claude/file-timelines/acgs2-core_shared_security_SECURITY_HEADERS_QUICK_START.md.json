{
  "file_path": "src/core/shared/security/SECURITY_HEADERS_QUICK_START.md",
  "main_branch_history": [],
  "task_views": {
    "046-add-security-headers-middleware-to-fastapi-service": {
      "task_id": "046-add-security-headers-middleware-to-fastapi-service",
      "branch_point": {
        "commit_hash": "4a99fe22e8e0087919301b1aa185d4e2c6da716c",
        "content": "",
        "timestamp": "2026-01-03T19:07:31.669524"
      },
      "worktree_state": {
        "content": "# Security Headers Middleware - Quick Start Guide\n\n> **Constitutional Hash**: `cdd01ef066bc6cf2`\n\n## 5-Minute Integration Guide\n\n### Step 1: Import the Middleware\n\n```python\nfrom shared.security import SecurityHeadersConfig, SecurityHeadersMiddleware\n```\n\n### Step 2: Choose Your Configuration\n\n```python\n# For most production services\nconfig = SecurityHeadersConfig.for_production()\n\n# For services with webhooks/external APIs\nconfig = SecurityHeadersConfig.for_integration_service()\n\n# For services with WebSocket connections\nconfig = SecurityHeadersConfig.for_websocket_service()\n\n# For development/local testing\nconfig = SecurityHeadersConfig.for_development()\n```\n\n### Step 3: Add to FastAPI App (AFTER CORS)\n\n```python\nfrom fastapi import FastAPI\nfrom fastapi.middleware.cors import CORSMiddleware\n\napp = FastAPI()\n\n# 1. CORS first\napp.add_middleware(CORSMiddleware, allow_origins=[\"*\"], ...)\n\n# 2. Security headers second\napp.add_middleware(SecurityHeadersMiddleware, config=config)\n```\n\n### Step 4: Verify with cURL\n\n```bash\ncurl -I http://localhost:8000/health | grep -i \"x-content-type\\|x-frame\\|x-xss\\|strict-transport\\|content-security\\|referrer\"\n```\n\nYou should see all 6 headers:\n- `Content-Security-Policy`\n- `X-Content-Type-Options: nosniff`\n- `X-Frame-Options: DENY`\n- `Strict-Transport-Security`\n- `X-XSS-Protection: 1; mode=block`\n- `Referrer-Policy: strict-origin-when-cross-origin`\n\n## Complete Example\n\n```python\nimport os\nfrom fastapi import FastAPI\nfrom fastapi.middleware.cors import CORSMiddleware\nfrom shared.security import SecurityHeadersConfig, SecurityHeadersMiddleware\n\napp = FastAPI(title=\"My Service\")\n\n# CORS middleware\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=[\"*\"],\n    allow_credentials=True,\n    allow_methods=[\"*\"],\n    allow_headers=[\"*\"],\n)\n\n# Security headers middleware\nenvironment = os.getenv(\"APP_ENV\", \"production\")\nif environment == \"development\":\n    security_config = SecurityHeadersConfig.for_development()\nelse:\n    security_config = SecurityHeadersConfig.for_production()\n\napp.add_middleware(SecurityHeadersMiddleware, config=security_config)\n\n@app.get(\"/health\")\nasync def health():\n    return {\"status\": \"healthy\"}\n```\n\n## Testing\n\n```bash\n# Run tests\ncd src/core\npytest shared/security/tests/test_security_headers.py -v\n\n# Run your service integration tests\npytest tests/test_security_headers.py -v\n```\n\n## Custom CSP Example\n\n```python\n# Allow external CDN\ncustom_csp = {\n    \"script-src\": [\"'self'\", \"https://cdn.example.com\"],\n    \"img-src\": [\"'self'\", \"data:\", \"https://images.example.com\"]\n}\n\nconfig = SecurityHeadersConfig(\n    environment=\"production\",\n    custom_csp_directives=custom_csp\n)\n```\n\n## Troubleshooting\n\n**Headers not appearing?**\n- Check middleware is AFTER CORS\n- Verify import path is correct\n- Check FastAPI startup logs\n\n**CSP blocking resources?**\n- Check browser console for violations\n- Add required sources to custom_csp_directives\n- Use for_websocket_service() for WebSocket apps\n\n**Can't access localhost HTTP?**\n- Use for_development() to disable HSTS\n- Set environment to \"development\"\n\n## Full Documentation\n\nSee [src/core/docs/security/SECURITY_HEADERS.md](../../docs/security/SECURITY_HEADERS.md) for:\n- Complete configuration options\n- Environment-specific behavior\n- Custom CSP directives\n- Testing approach\n- Verification checklist\n- Troubleshooting guide\n\n## Questions?\n\nContact the ACGS-2 Security Team or refer to:\n- Full docs: `src/core/docs/security/SECURITY_HEADERS.md`\n- Source code: `src/core/shared/security/security_headers.py`\n- Tests: `src/core/shared/security/tests/test_security_headers.py`\n",
        "last_modified": "2026-01-03T19:08:32.488296"
      },
      "task_intent": {
        "title": "046-add-security-headers-middleware-to-fastapi-service",
        "description": "Multiple FastAPI services (integration-service, compliance-docs, observability dashboard) lack security headers middleware. Missing headers include Content-Security-Policy, X-Content-Type-Options, X-Frame-Options, Strict-Transport-Security, X-XSS-Protection, and Referrer-Policy.",
        "from_plan": true
      },
      "commits_behind_main": 11,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-03T19:07:31.738109",
  "last_updated": "2026-01-03T19:07:31.741314"
}