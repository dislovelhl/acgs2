{
  "file_path": "claude-flow/src/commands/agent.ts",
  "main_branch_history": [],
  "task_views": {
    "059-add-jsdoc-coverage-for-claude-flow-typescript-serv": {
      "task_id": "059-add-jsdoc-coverage-for-claude-flow-typescript-serv",
      "branch_point": {
        "commit_hash": "fc6e42927298263034acf989773f3200e422ad17",
        "content": "/**\n * Agent Command Module\n *\n * This module provides CLI commands for managing individual agents in ACGS-2 swarms, including:\n * - Spawning new agents with specific types and skills\n * - Listing active agents with filtering capabilities\n * - Managing agent lifecycle and configurations\n *\n * @module agent\n */\n\nimport { Command } from 'commander';\nimport chalk from 'chalk';\nimport ora from 'ora';\nimport { spawnAgent, listAgents } from '../services/agentService';\nimport { getLogger } from '../../../sdk/typescript/src/utils/logger';\nconst logger = getLogger('agent');\n\n/**\n * Main agent command that provides subcommands for agent management.\n * Use this command to spawn, list, and manage individual agents in the swarm.\n *\n * Available subcommands:\n * - spawn: Create and spawn a new agent with specified type and skills\n * - list: Display all active agents with optional filtering\n *\n * @example\n * ```bash\n * # Spawn a coder agent with custom name\n * npx claude-flow agent spawn --type coder --name my-coder\n *\n * # Spawn a researcher with specific skills\n * npx claude-flow agent spawn --type researcher --skills \"ml,nlp,data-analysis\"\n *\n * # List all active agents\n * npx claude-flow agent list --verbose\n *\n * # Filter agents by type\n * npx claude-flow agent list --type coder\n * ```\n */\nexport const agentCommand = new Command('agent')\n  .description('Manage agents in the swarm');\n\n// Valid agent types\nconst VALID_AGENT_TYPES = ['coder', 'researcher', 'analyst', 'tester', 'coordinator'] as const;\n\n/**\n * Valid agent type classifications.\n *\n * - coder: Software development and code implementation (\ud83d\udc68\u200d\ud83d\udcbb)\n * - researcher: Information gathering and research tasks (\ud83d\udd2c)\n * - analyst: Data analysis and insights generation (\ud83d\udcca)\n * - tester: Quality assurance and testing (\ud83e\uddea)\n * - coordinator: Task coordination and orchestration (\ud83c\udfaf)\n */\ntype AgentType = typeof VALID_AGENT_TYPES[number];\n\n/**\n * Validates if a string is a valid agent type.\n *\n * @param type - The agent type string to validate\n * @returns True if the type is valid (coder, researcher, analyst, tester, or coordinator)\n *\n * @example\n * ```typescript\n * if (validateAgentType('coder')) {\n *   console.log('Valid agent type');\n * }\n * ```\n */\nfunction validateAgentType(type: string): type is AgentType {\n  return VALID_AGENT_TYPES.includes(type as AgentType);\n}\n\n/**\n * Validates and parses a comma-separated skills string into a normalized array.\n * Trims whitespace, removes empty entries, and converts to lowercase.\n *\n * @param skills - Comma-separated skills string\n * @returns Array of normalized skill strings, or empty array if input is empty\n *\n * @example\n * ```typescript\n * const skills = validateSkills('Python, JavaScript, Machine Learning');\n * // Returns: ['python', 'javascript', 'machine learning']\n *\n * const empty = validateSkills('');\n * // Returns: []\n * ```\n */\nfunction validateSkills(skills: string): string[] {\n  if (!skills || skills.trim() === '') {\n    return [];\n  }\n\n  return skills.split(',')\n    .map(skill => skill.trim())\n    .filter(skill => skill.length > 0)\n    .map(skill => skill.toLowerCase());\n}\n\n/**\n * Returns the emoji icon associated with a given agent type.\n *\n * @param type - The agent type\n * @returns The emoji string for the agent type, or default robot emoji if unknown\n *\n * @example\n * ```typescript\n * const emoji = getAgentEmoji('coder');\n * // Returns: '\ud83d\udc68\u200d\ud83d\udcbb'\n *\n * const fallback = getAgentEmoji('unknown');\n * // Returns: '\ud83e\udd16'\n * ```\n */\nfunction getAgentEmoji(type: string): string {\n  const emojiMap: Record<string, string> = {\n    coder: '\ud83d\udc68\u200d\ud83d\udcbb',\n    researcher: '\ud83d\udd2c',\n    analyst: '\ud83d\udcca',\n    tester: '\ud83e\uddea',\n    coordinator: '\ud83c\udfaf'\n  };\n  return emojiMap[type] || '\ud83e\udd16';\n}\n\n/**\n * Generates a unique agent name based on type and timestamp, or returns the custom name if provided.\n * Auto-generated names use the format: `{type}-{timestamp}-{random}`.\n *\n * @param type - The agent type\n * @param customName - Optional custom name provided by user\n * @returns The agent name (custom if provided, otherwise auto-generated)\n *\n * @example\n * ```typescript\n * const custom = generateAgentName('coder', 'my-special-coder');\n * // Returns: 'my-special-coder'\n *\n * const auto = generateAgentName('coder');\n * // Returns: 'coder-lx4h2k-9f3k1' (example)\n * ```\n */\nfunction generateAgentName(type: AgentType, customName?: string): string {\n  if (customName && customName.trim()) {\n    return customName.trim();\n  }\n\n  // Generate a unique name based on type and timestamp\n  const timestamp = Date.now().toString(36);\n  const random = Math.random().toString(36).substr(2, 5);\n  return `${type}-${timestamp}-${random}`;\n}\n\nconst spawnCommand = new Command('spawn')\n  .description('Spawn a new agent in the current swarm')\n  .requiredOption('-t, --type <type>', `Agent type (${VALID_AGENT_TYPES.join(', ')})`, 'coder')\n  .option('-n, --name <name>', 'Custom agent name')\n  .option('-s, --skills <skills>', 'Specific skills (comma-separated)')\n  .action(async (options) => {\n    const spinner = ora('Validating options...').start();\n\n        logger.info(chalk.yellow(`\\n\ud83d\udccb Valid types: ${VALID_AGENT_TYPES.join(', ')}`);\n        logger.info(chalk.gray(`\\nExample: npx claude-flow agent spawn --type coder`);\n      if (!validateAgentType(options.type)) {\n        spinner.fail(chalk.red(`\u274c Invalid agent type: ${options.type}`));\n        logger.warn('invalid_agent_type', { type: options.type });\n        cliOutput(chalk.yellow(`\\n\ud83d\udccb Valid types: ${VALID_AGENT_TYPES.join(', ')}`));\n        cliOutput(chalk.gray(`\\nExample: npx claude-flow agent spawn --type coder`));\n        process.exit(1);\n      }\n\n      // Validate and parse skills\n      const skills = validateSkills(options.skills || '');\n\n      // Generate or validate agent name\n      const agentName = generateAgentName(options.type, options.name);\n        logger.info(chalk.yellow(`\\n\ud83d\udca1 Agent names must be at least 3 characters long`);\n      // Validate agent name\n      if (agentName.length < 3) {\n        spinner.fail(chalk.red(`\u274c Agent name too short: ${agentName}`));\n        logger.warn('agent_name_too_short', { name: agentName });\n        cliOutput(chalk.yellow(`\\n\ud83d\udca1 Agent names must be at least 3 characters long`));\n        process.exit(1);\n        logger.info(chalk.yellow(`\\n\ud83d\udca1 Agent names must be less than 50 characters`);\n\n      if (agentName.length > 50) {\n        spinner.fail(chalk.red(`\u274c Agent name too long: ${agentName}`));\n        logger.warn('agent_name_too_long', { name: agentName });\n        cliOutput(chalk.yellow(`\\n\ud83d\udca1 Agent names must be less than 50 characters`));\n        process.exit(1);\n      }\n        logger.info(chalk.yellow(`\\n\ud83d\udca1 Agent names can only contain letters, numbers, hyphens, and underscores`);\n      // Check for invalid characters in name\n      if (!/^[a-zA-Z0-9\\-_]+$/.test(agentName)) {\n        spinner.fail(chalk.red(`\u274c Invalid characters in agent name: ${agentName}`));\n        logger.warn('agent_name_invalid_chars', { name: agentName });\n        cliOutput(chalk.yellow(`\\n\ud83d\udca1 Agent names can only contain letters, numbers, hyphens, and underscores`));\n        process.exit(1);\n      }\n\n      spinner.text = 'Connecting to ACGS-2 bus...';\n      logger.info('spawn_agent_started', { type: options.type, name: agentName, skills });\n\n      // Spawn the agent\n      const result = await spawnAgent({\n        name: agentName,\n        type: options.type,\n        skills: skills\n      });\n        logger.info(chalk.blue(`\\n\ud83e\udd16 Agent Details:`);\n        logger.info(chalk.gray(`   ID: ${result.agentId}`);\n        logger.info(chalk.gray(`   Type: ${options.type}`);\n        logger.info(chalk.gray(`   Name: ${agentName}`);\n        console.log(chalk.blue(`\\n\ud83e\udd16 Agent Details:`));\n          logger.info(chalk.gray(`   Skills: ${skills.join(', ')}`);\n        console.log(chalk.gray(`   Type: ${options.type}`));\n        console.log(chalk.gray(`   Name: ${agentName}`));\n        logger.info(chalk.green(`\\n\ud83d\ude80 Agent is now active in the swarm!`);\n          console.log(chalk.gray(`   Skills: ${skills.join(', ')}`));\n        }\n        logger.info(chalk.red(`\\nError: ${result.error}`);\n        logger.info(chalk.yellow(`\\n\ud83d\udca1 Make sure the ACGS-2 system is running and accessible`);\n      } else {\n        spinner.fail(chalk.red(`\u274c Failed to spawn agent`));\n        logger.error('spawn_agent_failed', { error: result.error });\n        cliOutput(chalk.red(`\\nError: ${result.error}`));\n        cliOutput(chalk.yellow(`\\n\ud83d\udca1 Make sure the ACGS-2 system is running and accessible`));\n        process.exit(1);\n      }\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : String(error);\n        logger.info(chalk.yellow(`\\n\ud83d\udca1 Make sure Python 3 is installed and available in PATH`);\n\n        logger.info(chalk.yellow(`\\n\ud83d\udca1 Make sure the ACGS-2 core is properly installed`);\n      if (errorMessage.includes('python3')) {\n        cliOutput(chalk.yellow(`\\n\ud83d\udca1 Make sure Python 3 is installed and available in PATH`));\n      } else if (errorMessage.includes('EnhancedAgentBus')) {\n        cliOutput(chalk.yellow(`\\n\ud83d\udca1 Make sure the ACGS-2 core is properly installed`));\n      }\n\n      process.exit(1);\n    }\n  });\n\nconst listCommand = new Command('list')\n  .description('List all active agents in the swarm')\n  .option('-t, --type <type>', `Filter by agent type (${VALID_AGENT_TYPES.join(', ')})`)\n  .option('-v, --verbose', 'Show detailed agent information', false)\n  .action(async (options) => {\n    const spinner = ora('Retrieving agent list...').start();\n\n        logger.info(chalk.yellow(`\\n\ud83d\udccb Valid types: ${VALID_AGENT_TYPES.join(', ')}`);\n      // Validate filter type if provided\n      if (options.type && !validateAgentType(options.type)) {\n        spinner.fail(chalk.red(`\u274c Invalid agent type filter: ${options.type}`));\n        logger.warn('invalid_agent_type_filter', { type: options.type });\n        cliOutput(chalk.yellow(`\\n\ud83d\udccb Valid types: ${VALID_AGENT_TYPES.join(', ')}`));\n        process.exit(1);\n      }\n\n        logger.info(chalk.gray(`\\n\ud83d\udca1 Spawn agents first: npx claude-flow agent spawn --type coder`);\n\n      if (!agents || agents.length === 0) {\n        spinner.warn(chalk.yellow(`\u26a0\ufe0f  No active agents found in the swarm`));\n        logger.info('no_agents_found');\n        cliOutput(chalk.gray(`\\n\ud83d\udca1 Spawn agents first: npx claude-flow agent spawn --type coder`));\n        return;\n      }\n\n      // Filter agents by type if specified\n      let filteredAgents = agents;\n      if (options.type) {\n        filteredAgents = agents.filter(agent => agent.type === options.type);\n      logger.info(chalk.blue(`\\n\ud83e\udd16 Active Agents:`);\n\n      spinner.succeed(chalk.green(`\u2705 Found ${filteredAgents.length} agent${filteredAgents.length !== 1 ? 's' : ''}`));\n      logger.info('agents_found', { count: filteredAgents.length, total: agents.length });\n\n      cliOutput(chalk.blue(`\\n\ud83e\udd16 Active Agents:`));\n\n        logger.info(chalk.gray(`${index + 1}. ${agentEmoji} ${agent.name || agent.id} (${agent.type}) ${statusEmoji}`);\n        const agentEmoji = getAgentEmoji(agent.type);\n        const statusEmoji = agent.status === 'active' ? '\ud83d\udfe2' : agent.status === 'busy' ? '\ud83d\udfe1' : '\ud83d\udd34';\n          logger.info(chalk.gray(`   ID: ${agent.id}`);\n          logger.info(chalk.gray(`   Status: ${agent.status}`);\n\n            logger.info(chalk.gray(`   Skills: ${agent.capabilities.join(', ')}`);\n          console.log(chalk.gray(`   ID: ${agent.id}`));\n          console.log(chalk.gray(`   Status: ${agent.status}`));\n          if (agent.capabilities && agent.capabilities.length > 0) {\n            logger.info(chalk.gray(`   Created: ${created.toLocaleString()}`);\n          }\n          if (agent.created_at) {\n            const created = new Date(agent.created_at);\n            logger.info(chalk.gray(`   Last Active: ${lastActive.toLocaleString()}`);\n          }\n          if (agent.last_active) {\n            const lastActive = new Date(agent.last_active);\n            cliOutput(chalk.gray(`   Last Active: ${lastActive.toLocaleString()}`));\n          }\n          console.log();\n        logger.info(chalk.yellow(`\\n\u26a0\ufe0f  No agents found with type: ${options.type}`);\n      });\n\n      logger.info(chalk.blue(`\\n\ud83d\udcca Summary:`);\n      logger.info(chalk.gray(`   Total Agents: ${agents.length}`);\n      }\n        logger.info(chalk.gray(`   Filtered by type: ${options.type}`);\n      console.log(chalk.blue(`\\n\ud83d\udcca Summary:`));\n      console.log(chalk.gray(`   Total Agents: ${agents.length}`));\n      if (options.type) {\n        cliOutput(chalk.gray(`   Filtered by type: ${options.type}`));\n      }\n\n      // Show type breakdown\n      const typeCounts = agents.reduce((acc, agent) => {\n      logger.info(chalk.gray(`   By Type: ${Object.entries(typeCounts).map(([type, count]) => `${type}: ${count}`).join(', ')}`);\n        return acc;\n      }, {});\n\n      cliOutput(chalk.gray(`   By Type: ${Object.entries(typeCounts).map(([type, count]) => `${type}: ${count}`).join(', ')}`));\n\n    } catch (error) {\n        logger.info(chalk.yellow(`\\n\ud83d\udca1 Make sure Python 3 is installed and available in PATH`);\n      spinner.fail(chalk.red(`\u274c Failed to list agents: ${errorMessage}`));\n        logger.info(chalk.yellow(`\\n\ud83d\udca1 Make sure the ACGS-2 core is properly installed`);\n      if (errorMessage.includes('python3')) {\n        cliOutput(chalk.yellow(`\\n\ud83d\udca1 Make sure Python 3 is installed and available in PATH`));\n      } else if (errorMessage.includes('EnhancedAgentBus')) {\n        cliOutput(chalk.yellow(`\\n\ud83d\udca1 Make sure the ACGS-2 core is properly installed`));\n      }\n    }\n  });\n\nagentCommand.addCommand(spawnCommand);\nagentCommand.addCommand(listCommand);\n",
        "timestamp": "2026-01-04T05:35:52.969195"
      },
      "worktree_state": null,
      "task_intent": {
        "title": "Add JSDoc coverage for claude-flow TypeScript service public exports",
        "description": "Add comprehensive JSDoc documentation to the 45 exported functions/classes across 17 TypeScript files in the claude-flow CLI tool to improve API documentation for enterprise users",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-04T05:35:53.084057",
  "last_updated": "2026-01-04T05:35:53.088003"
}