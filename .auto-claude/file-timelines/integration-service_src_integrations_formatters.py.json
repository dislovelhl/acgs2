{
  "file_path": "integration-service/src/integrations/formatters.py",
  "main_branch_history": [],
  "task_views": {
    "056-reduce-excessive-any-type-usage-in-python-codebase": {
      "task_id": "056-reduce-excessive-any-type-usage-in-python-codebase",
      "branch_point": {
        "commit_hash": "fc6e42927298263034acf989773f3200e422ad17",
        "content": "\"\"\"\nSIEM Event Formatter\n\nProvides standardized JSON payload formatting for SIEM integrations.\nSupports formatting governance events for Splunk HEC and Microsoft Sentinel\nwith consistent field mapping and severity translation.\n\nFeatures:\n- Standardized event payload structure\n- SIEM-specific formatting (Splunk, Sentinel)\n- Configurable field mappings\n- CEF (Common Event Format) output option\n- Severity normalization across platforms\n- JSON serialization utilities\n\"\"\"\n\nimport json\nimport logging\nfrom datetime import datetime, timezone\nfrom enum import Enum\nfrom typing import Dict, List, Optional, Union\n\nfrom pydantic import BaseModel, Field\n\nfrom ..types import EventData, JSONDict, ModelContext\nfrom .base import EventSeverity, IntegrationEvent\n\nlogger = logging.getLogger(__name__)\n\n\nclass SIEMFormat(str, Enum):\n    \"\"\"Supported SIEM output formats\"\"\"\n\n    SPLUNK = \"splunk\"\n    SENTINEL = \"sentinel\"\n    CEF = \"cef\"  # Common Event Format\n    JSON = \"json\"  # Generic standardized JSON\n\n\nclass SeverityLevel(int, Enum):\n    \"\"\"Numeric severity levels (1=Critical to 5=Info)\"\"\"\n\n    CRITICAL = 1\n    HIGH = 2\n    MEDIUM = 3\n    LOW = 4\n    INFO = 5\n\n\n# Severity mappings\nSEVERITY_TO_LEVEL: Dict[EventSeverity, int] = {\n    EventSeverity.CRITICAL: SeverityLevel.CRITICAL,\n    EventSeverity.HIGH: SeverityLevel.HIGH,\n    EventSeverity.MEDIUM: SeverityLevel.MEDIUM,\n    EventSeverity.LOW: SeverityLevel.LOW,\n    EventSeverity.INFO: SeverityLevel.INFO,\n}\n\nSEVERITY_TO_NAME: Dict[EventSeverity, str] = {\n    EventSeverity.CRITICAL: \"Critical\",\n    EventSeverity.HIGH: \"High\",\n    EventSeverity.MEDIUM: \"Medium\",\n    EventSeverity.LOW: \"Low\",\n    EventSeverity.INFO: \"Informational\",\n}\n\n# CEF severity mapping (0-10 scale)\nSEVERITY_TO_CEF: Dict[EventSeverity, int] = {\n    EventSeverity.CRITICAL: 10,\n    EventSeverity.HIGH: 8,\n    EventSeverity.MEDIUM: 5,\n    EventSeverity.LOW: 3,\n    EventSeverity.INFO: 1,\n}\n\n\nclass StandardizedSIEMEvent(BaseModel):\n    \"\"\"\n    Standardized SIEM event payload structure.\n\n    This model provides a consistent event format that can be transformed\n    into SIEM-specific formats (Splunk, Sentinel, CEF).\n    \"\"\"\n\n    # Timing\n    timestamp: datetime = Field(\n        default_factory=lambda: datetime.now(timezone.utc),\n        description=\"Event timestamp in UTC\",\n    )\n    time_epoch: Optional[float] = Field(\n        None,\n        description=\"Unix epoch timestamp (auto-calculated from timestamp)\",\n    )\n\n    # Event identification\n    event_id: str = Field(..., description=\"Unique event identifier\")\n    event_type: str = Field(..., description=\"Type of governance event\")\n    event_category: str = Field(\n        default=\"governance\",\n        description=\"Event category for SIEM classification\",\n    )\n\n    # Severity\n    severity: str = Field(..., description=\"Severity level name (Critical, High, etc.)\")\n    severity_level: int = Field(\n        ...,\n        ge=1,\n        le=5,\n        description=\"Numeric severity (1=Critical to 5=Info)\",\n    )\n\n    # Source information\n    source: str = Field(default=\"acgs2\", description=\"Source system identifier\")\n    source_type: str = Field(\n        default=\"governance:event\",\n        description=\"Source type for event classification\",\n    )\n    host: str = Field(\n        default=\"acgs2-integration-service\",\n        description=\"Originating host\",\n    )\n\n    # Event content\n    title: str = Field(..., description=\"Event title/summary\")\n    description: Optional[str] = Field(None, description=\"Detailed description\")\n    message: str = Field(..., description=\"Human-readable event message\")\n\n    # Governance context\n    policy_id: Optional[str] = Field(None, description=\"Related policy ID\")\n    policy_name: Optional[str] = Field(None, description=\"Related policy name\")\n    resource_id: Optional[str] = Field(None, description=\"Affected resource ID\")\n    resource_type: Optional[str] = Field(None, description=\"Type of affected resource\")\n    resource_name: Optional[str] = Field(None, description=\"Name of affected resource\")\n    action: Optional[str] = Field(None, description=\"Action that triggered the event\")\n    outcome: Optional[str] = Field(None, description=\"Outcome of the action (success/failure)\")\n\n    # Actor information\n    user_id: Optional[str] = Field(None, description=\"User who triggered the event\")\n    user_name: Optional[str] = Field(None, description=\"Username of actor\")\n    user_email: Optional[str] = Field(None, description=\"Email of actor\")\n\n    # Multi-tenancy and correlation\n    tenant_id: Optional[str] = Field(None, description=\"Tenant ID for multi-tenant deployments\")\n    correlation_id: Optional[str] = Field(None, description=\"Correlation ID for tracing\")\n    session_id: Optional[str] = Field(None, description=\"Session ID if applicable\")\n\n    # Classification\n    tags: List[str] = Field(default_factory=list, description=\"Event tags\")\n    labels: Dict[str, str] = Field(default_factory=dict, description=\"Key-value labels\")\n\n    # Extended details\n    details: EventData = Field(\n        default_factory=dict,\n        description=\"Additional event details\",\n    )\n    raw_event: Optional[JSONDict] = Field(\n        None,\n        description=\"Original raw event data\",\n    )\n\n    def model_post_init(self, __context: ModelContext) -> None:\n        \"\"\"Calculate derived fields after initialization\"\"\"\n        if self.time_epoch is None:\n            self.time_epoch = self.timestamp.timestamp()\n\n\nclass SplunkEventConfig(BaseModel):\n    \"\"\"Configuration for Splunk event formatting\"\"\"\n\n    index: str = Field(default=\"main\", description=\"Target Splunk index\")\n    source: str = Field(default=\"acgs2\", description=\"Source identifier\")\n    sourcetype: str = Field(\n        default=\"acgs2:governance\",\n        description=\"Sourcetype for events\",\n    )\n    host: str = Field(\n        default=\"acgs2-integration-service\",\n        description=\"Originating host\",\n    )\n    include_raw_event: bool = Field(\n        default=False,\n        description=\"Whether to include raw event data\",\n    )\n\n\nclass SentinelEventConfig(BaseModel):\n    \"\"\"Configuration for Sentinel event formatting\"\"\"\n\n    stream_name: str = Field(\n        default=\"Custom-GovernanceEvents_CL\",\n        description=\"Target Log Analytics stream\",\n    )\n    include_raw_event: bool = Field(\n        default=False,\n        description=\"Whether to include raw event data\",\n    )\n\n\nclass CEFEventConfig(BaseModel):\n    \"\"\"Configuration for CEF event formatting\"\"\"\n\n    vendor: str = Field(default=\"ACGS2\", description=\"Vendor name\")\n    product: str = Field(\n        default=\"Governance Platform\",\n        description=\"Product name\",\n    )\n    version: str = Field(default=\"1.0\", description=\"Product version\")\n    device_event_class_id: str = Field(\n        default=\"governance\",\n        description=\"Device event class ID\",\n    )\n\n\ndef format_siem_event(\n    event: Union[IntegrationEvent, JSONDict],\n    format_type: SIEMFormat = SIEMFormat.JSON,\n    config: Optional[Union[SplunkEventConfig, SentinelEventConfig, CEFEventConfig]] = None,\n) -> JSONDict:\n    \"\"\"\n    Format a governance event for SIEM ingestion.\n\n    This is the main entry point for formatting events for various SIEM platforms.\n    It converts an IntegrationEvent or dict into a standardized format suitable\n    for the target SIEM system.\n\n    Args:\n        event: The governance event to format (IntegrationEvent or dict)\n        format_type: Target SIEM format (splunk, sentinel, cef, json)\n        config: Optional SIEM-specific configuration\n\n    Returns:\n        Formatted event dictionary ready for SIEM submission\n\n    Examples:\n        >>> event = IntegrationEvent(\n        ...     event_type=\"policy_violation\",\n        ...     title=\"Policy Violation Detected\",\n        ...     severity=EventSeverity.HIGH,\n        ... )\n        >>> formatted = format_siem_event(event, SIEMFormat.SPLUNK)\n        >>> formatted = format_siem_event(event, SIEMFormat.SENTINEL)\n    \"\"\"\n    # Convert dict to IntegrationEvent if needed\n    if isinstance(event, dict):\n        event = _dict_to_integration_event(event)\n\n    # Create standardized event\n    standardized = _to_standardized_event(event)\n\n    # Format for target SIEM\n    if format_type == SIEMFormat.SPLUNK:\n        splunk_config = config if isinstance(config, SplunkEventConfig) else SplunkEventConfig()\n        return format_splunk_event(standardized, splunk_config)\n    elif format_type == SIEMFormat.SENTINEL:\n        sentinel_config = (\n            config if isinstance(config, SentinelEventConfig) else SentinelEventConfig()\n        )\n        return format_sentinel_event(standardized, sentinel_config)\n    elif format_type == SIEMFormat.CEF:\n        cef_config = config if isinstance(config, CEFEventConfig) else CEFEventConfig()\n        return format_cef_event(standardized, cef_config)\n    else:\n        return format_json_event(standardized)\n\n\ndef format_splunk_event(\n    event: StandardizedSIEMEvent,\n    config: Optional[SplunkEventConfig] = None,\n) -> JSONDict:\n    \"\"\"\n    Format an event for Splunk HEC submission.\n\n    Creates a Splunk HEC-compatible JSON payload with proper field mapping\n    and metadata for the event.\n\n    Args:\n        event: Standardized SIEM event\n        config: Splunk-specific configuration\n\n    Returns:\n        Dictionary formatted for Splunk HEC endpoint\n    \"\"\"\n    if config is None:\n        config = SplunkEventConfig()\n\n    # Build the event payload\n    event_data = {\n        # Core event fields\n        \"event_id\": event.event_id,\n        \"event_type\": event.event_type,\n        \"event_category\": event.event_category,\n        \"severity\": event.severity,\n        \"severity_level\": event.severity_level,\n        \"source_system\": event.source,\n        # Content\n        \"title\": event.title,\n        \"description\": event.description,\n        \"message\": event.message,\n        # Governance context\n        \"policy_id\": event.policy_id,\n        \"policy_name\": event.policy_name,\n        \"resource_id\": event.resource_id,\n        \"resource_type\": event.resource_type,\n        \"resource_name\": event.resource_name,\n        \"action\": event.action,\n        \"outcome\": event.outcome,\n        # Actor\n        \"user_id\": event.user_id,\n        \"user_name\": event.user_name,\n        \"user_email\": event.user_email,\n        # Correlation\n        \"tenant_id\": event.tenant_id,\n        \"correlation_id\": event.correlation_id,\n        \"session_id\": event.session_id,\n        # Classification\n        \"tags\": event.tags,\n        \"labels\": event.labels,\n    }\n\n    # Add extended details\n    if event.details:\n        event_data.update(event.details)\n\n    # Optionally include raw event\n    if config.include_raw_event and event.raw_event:\n        event_data[\"raw_event\"] = event.raw_event\n\n    # Remove None values for cleaner Splunk indexing\n    event_data = {k: v for k, v in event_data.items() if v is not None}\n\n    # Build HEC payload\n    splunk_payload = {\n        \"event\": event_data,\n        \"time\": event.time_epoch,\n        \"source\": config.source,\n        \"sourcetype\": config.sourcetype,\n        \"index\": config.index,\n        \"host\": config.host,\n    }\n\n    return splunk_payload\n\n\ndef format_sentinel_event(\n    event: StandardizedSIEMEvent,\n    config: Optional[SentinelEventConfig] = None,\n) -> JSONDict:\n    \"\"\"\n    Format an event for Azure Monitor Logs Ingestion API.\n\n    Creates an Azure Monitor-compatible JSON payload with proper field mapping\n    for Log Analytics custom tables.\n\n    Args:\n        event: Standardized SIEM event\n        config: Sentinel-specific configuration\n\n    Returns:\n        Dictionary formatted for Azure Monitor Logs Ingestion\n    \"\"\"\n    if config is None:\n        config = SentinelEventConfig()\n\n    # TimeGenerated is required by Azure Monitor and must be ISO 8601 format\n    sentinel_event = {\n        # Required field - must be ISO 8601 format\n        \"TimeGenerated\": event.timestamp.strftime(\"%Y-%m-%dT%H:%M:%SZ\"),\n        # Core event fields\n        \"EventId\": event.event_id,\n        \"EventType\": event.event_type,\n        \"EventCategory\": event.event_category,\n        \"Severity\": event.severity,\n        \"SeverityLevel\": event.severity_level,\n        \"Source\": event.source,\n        # Content\n        \"Title\": event.title,\n        \"Description\": event.description or \"\",\n        \"Message\": event.message,\n        # Governance context\n        \"PolicyId\": event.policy_id or \"\",\n        \"PolicyName\": event.policy_name or \"\",\n        \"ResourceId\": event.resource_id or \"\",\n        \"ResourceType\": event.resource_type or \"\",\n        \"ResourceName\": event.resource_name or \"\",\n        \"Action\": event.action or \"\",\n        \"Outcome\": event.outcome or \"\",\n        # Actor\n        \"UserId\": event.user_id or \"\",\n        \"UserName\": event.user_name or \"\",\n        \"UserEmail\": event.user_email or \"\",\n        # Correlation\n        \"TenantId\": event.tenant_id or \"\",\n        \"CorrelationId\": event.correlation_id or \"\",\n        \"SessionId\": event.session_id or \"\",\n        # Classification - serialize lists/dicts as JSON strings for Log Analytics\n        \"Tags\": json.dumps(event.tags) if event.tags else \"[]\",\n        \"Labels\": json.dumps(event.labels) if event.labels else \"{}\",\n        # Extended details as JSON string\n        \"Details\": json.dumps(event.details) if event.details else \"{}\",\n    }\n\n    # Optionally include raw event\n    if config.include_raw_event and event.raw_event:\n        sentinel_event[\"RawEvent\"] = json.dumps(event.raw_event)\n\n    return sentinel_event\n\n\ndef format_cef_event(\n    event: StandardizedSIEMEvent,\n    config: Optional[CEFEventConfig] = None,\n) -> JSONDict:\n    \"\"\"\n    Format an event in Common Event Format (CEF).\n\n    Creates a CEF-compatible payload for SIEM systems that support CEF.\n    Returns both the CEF string and a structured dict representation.\n\n    Args:\n        event: Standardized SIEM event\n        config: CEF-specific configuration\n\n    Returns:\n        Dictionary with 'cef_string' and 'structured' keys\n    \"\"\"\n    if config is None:\n        config = CEFEventConfig()\n\n    # Map severity to CEF severity (0-10)\n    severity_level = event.severity_level\n    cef_severity = 10 - (severity_level - 1) * 2  # Maps 1->10, 2->8, 3->6, 4->4, 5->2\n\n    # Build CEF extension fields\n    extensions = {\n        \"eventId\": event.event_id,\n        \"msg\": event.message,\n        \"cat\": event.event_category,\n        \"src\": event.source,\n        \"suser\": event.user_id or \"\",\n        \"suid\": event.user_id or \"\",\n        \"cs1\": event.policy_id or \"\",\n        \"cs1Label\": \"PolicyId\",\n        \"cs2\": event.resource_id or \"\",\n        \"cs2Label\": \"ResourceId\",\n        \"cs3\": event.tenant_id or \"\",\n        \"cs3Label\": \"TenantId\",\n        \"cs4\": event.correlation_id or \"\",\n        \"cs4Label\": \"CorrelationId\",\n        \"outcome\": event.outcome or \"\",\n        \"act\": event.action or \"\",\n        \"rt\": int(event.time_epoch * 1000) if event.time_epoch else 0,  # CEF uses milliseconds\n    }\n\n    # Build extension string (key=value pairs)\n    ext_parts = []\n    for key, value in extensions.items():\n        if value:  # Only include non-empty values\n            # Escape special characters in values\n            escaped_value = _escape_cef_value(str(value))\n            ext_parts.append(f\"{key}={escaped_value}\")\n    extension_str = \" \".join(ext_parts)\n\n    # Build CEF header\n    # Format: CEF:Version|Vendor|Product|Version|EventClassID|Name|Severity|Extension\n    cef_header = (\n        f\"CEF:0|{_escape_cef_header(config.vendor)}|\"\n        f\"{_escape_cef_header(config.product)}|\"\n        f\"{_escape_cef_header(config.version)}|\"\n        f\"{_escape_cef_header(config.device_event_class_id)}|\"\n        f\"{_escape_cef_header(event.title)}|\"\n        f\"{cef_severity}|\"\n    )\n\n    cef_string = cef_header + extension_str\n\n    return {\n        \"cef_string\": cef_string,\n        \"structured\": {\n            \"cef_version\": 0,\n            \"vendor\": config.vendor,\n            \"product\": config.product,\n            \"version\": config.version,\n            \"device_event_class_id\": config.device_event_class_id,\n            \"name\": event.title,\n            \"severity\": cef_severity,\n            \"extensions\": extensions,\n        },\n    }\n\n\ndef format_json_event(\n    event: StandardizedSIEMEvent,\n) -> JSONDict:\n    \"\"\"\n    Format an event as a generic standardized JSON payload.\n\n    Creates a JSON payload that can be used with any SIEM that accepts\n    JSON-formatted events.\n\n    Args:\n        event: Standardized SIEM event\n\n    Returns:\n        Dictionary with standardized JSON structure\n    \"\"\"\n    return {\n        \"version\": \"1.0\",\n        \"schema\": \"acgs2-governance-event\",\n        \"timestamp\": event.timestamp.isoformat(),\n        \"timestamp_epoch\": event.time_epoch,\n        \"event\": {\n            \"id\": event.event_id,\n            \"type\": event.event_type,\n            \"category\": event.event_category,\n            \"severity\": {\n                \"name\": event.severity,\n                \"level\": event.severity_level,\n            },\n            \"title\": event.title,\n            \"description\": event.description,\n            \"message\": event.message,\n        },\n        \"source\": {\n            \"name\": event.source,\n            \"type\": event.source_type,\n            \"host\": event.host,\n        },\n        \"governance\": {\n            \"policy\": {\n                \"id\": event.policy_id,\n                \"name\": event.policy_name,\n            },\n            \"resource\": {\n                \"id\": event.resource_id,\n                \"type\": event.resource_type,\n                \"name\": event.resource_name,\n            },\n            \"action\": event.action,\n            \"outcome\": event.outcome,\n        },\n        \"actor\": {\n            \"user_id\": event.user_id,\n            \"user_name\": event.user_name,\n            \"user_email\": event.user_email,\n        },\n        \"context\": {\n            \"tenant_id\": event.tenant_id,\n            \"correlation_id\": event.correlation_id,\n            \"session_id\": event.session_id,\n        },\n        \"classification\": {\n            \"tags\": event.tags,\n            \"labels\": event.labels,\n        },\n        \"details\": event.details,\n        \"raw_event\": event.raw_event,\n    }\n\n\ndef format_events_batch(\n    events: List[Union[IntegrationEvent, JSONDict]],\n    format_type: SIEMFormat = SIEMFormat.JSON,\n    config: Optional[Union[SplunkEventConfig, SentinelEventConfig, CEFEventConfig]] = None,\n) -> List[JSONDict]:\n    \"\"\"\n    Format multiple events for SIEM ingestion.\n\n    Args:\n        events: List of governance events to format\n        format_type: Target SIEM format\n        config: Optional SIEM-specific configuration\n\n    Returns:\n        List of formatted event dictionaries\n    \"\"\"\n    return [format_siem_event(event, format_type, config) for event in events]\n\n\ndef _dict_to_integration_event(data: JSONDict) -> IntegrationEvent:\n    \"\"\"\n    Convert a dictionary to an IntegrationEvent.\n\n    Args:\n        data: Event data dictionary\n\n    Returns:\n        IntegrationEvent instance\n    \"\"\"\n    # Map common field name variations\n    field_mappings = {\n        \"id\": \"event_id\",\n        \"type\": \"event_type\",\n        \"time\": \"timestamp\",\n        \"datetime\": \"timestamp\",\n    }\n\n    normalized = {}\n    for key, value in data.items():\n        mapped_key = field_mappings.get(key, key)\n        normalized[mapped_key] = value\n\n    # Handle severity conversion\n    if \"severity\" in normalized and isinstance(normalized[\"severity\"], str):\n        severity_str = normalized[\"severity\"].lower()\n        severity_map = {\n            \"critical\": EventSeverity.CRITICAL,\n            \"high\": EventSeverity.HIGH,\n            \"medium\": EventSeverity.MEDIUM,\n            \"low\": EventSeverity.LOW,\n            \"info\": EventSeverity.INFO,\n            \"informational\": EventSeverity.INFO,\n        }\n        normalized[\"severity\"] = severity_map.get(severity_str, EventSeverity.INFO)\n\n    # Ensure required fields have defaults\n    if \"event_type\" not in normalized:\n        normalized[\"event_type\"] = \"unknown\"\n    if \"title\" not in normalized:\n        normalized[\"title\"] = normalized.get(\"message\", \"Governance Event\")\n\n    return IntegrationEvent(**normalized)\n\n\ndef _to_standardized_event(event: IntegrationEvent) -> StandardizedSIEMEvent:\n    \"\"\"\n    Convert an IntegrationEvent to a StandardizedSIEMEvent.\n\n    Args:\n        event: Integration event to convert\n\n    Returns:\n        StandardizedSIEMEvent instance\n    \"\"\"\n    # Build message from event content\n    message = event.description or event.title\n    if event.policy_id:\n        message = f\"[Policy: {event.policy_id}] {message}\"\n\n    return StandardizedSIEMEvent(\n        timestamp=event.timestamp,\n        event_id=event.event_id,\n        event_type=event.event_type,\n        event_category=\"governance\",\n        severity=SEVERITY_TO_NAME.get(event.severity, \"Informational\"),\n        severity_level=SEVERITY_TO_LEVEL.get(event.severity, SeverityLevel.INFO),\n        source=event.source,\n        source_type=f\"governance:{event.event_type}\",\n        title=event.title,\n        description=event.description,\n        message=message,\n        policy_id=event.policy_id,\n        resource_id=event.resource_id,\n        resource_type=event.resource_type,\n        action=event.action,\n        outcome=event.outcome,\n        user_id=event.user_id,\n        tenant_id=event.tenant_id,\n        correlation_id=event.correlation_id,\n        tags=event.tags,\n        details=event.details,\n    )\n\n\ndef _escape_cef_header(value: str) -> str:\n    \"\"\"\n    Escape special characters in CEF header fields.\n\n    CEF header fields need to escape: backslash and pipe characters.\n\n    Args:\n        value: Header field value\n\n    Returns:\n        Escaped value\n    \"\"\"\n    if not value:\n        return \"\"\n    return value.replace(\"\\\\\", \"\\\\\\\\\").replace(\"|\", \"\\\\|\")\n\n\ndef _escape_cef_value(value: str) -> str:\n    \"\"\"\n    Escape special characters in CEF extension values.\n\n    CEF extension values need to escape: backslash, equals, and newlines.\n\n    Args:\n        value: Extension field value\n\n    Returns:\n        Escaped value\n    \"\"\"\n    if not value:\n        return \"\"\n    return value.replace(\"\\\\\", \"\\\\\\\\\").replace(\"=\", \"\\\\=\").replace(\"\\n\", \"\\\\n\").replace(\"\\r\", \"\")\n\n\ndef normalize_severity(\n    severity: Union[str, int, EventSeverity],\n) -> tuple[str, int]:\n    \"\"\"\n    Normalize severity to standard name and level.\n\n    Accepts various severity formats and returns a tuple of (name, level).\n\n    Args:\n        severity: Severity as string, int, or EventSeverity enum\n\n    Returns:\n        Tuple of (severity_name, severity_level)\n\n    Examples:\n        >>> normalize_severity(\"high\")\n        ('High', 2)\n        >>> normalize_severity(1)\n        ('Critical', 1)\n        >>> normalize_severity(EventSeverity.MEDIUM)\n        ('Medium', 3)\n    \"\"\"\n    if isinstance(severity, EventSeverity):\n        return (\n            SEVERITY_TO_NAME.get(severity, \"Informational\"),\n            SEVERITY_TO_LEVEL.get(severity, SeverityLevel.INFO),\n        )\n\n    if isinstance(severity, int):\n        level = max(1, min(5, severity))  # Clamp to 1-5\n        level_to_name = {v: k for k, v in SEVERITY_TO_LEVEL.items()}\n        event_severity = level_to_name.get(level, EventSeverity.INFO)\n        return (\n            SEVERITY_TO_NAME.get(event_severity, \"Informational\"),\n            level,\n        )\n\n    if isinstance(severity, str):\n        severity_lower = severity.lower().strip()\n        str_to_enum = {\n            \"critical\": EventSeverity.CRITICAL,\n            \"crit\": EventSeverity.CRITICAL,\n            \"high\": EventSeverity.HIGH,\n            \"medium\": EventSeverity.MEDIUM,\n            \"med\": EventSeverity.MEDIUM,\n            \"low\": EventSeverity.LOW,\n            \"info\": EventSeverity.INFO,\n            \"informational\": EventSeverity.INFO,\n            \"information\": EventSeverity.INFO,\n        }\n        event_severity = str_to_enum.get(severity_lower, EventSeverity.INFO)\n        return (\n            SEVERITY_TO_NAME.get(event_severity, \"Informational\"),\n            SEVERITY_TO_LEVEL.get(event_severity, SeverityLevel.INFO),\n        )\n\n    # Default fallback\n    return (\"Informational\", SeverityLevel.INFO)\n\n\ndef get_event_signature(event: IntegrationEvent) -> str:\n    \"\"\"\n    Generate a unique signature for an event for deduplication.\n\n    Creates a hash-like signature based on key event fields that can be\n    used for event deduplication in SIEM systems.\n\n    Args:\n        event: Integration event\n\n    Returns:\n        Event signature string\n    \"\"\"\n    components = [\n        event.event_type,\n        event.policy_id or \"\",\n        event.resource_id or \"\",\n        event.action or \"\",\n        event.user_id or \"\",\n        event.tenant_id or \"\",\n    ]\n    return \":\".join(c for c in components if c)\n",
        "timestamp": "2026-01-04T05:35:58.374613"
      },
      "worktree_state": null,
      "task_intent": {
        "title": "056-reduce-excessive-any-type-usage-in-python-codebase",
        "description": "Found 373 occurrences of ': Any' type annotations across 120+ Python files, with high concentrations in integration-service (16 occurrences), acgs2-core/breakthrough (79 occurrences), and acgs2-core/enhanced_agent_bus (50+ occurrences). Excessive use of 'Any' defeats the purpose of type hints and can mask type-related bugs.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-03T19:36:18.063488",
  "last_updated": "2026-01-04T05:35:58.450992"
}