{
  "file_path": "integration-service/src/models/import_models.py",
  "main_branch_history": [],
  "task_views": {
    "003-import-your-data": {
      "task_id": "003-import-your-data",
      "branch_point": {
        "commit_hash": "cc53a509f89115bbb36940c140031e6159320791",
        "content": "",
        "timestamp": "2026-01-03T17:00:00.287145"
      },
      "worktree_state": {
        "content": "\"\"\"\nPydantic models for data import operations.\n\nDefines models for import requests, responses, progress tracking, and source\nconfiguration with comprehensive validation and support for JIRA, ServiceNow,\nGitHub, and GitLab integrations.\n\"\"\"\n\nfrom datetime import datetime, timezone\nfrom enum import Enum\nfrom typing import Any, Dict, List, Literal, Optional\nfrom uuid import uuid4\n\nfrom pydantic import (\n    BaseModel,\n    ConfigDict,\n    Field,\n    SecretStr,\n    field_validator,\n    model_validator,\n)\n\n\nclass ImportStatus(str, Enum):\n    \"\"\"Status of an import operation.\"\"\"\n\n    PENDING = \"pending\"\n    VALIDATING = \"validating\"\n    PROCESSING = \"processing\"\n    COMPLETED = \"completed\"\n    FAILED = \"failed\"\n    CANCELLED = \"cancelled\"\n    PARTIALLY_COMPLETED = \"partially_completed\"\n\n\nclass SourceType(str, Enum):\n    \"\"\"Supported external data sources for import.\"\"\"\n\n    JIRA = \"jira\"\n    SERVICENOW = \"servicenow\"\n    GITHUB = \"github\"\n    GITLAB = \"gitlab\"\n\n\nclass DuplicateHandling(str, Enum):\n    \"\"\"Strategy for handling duplicate items during import.\"\"\"\n\n    SKIP = \"skip\"\n    UPDATE = \"update\"\n    CREATE_NEW = \"create_new\"\n    FAIL = \"fail\"\n\n\nclass SourceConfig(BaseModel):\n    \"\"\"Configuration for connecting to an external data source.\"\"\"\n\n    # Authentication - use appropriate fields based on source type\n    api_token: Optional[SecretStr] = Field(\n        None, description=\"API token for authentication (GitHub, GitLab)\"\n    )\n    api_key: Optional[SecretStr] = Field(\n        None, description=\"API key for authentication (JIRA)\"\n    )\n    username: Optional[str] = Field(None, description=\"Username (JIRA, ServiceNow)\")\n    password: Optional[SecretStr] = Field(None, description=\"Password (ServiceNow)\")\n    user_email: Optional[str] = Field(None, description=\"User email (JIRA)\")\n\n    # Connection settings\n    base_url: Optional[str] = Field(None, description=\"Base URL for the service instance\")\n    instance: Optional[str] = Field(\n        None, description=\"Instance identifier (e.g., ServiceNow instance)\"\n    )\n\n    # Source-specific filters\n    project_key: Optional[str] = Field(None, description=\"Project key/identifier to import from\")\n    project_keys: List[str] = Field(\n        default_factory=list, description=\"Multiple project keys (for batch import)\"\n    )\n    repository: Optional[str] = Field(None, description=\"Repository name (GitHub/GitLab)\")\n    organization: Optional[str] = Field(None, description=\"Organization/group name\")\n\n    # Data filters\n    status_filter: List[str] = Field(\n        default_factory=list,\n        description=\"Filter items by status (e.g., ['open', 'in_progress'])\",\n    )\n    label_filter: List[str] = Field(\n        default_factory=list, description=\"Filter items by labels/tags\"\n    )\n    date_from: Optional[datetime] = Field(\n        None, description=\"Import items created/updated after this date\"\n    )\n    date_to: Optional[datetime] = Field(\n        None, description=\"Import items created/updated before this date\"\n    )\n\n    model_config = ConfigDict(\n        populate_by_name=True,\n        str_strip_whitespace=True,\n        validate_assignment=True,\n    )\n\n    @field_validator(\"base_url\", mode=\"before\")\n    @classmethod\n    def validate_url(cls, v: Optional[str]) -> Optional[str]:\n        \"\"\"Validate base URL format.\"\"\"\n        if v and not v.startswith((\"http://\", \"https://\")):\n            raise ValueError(\"Base URL must start with http:// or https://\")\n        return v.rstrip(\"/\") if v else None\n\n    @model_validator(mode=\"after\")\n    def validate_auth_config(self) -> \"SourceConfig\":\n        \"\"\"Validate that at least one authentication method is provided.\"\"\"\n        auth_fields = [\n            self.api_token,\n            self.api_key,\n            self.username and self.password,\n        ]\n        if not any(auth_fields):\n            raise ValueError(\n                \"At least one authentication method must be provided \"\n                \"(api_token, api_key, or username/password)\"\n            )\n        return self\n\n\nclass ImportOptions(BaseModel):\n    \"\"\"Options for controlling import behavior.\"\"\"\n\n    duplicate_handling: DuplicateHandling = Field(\n        default=DuplicateHandling.SKIP,\n        description=\"Strategy for handling duplicate items\",\n    )\n    batch_size: int = Field(\n        default=100, ge=1, le=1000, description=\"Number of items to process per batch\"\n    )\n    max_items: Optional[int] = Field(\n        None, ge=1, description=\"Maximum number of items to import (for testing/preview)\"\n    )\n    include_comments: bool = Field(default=True, description=\"Include comments/notes in import\")\n    include_attachments: bool = Field(\n        default=False, description=\"Include file attachments (may increase processing time)\"\n    )\n    include_history: bool = Field(\n        default=False, description=\"Include item history/audit trail\"\n    )\n    dry_run: bool = Field(\n        default=False, description=\"Simulate import without committing changes\"\n    )\n\n    model_config = ConfigDict(\n        populate_by_name=True,\n        validate_assignment=True,\n    )\n\n\nclass ImportRequest(BaseModel):\n    \"\"\"\n    Request model for initiating a data import operation.\n\n    Contains source configuration, authentication, filters, and import options.\n    \"\"\"\n\n    id: str = Field(\n        default_factory=lambda: str(uuid4()),\n        description=\"Unique identifier for this import request\",\n    )\n    source_type: SourceType = Field(..., description=\"Type of external data source\")\n    source_config: SourceConfig = Field(..., description=\"Source connection and filter configuration\")\n    options: ImportOptions = Field(\n        default_factory=ImportOptions, description=\"Import behavior options\"\n    )\n\n    # Metadata\n    requested_by: Optional[str] = Field(None, description=\"User ID who requested the import\")\n    tenant_id: Optional[str] = Field(None, description=\"Tenant ID for multi-tenant deployments\")\n    correlation_id: Optional[str] = Field(\n        None, description=\"Correlation ID for request tracing\"\n    )\n    tags: List[str] = Field(default_factory=list, description=\"Tags for categorizing the import\")\n\n    model_config = ConfigDict(\n        populate_by_name=True,\n        str_strip_whitespace=True,\n        validate_assignment=True,\n    )\n\n\nclass ImportedItem(BaseModel):\n    \"\"\"Represents a single item that was imported.\"\"\"\n\n    external_id: str = Field(..., description=\"ID in the external system\")\n    internal_id: Optional[str] = Field(None, description=\"ID assigned in ACGS2 system\")\n    item_type: str = Field(..., description=\"Type of item (issue, ticket, project, etc.)\")\n    title: str = Field(..., description=\"Item title/summary\")\n    status: str = Field(..., description=\"Import status for this item\")\n    error_message: Optional[str] = Field(None, description=\"Error message if import failed\")\n\n    model_config = ConfigDict(populate_by_name=True)\n\n\nclass ImportProgress(BaseModel):\n    \"\"\"Detailed progress information for an import operation.\"\"\"\n\n    total_items: int = Field(0, ge=0, description=\"Total number of items to import\")\n    processed_items: int = Field(0, ge=0, description=\"Number of items processed so far\")\n    successful_items: int = Field(0, ge=0, description=\"Number of successfully imported items\")\n    failed_items: int = Field(0, ge=0, description=\"Number of failed items\")\n    skipped_items: int = Field(0, ge=0, description=\"Number of skipped items (duplicates)\")\n\n    percentage: float = Field(\n        0.0, ge=0.0, le=100.0, description=\"Percentage complete (0-100)\"\n    )\n    estimated_time_remaining: Optional[int] = Field(\n        None, ge=0, description=\"Estimated seconds remaining\"\n    )\n\n    current_batch: int = Field(0, ge=0, description=\"Current batch number being processed\")\n    total_batches: int = Field(0, ge=0, description=\"Total number of batches\")\n\n    model_config = ConfigDict(populate_by_name=True)\n\n\nclass ImportResponse(BaseModel):\n    \"\"\"\n    Response model for import operations.\n\n    Contains job tracking information, status, progress, and results.\n    \"\"\"\n\n    job_id: str = Field(\n        default_factory=lambda: str(uuid4()),\n        description=\"Unique identifier for tracking this import job\",\n    )\n    request_id: str = Field(..., description=\"ID of the original import request\")\n    status: ImportStatus = Field(..., description=\"Current status of the import operation\")\n    source_type: SourceType = Field(..., description=\"Type of external data source\")\n\n    # Timestamps\n    created_at: datetime = Field(\n        default_factory=lambda: datetime.now(timezone.utc),\n        description=\"When the import job was created\",\n    )\n    started_at: Optional[datetime] = Field(None, description=\"When processing started\")\n    completed_at: Optional[datetime] = Field(None, description=\"When processing completed\")\n    updated_at: datetime = Field(\n        default_factory=lambda: datetime.now(timezone.utc),\n        description=\"Last status update timestamp\",\n    )\n\n    # Progress information\n    progress: ImportProgress = Field(\n        default_factory=ImportProgress, description=\"Detailed progress information\"\n    )\n\n    # Results\n    imported_items: List[ImportedItem] = Field(\n        default_factory=list, description=\"List of imported items (populated on completion)\"\n    )\n\n    # Error details\n    error_code: Optional[str] = Field(None, description=\"Error code if failed\")\n    error_message: Optional[str] = Field(None, description=\"Error message if failed\")\n    error_details: Dict[str, Any] = Field(\n        default_factory=dict, description=\"Additional error details\"\n    )\n\n    # Metadata\n    tenant_id: Optional[str] = Field(None, description=\"Tenant ID for multi-tenant deployments\")\n    correlation_id: Optional[str] = Field(None, description=\"Correlation ID for tracing\")\n\n    model_config = ConfigDict(\n        populate_by_name=True,\n        validate_assignment=True,\n    )\n\n    @model_validator(mode=\"after\")\n    def validate_timestamps(self) -> \"ImportResponse\":\n        \"\"\"Validate timestamp ordering.\"\"\"\n        if self.started_at and self.started_at < self.created_at:\n            raise ValueError(\"started_at cannot be before created_at\")\n        if self.completed_at and self.started_at and self.completed_at < self.started_at:\n            raise ValueError(\"completed_at cannot be before started_at\")\n        return self\n\n\nclass PreviewItem(BaseModel):\n    \"\"\"Represents a sample item in the preview response.\"\"\"\n\n    external_id: str = Field(..., description=\"ID in the external system\")\n    item_type: str = Field(..., description=\"Type of item (issue, ticket, project, etc.)\")\n    title: str = Field(..., description=\"Item title/summary\")\n    status: Optional[str] = Field(None, description=\"Current status\")\n    assignee: Optional[str] = Field(None, description=\"Assigned user\")\n    created_at: Optional[datetime] = Field(None, description=\"Creation date\")\n    updated_at: Optional[datetime] = Field(None, description=\"Last update date\")\n    labels: List[str] = Field(default_factory=list, description=\"Labels/tags\")\n    metadata: Dict[str, Any] = Field(\n        default_factory=dict, description=\"Additional item metadata\"\n    )\n\n    model_config = ConfigDict(populate_by_name=True)\n\n\nclass PreviewResponse(BaseModel):\n    \"\"\"\n    Response model for preview operations.\n\n    Contains sample data from the external source without committing changes.\n    \"\"\"\n\n    source_type: SourceType = Field(..., description=\"Type of external data source\")\n    total_available: int = Field(\n        0, ge=0, description=\"Total number of items available for import\"\n    )\n    preview_items: List[PreviewItem] = Field(\n        default_factory=list, description=\"Sample items (typically first 10-50)\"\n    )\n    preview_count: int = Field(0, ge=0, description=\"Number of items in preview\")\n\n    # Source metadata\n    source_name: Optional[str] = Field(None, description=\"Name of the source (project, repo, etc.)\")\n    source_url: Optional[str] = Field(None, description=\"URL to the external source\")\n\n    # Statistics\n    item_type_counts: Dict[str, int] = Field(\n        default_factory=dict,\n        description=\"Count of items by type (e.g., {'issue': 100, 'bug': 25})\",\n    )\n    status_counts: Dict[str, int] = Field(\n        default_factory=dict,\n        description=\"Count of items by status (e.g., {'open': 50, 'closed': 50})\",\n    )\n\n    # Warnings\n    warnings: List[str] = Field(\n        default_factory=list,\n        description=\"Warnings about the import (e.g., missing fields, rate limits)\",\n    )\n\n    model_config = ConfigDict(populate_by_name=True)\n\n\nclass ImportListResponse(BaseModel):\n    \"\"\"Response model for listing import jobs.\"\"\"\n\n    jobs: List[ImportResponse] = Field(default_factory=list, description=\"List of import jobs\")\n    total: int = Field(0, ge=0, description=\"Total number of jobs matching filters\")\n    limit: int = Field(10, ge=1, le=100, description=\"Number of jobs per page\")\n    offset: int = Field(0, ge=0, description=\"Offset for pagination\")\n\n    model_config = ConfigDict(populate_by_name=True)\n",
        "last_modified": "2026-01-03T19:09:00.298763"
      },
      "task_intent": {
        "title": "003-import-your-data",
        "description": "",
        "from_plan": false
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-03T16:23:45.513248",
  "last_updated": "2026-01-03T17:00:00.303688"
}