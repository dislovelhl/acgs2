{
  "file_path": "acgs2-observability/monitoring/dashboard/src/components/__tests__/MetricsChart.test.tsx",
  "main_branch_history": [],
  "task_views": {
    "052-replace-recharts-with-lightweight-chart-library": {
      "task_id": "052-replace-recharts-with-lightweight-chart-library",
      "branch_point": {
        "commit_hash": "fc6e42927298263034acf989773f3200e422ad17",
        "content": "/**\n * MetricsChart Component Tests\n * Constitutional Hash: cdd01ef066bc6cf2\n *\n * Tests for the MetricsChart component including:\n * - Loading state (skeleton)\n * - Displaying system metrics chart\n * - Metric summary cards (CPU, Memory, Disk)\n * - Performance metrics display\n * - Handling null/empty metrics\n * - Chart rendering with visx\n */\n\nimport { describe, it, expect, vi } from \"vitest\";\nimport { render, screen } from \"@testing-library/react\";\nimport { MetricsChart } from \"../MetricsChart\";\nimport type { MetricsResponse } from \"../../types/api\";\n\n// Mock visx-based chart components to avoid rendering issues in tests\nvi.mock(\"../charts\", () => ({\n  ResponsiveChart: ({ children }: { children: (dimensions: { width: number; height: number }) => React.ReactNode }) => (\n    <div data-testid=\"responsive-container\">\n      {children({ width: 800, height: 400 })}\n    </div>\n  ),\n  LineChart: ({ children }: { children?: React.ReactNode }) => (\n    <div data-testid=\"line-chart\">{children}</div>\n  ),\n}));\n\n// Mock visx dependencies to avoid SVG rendering issues in tests\nvi.mock(\"@visx/responsive\", () => ({\n  ParentSize: ({ children }: { children: (dimensions: { width: number; height: number }) => React.ReactNode }) => (\n    <div>{children({ width: 800, height: 400 })}</div>\n  ),\n}));\n\n// Mock metrics data for testing\nconst mockMetricsData: MetricsResponse = {\n  system: {\n    cpu_percent: 45.5,\n    memory_percent: 62.3,\n    memory_used_gb: 12.5,\n    memory_total_gb: 20.0,\n    disk_percent: 78.1,\n    disk_used_gb: 390.5,\n    disk_total_gb: 500.0,\n    network_bytes_sent: 1024000,\n    network_bytes_recv: 2048000,\n    process_count: 145,\n    timestamp: \"2026-01-03T12:00:00Z\",\n  },\n  performance: {\n    p99_latency_ms: 125.5,\n    throughput_rps: 1250,\n    cache_hit_rate: 0.85,\n    constitutional_compliance: 99.2,\n    active_connections: 50,\n    requests_total: 10000,\n    errors_total: 5,\n    timestamp: \"2026-01-03T12:00:00Z\",\n  },\n  history: [\n    {\n      cpu_percent: 42.0,\n      memory_percent: 60.0,\n      memory_used_gb: 12.0,\n      memory_total_gb: 20.0,\n      disk_percent: 77.5,\n      disk_used_gb: 387.5,\n      disk_total_gb: 500.0,\n      network_bytes_sent: 1000000,\n      network_bytes_recv: 2000000,\n      process_count: 140,\n      timestamp: \"2026-01-03T11:55:00Z\",\n    },\n    {\n      cpu_percent: 43.5,\n      memory_percent: 61.0,\n      memory_used_gb: 12.2,\n      memory_total_gb: 20.0,\n      disk_percent: 77.8,\n      disk_used_gb: 389.0,\n      disk_total_gb: 500.0,\n      network_bytes_sent: 1012000,\n      network_bytes_recv: 2024000,\n      process_count: 142,\n      timestamp: \"2026-01-03T11:56:00Z\",\n    },\n  ],\n  timestamp: \"2026-01-03T12:00:00Z\",\n  constitutional_hash: \"cdd01ef066bc6cf2\",\n};\n\ndescribe(\"MetricsChart\", () => {\n  describe(\"Loading State\", () => {\n    it(\"shows skeleton when loading is true\", () => {\n      render(<MetricsChart metrics={null} loading={true} />);\n\n      // Should show skeleton loading animation\n      const skeleton = screen.getByText((content, element) => {\n        return element?.className.includes(\"animate-pulse\") || false;\n      });\n      expect(skeleton).toBeInTheDocument();\n    });\n\n    it(\"shows skeleton when metrics is null\", () => {\n      render(<MetricsChart metrics={null} loading={false} />);\n\n      // Should show skeleton when no metrics data\n      const skeleton = screen.getByText((content, element) => {\n        return element?.className.includes(\"animate-pulse\") || false;\n      });\n      expect(skeleton).toBeInTheDocument();\n    });\n  });\n\n  describe(\"System Metrics Display\", () => {\n    it(\"displays system metrics header\", () => {\n      render(<MetricsChart metrics={mockMetricsData} loading={false} />);\n\n      expect(screen.getByText(\"System Metrics\")).toBeInTheDocument();\n    });\n\n    it(\"displays current CPU usage with correct value\", () => {\n      render(<MetricsChart metrics={mockMetricsData} loading={false} />);\n\n      expect(screen.getByText(\"45.5%\")).toBeInTheDocument();\n      expect(screen.getByText(\"CPU Usage\")).toBeInTheDocument();\n    });\n\n    it(\"displays current Memory usage with correct value\", () => {\n      render(<MetricsChart metrics={mockMetricsData} loading={false} />);\n\n      expect(screen.getByText(\"62.3%\")).toBeInTheDocument();\n      expect(screen.getByText(\"Memory Usage\")).toBeInTheDocument();\n    });\n\n    it(\"displays current Disk usage with correct value\", () => {\n      render(<MetricsChart metrics={mockMetricsData} loading={false} />);\n\n      expect(screen.getByText(\"78.1%\")).toBeInTheDocument();\n      expect(screen.getByText(\"Disk Usage\")).toBeInTheDocument();\n    });\n\n    it(\"applies correct color classes to metric summaries\", () => {\n      const { container } = render(<MetricsChart metrics={mockMetricsData} loading={false} />);\n\n      // CPU should have blue styling\n      const cpuCard = container.querySelector(\".bg-blue-50\");\n      expect(cpuCard).toBeInTheDocument();\n\n      // Memory should have purple styling\n      const memoryCard = container.querySelector(\".bg-purple-50\");\n      expect(memoryCard).toBeInTheDocument();\n\n      // Disk should have orange styling\n      const diskCard = container.querySelector(\".bg-orange-50\");\n      expect(diskCard).toBeInTheDocument();\n    });\n  });\n\n  describe(\"Chart Rendering\", () => {\n    it(\"renders chart when metrics data has history\", () => {\n      render(<MetricsChart metrics={mockMetricsData} loading={false} />);\n\n      expect(screen.getByTestId(\"responsive-container\")).toBeInTheDocument();\n      expect(screen.getByTestId(\"line-chart\")).toBeInTheDocument();\n    });\n\n    it(\"shows collecting message when insufficient data\", () => {\n      const minimalMetrics = {\n        ...mockMetricsData,\n        history: [], // Empty history\n      };\n\n      render(<MetricsChart metrics={minimalMetrics} loading={false} />);\n\n      expect(screen.getByText(\"Collecting metrics data...\")).toBeInTheDocument();\n    });\n\n    it(\"does not render chart when only current metric exists (no history)\", () => {\n      const minimalMetrics = {\n        ...mockMetricsData,\n        history: [],\n      };\n\n      render(<MetricsChart metrics={minimalMetrics} loading={false} />);\n\n      expect(screen.queryByTestId(\"responsive-container\")).not.toBeInTheDocument();\n      expect(screen.queryByTestId(\"line-chart\")).not.toBeInTheDocument();\n    });\n  });\n\n  describe(\"Performance Metrics Display\", () => {\n    it(\"displays performance metrics header\", () => {\n      render(<MetricsChart metrics={mockMetricsData} loading={false} />);\n\n      expect(screen.getByText(\"Performance Metrics\")).toBeInTheDocument();\n    });\n\n    it(\"displays P99 latency with correct formatting\", () => {\n      render(<MetricsChart metrics={mockMetricsData} loading={false} />);\n\n      expect(screen.getByText(\"125.500ms\")).toBeInTheDocument();\n      expect(screen.getByText(\"P99 Latency\")).toBeInTheDocument();\n    });\n\n    it(\"displays throughput with locale formatting\", () => {\n      render(<MetricsChart metrics={mockMetricsData} loading={false} />);\n\n      expect(screen.getByText(\"1,250 RPS\")).toBeInTheDocument();\n      expect(screen.getByText(\"Throughput\")).toBeInTheDocument();\n    });\n\n    it(\"displays cache hit rate as percentage\", () => {\n      render(<MetricsChart metrics={mockMetricsData} loading={false} />);\n\n      expect(screen.getByText(\"85.0%\")).toBeInTheDocument();\n      expect(screen.getByText(\"Cache Hit Rate\")).toBeInTheDocument();\n    });\n\n    it(\"displays constitutional compliance when available\", () => {\n      render(<MetricsChart metrics={mockMetricsData} loading={false} />);\n\n      expect(screen.getByText(\"99.2%\")).toBeInTheDocument();\n      expect(screen.getByText(\"Constitutional Compliance\")).toBeInTheDocument();\n    });\n\n    it(\"does not display constitutional compliance when undefined\", () => {\n      const metricsWithoutCompliance = {\n        ...mockMetricsData,\n        performance: {\n          ...mockMetricsData.performance,\n          constitutional_compliance: undefined,\n        },\n      };\n\n      render(<MetricsChart metrics={metricsWithoutCompliance} loading={false} />);\n\n      expect(screen.queryByText(\"Constitutional Compliance\")).not.toBeInTheDocument();\n    });\n\n    it(\"applies green styling to constitutional compliance card\", () => {\n      const { container } = render(<MetricsChart metrics={mockMetricsData} loading={false} />);\n\n      const complianceCard = container.querySelector(\".bg-green-50\");\n      expect(complianceCard).toBeInTheDocument();\n    });\n  });\n\n  describe(\"Component Memoization\", () => {\n    it(\"renders without crashing with complete data\", () => {\n      const { container } = render(<MetricsChart metrics={mockMetricsData} loading={false} />);\n\n      expect(container.firstChild).toBeInTheDocument();\n    });\n\n    it(\"handles edge case with zero values\", () => {\n      const zeroMetrics = {\n        ...mockMetricsData,\n        system: {\n          ...mockMetricsData.system,\n          cpu_percent: 0,\n          memory_percent: 0,\n          disk_percent: 0,\n        },\n      };\n\n      render(<MetricsChart metrics={zeroMetrics} loading={false} />);\n\n      expect(screen.getByText(\"0.0%\")).toBeInTheDocument();\n      expect(screen.getByText(\"CPU Usage\")).toBeInTheDocument();\n    });\n\n    it(\"handles edge case with 100% values\", () => {\n      const maxMetrics = {\n        ...mockMetricsData,\n        system: {\n          ...mockMetricsData.system,\n          cpu_percent: 100,\n          memory_percent: 100,\n          disk_percent: 100,\n        },\n      };\n\n      render(<MetricsChart metrics={maxMetrics} loading={false} />);\n\n      expect(screen.getAllByText(\"100.0%\").length).toBeGreaterThan(0);\n    });\n  });\n\n  describe(\"Layout and Structure\", () => {\n    it(\"has proper grid layout for metric summaries\", () => {\n      const { container } = render(<MetricsChart metrics={mockMetricsData} loading={false} />);\n\n      const grid = container.querySelector(\".grid.grid-cols-3\");\n      expect(grid).toBeInTheDocument();\n    });\n\n    it(\"has proper responsive grid for performance metrics\", () => {\n      const { container } = render(<MetricsChart metrics={mockMetricsData} loading={false} />);\n\n      const performanceGrid = container.querySelector(\".grid.grid-cols-2.md\\\\:grid-cols-4\");\n      expect(performanceGrid).toBeInTheDocument();\n    });\n\n    it(\"has border and shadow styling for main container\", () => {\n      const { container } = render(<MetricsChart metrics={mockMetricsData} loading={false} />);\n\n      const mainContainer = container.querySelector(\".border.border-gray-200.shadow-sm\");\n      expect(mainContainer).toBeInTheDocument();\n    });\n  });\n\n  describe(\"Time Formatting\", () => {\n    it(\"formats timestamps correctly in chart data\", () => {\n      // This test verifies the component doesn't crash when processing timestamps\n      // The actual time formatting is tested through chart rendering\n      expect(() => {\n        render(<MetricsChart metrics={mockMetricsData} loading={false} />);\n      }).not.toThrow();\n    });\n  });\n\n  describe(\"Accessibility\", () => {\n    it(\"has proper heading structure\", () => {\n      render(<MetricsChart metrics={mockMetricsData} loading={false} />);\n\n      const heading = screen.getByRole(\"heading\", { level: 2 });\n      expect(heading).toHaveTextContent(\"System Metrics\");\n    });\n\n    it(\"has proper heading for performance section\", () => {\n      render(<MetricsChart metrics={mockMetricsData} loading={false} />);\n\n      const heading = screen.getByRole(\"heading\", { level: 3 });\n      expect(heading).toHaveTextContent(\"Performance Metrics\");\n    });\n\n    it(\"uses semantic HTML elements\", () => {\n      const { container } = render(<MetricsChart metrics={mockMetricsData} loading={false} />);\n\n      expect(container.querySelector(\"h2\")).toBeInTheDocument();\n      expect(container.querySelector(\"h3\")).toBeInTheDocument();\n    });\n  });\n});\n",
        "timestamp": "2026-01-04T05:36:13.611399"
      },
      "worktree_state": null,
      "task_intent": {
        "title": "052-replace-recharts-with-lightweight-chart-library",
        "description": "Replace recharts (~500KB unparsed, ~150KB gzipped) with a lightweight charting library like visx (~40KB) or uPlot (~30KB) to reduce bundle size and improve dashboard performance. Used in PredictionWidget (analytics-dashboard) and MetricsChart (observability dashboard).",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-03T19:36:23.200448",
  "last_updated": "2026-01-04T05:36:13.682061"
}