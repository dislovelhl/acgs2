{
  "file_path": "analytics-dashboard/src/components/QueryInterface.tsx",
  "main_branch_history": [],
  "task_views": {
    "054-extract-duplicated-loadingstate-and-api-config-in-": {
      "task_id": "054-extract-duplicated-loadingstate-and-api-config-in-",
      "branch_point": {
        "commit_hash": "4a99fe22e8e0087919301b1aa185d4e2c6da716c",
        "content": "/**\n * QueryInterface Component\n *\n * Natural language query interface for governance analytics.\n * Features:\n * - Text input for natural language questions\n * - Sample query suggestions\n * - Query result display with answer and data\n * - Loading, error, and success states\n * - Query history (recent queries)\n */\n\nimport { useCallback, useState, useRef, useEffect } from \"react\";\nimport {\n  AlertCircle,\n  ChevronDown,\n  ChevronUp,\n  Clock,\n  MessageSquare,\n  Search,\n  Send,\n  Sparkles,\n  X,\n} from \"lucide-react\";\n\n/** Query response data structure from the API */\ninterface QueryResponse {\n  query: string;\n  answer: string;\n  data: Record<string, unknown>;\n  query_understood: boolean;\n  generated_at: string;\n}\n\n/** Query history item */\ninterface QueryHistoryItem {\n  query: string;\n  response: QueryResponse;\n  timestamp: Date;\n}\n\n/** Widget loading state */\ntype LoadingState = \"idle\" | \"loading\" | \"success\" | \"error\";\n\n/** API URL from environment */\nconst API_BASE_URL =\n  import.meta.env.VITE_ANALYTICS_API_URL || \"http://localhost:8080\";\n\n/** Maximum number of queries to keep in history */\nconst MAX_HISTORY_ITEMS = 5;\n\n/** Sample queries to help users get started */\nconst SAMPLE_QUERIES = [\n  \"Show violations this week\",\n  \"Which policy is violated most?\",\n  \"What is the compliance trend?\",\n  \"How many violations occurred yesterday?\",\n  \"List critical security incidents\",\n];\n\n/**\n * Formats a timestamp for display\n */\nfunction formatTimestamp(date: Date): string {\n  return date.toLocaleString(undefined, {\n    dateStyle: \"short\",\n    timeStyle: \"short\",\n  });\n}\n\n/**\n * Formats data for display in a readable way\n */\nfunction formatDataValue(value: unknown): string {\n  if (value === null || value === undefined) {\n    return \"N/A\";\n  }\n  if (typeof value === \"object\") {\n    return JSON.stringify(value, null, 2);\n  }\n  return String(value);\n}\n\n/**\n * QueryInterface - Natural language query component for governance data\n *\n * Features:\n * - Text input with submit button\n * - Sample query suggestions\n * - Query result display\n * - Recent query history\n * - Loading and error states\n */\nexport function QueryInterface(): JSX.Element {\n  const [query, setQuery] = useState(\"\");\n  const [loadingState, setLoadingState] = useState<LoadingState>(\"idle\");\n  const [error, setError] = useState<string | null>(null);\n  const [currentResponse, setCurrentResponse] = useState<QueryResponse | null>(\n    null\n  );\n  const [queryHistory, setQueryHistory] = useState<QueryHistoryItem[]>([]);\n  const [showHistory, setShowHistory] = useState(false);\n  const [showSamples, setShowSamples] = useState(true);\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  /**\n   * Focus input on mount\n   */\n  useEffect(() => {\n    if (inputRef.current) {\n      inputRef.current.focus();\n    }\n  }, []);\n\n  /**\n   * Submits a query to the API\n   */\n  const submitQuery = useCallback(async (queryText: string) => {\n    if (!queryText.trim()) {\n      return;\n    }\n\n    setLoadingState(\"loading\");\n    setError(null);\n    setShowSamples(false);\n\n    try {\n      const response = await fetch(`${API_BASE_URL}/query`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Accept: \"application/json\",\n        },\n        body: JSON.stringify({ question: queryText }),\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(\n          errorData.detail || `Query failed: ${response.status}`\n        );\n      }\n\n      const data: QueryResponse = await response.json();\n      setCurrentResponse(data);\n      setLoadingState(\"success\");\n\n      // Add to history\n      setQueryHistory((prev) => {\n        const newItem: QueryHistoryItem = {\n          query: queryText,\n          response: data,\n          timestamp: new Date(),\n        };\n        const updated = [newItem, ...prev.slice(0, MAX_HISTORY_ITEMS - 1)];\n        return updated;\n      });\n    } catch (err) {\n      const message =\n        err instanceof Error ? err.message : \"Failed to process query\";\n      setError(message);\n      setLoadingState(\"error\");\n    }\n  }, []);\n\n  /**\n   * Handle form submission\n   */\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    submitQuery(query);\n  };\n\n  /**\n   * Handle sample query click\n   */\n  const handleSampleClick = (sampleQuery: string) => {\n    setQuery(sampleQuery);\n    submitQuery(sampleQuery);\n  };\n\n  /**\n   * Handle history item click\n   */\n  const handleHistoryClick = (item: QueryHistoryItem) => {\n    setQuery(item.query);\n    setCurrentResponse(item.response);\n    setLoadingState(\"success\");\n    setShowHistory(false);\n  };\n\n  /**\n   * Clear current response and reset\n   */\n  const handleClear = () => {\n    setQuery(\"\");\n    setCurrentResponse(null);\n    setLoadingState(\"idle\");\n    setError(null);\n    setShowSamples(true);\n    inputRef.current?.focus();\n  };\n\n  return (\n    <div className=\"rounded-lg bg-white p-6 shadow\">\n      {/* Header */}\n      <div className=\"mb-4 flex items-center gap-2\">\n        <MessageSquare className=\"h-5 w-5 text-indigo-600\" />\n        <h2 className=\"text-lg font-semibold text-gray-900\">\n          Ask About Governance\n        </h2>\n        <Sparkles className=\"h-4 w-4 text-yellow-500\" />\n      </div>\n\n      {/* Query Input Form */}\n      <form onSubmit={handleSubmit} className=\"relative\">\n        <div className=\"flex gap-2\">\n          <div className=\"relative flex-1\">\n            <input\n              ref={inputRef}\n              type=\"text\"\n              value={query}\n              onChange={(e) => setQuery(e.target.value)}\n              placeholder=\"Ask a question about governance data...\"\n              className=\"w-full rounded-lg border border-gray-300 py-3 pl-10 pr-4 text-sm transition-colors focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500\"\n              disabled={loadingState === \"loading\"}\n              maxLength={500}\n              aria-label=\"Query input\"\n            />\n            <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400\" />\n            {query && loadingState !== \"loading\" && (\n              <button\n                type=\"button\"\n                onClick={handleClear}\n                className=\"absolute right-3 top-1/2 -translate-y-1/2 rounded-full p-1 text-gray-400 hover:bg-gray-100 hover:text-gray-600\"\n                title=\"Clear\"\n                aria-label=\"Clear query\"\n              >\n                <X className=\"h-4 w-4\" />\n              </button>\n            )}\n          </div>\n          <button\n            type=\"submit\"\n            disabled={!query.trim() || loadingState === \"loading\"}\n            className=\"flex items-center gap-2 rounded-lg bg-indigo-600 px-4 py-3 text-sm font-medium text-white transition-colors hover:bg-indigo-700 disabled:cursor-not-allowed disabled:opacity-50\"\n            aria-label=\"Submit query\"\n          >\n            {loadingState === \"loading\" ? (\n              <div className=\"h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent\" />\n            ) : (\n              <Send className=\"h-4 w-4\" />\n            )}\n            <span className=\"hidden sm:inline\">Ask</span>\n          </button>\n        </div>\n\n        {/* History Toggle */}\n        {queryHistory.length > 0 && (\n          <button\n            type=\"button\"\n            onClick={() => setShowHistory(!showHistory)}\n            className=\"mt-2 flex items-center gap-1 text-xs text-gray-500 hover:text-gray-700\"\n          >\n            <Clock className=\"h-3 w-3\" />\n            Recent queries ({queryHistory.length})\n            {showHistory ? (\n              <ChevronUp className=\"h-3 w-3\" />\n            ) : (\n              <ChevronDown className=\"h-3 w-3\" />\n            )}\n          </button>\n        )}\n      </form>\n\n      {/* Query History */}\n      {showHistory && queryHistory.length > 0 && (\n        <div className=\"mt-3 rounded-lg border border-gray-200 bg-gray-50 p-3\">\n          <div className=\"space-y-2\">\n            {queryHistory.map((item, index) => (\n              <button\n                key={index}\n                onClick={() => handleHistoryClick(item)}\n                className=\"block w-full rounded-md px-3 py-2 text-left text-sm text-gray-700 transition-colors hover:bg-gray-100\"\n              >\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"line-clamp-1\">{item.query}</span>\n                  <span className=\"ml-2 shrink-0 text-xs text-gray-400\">\n                    {formatTimestamp(item.timestamp)}\n                  </span>\n                </div>\n              </button>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Sample Queries */}\n      {showSamples && loadingState === \"idle\" && !currentResponse && (\n        <div className=\"mt-4\">\n          <p className=\"mb-2 text-xs font-medium uppercase text-gray-500\">\n            Try asking:\n          </p>\n          <div className=\"flex flex-wrap gap-2\">\n            {SAMPLE_QUERIES.map((sample) => (\n              <button\n                key={sample}\n                onClick={() => handleSampleClick(sample)}\n                className=\"rounded-full border border-gray-200 bg-gray-50 px-3 py-1.5 text-xs text-gray-600 transition-colors hover:border-indigo-300 hover:bg-indigo-50 hover:text-indigo-700\"\n              >\n                {sample}\n              </button>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Loading State */}\n      {loadingState === \"loading\" && (\n        <div className=\"mt-6 flex items-center justify-center py-8\">\n          <div className=\"text-center\">\n            <div className=\"mx-auto h-8 w-8 animate-spin rounded-full border-4 border-indigo-600 border-t-transparent\"></div>\n            <p className=\"mt-4 text-sm text-gray-500\">\n              Processing your query...\n            </p>\n          </div>\n        </div>\n      )}\n\n      {/* Error State */}\n      {loadingState === \"error\" && (\n        <div className=\"mt-6 rounded-lg bg-red-50 p-4\">\n          <div className=\"flex items-start gap-3\">\n            <AlertCircle className=\"h-5 w-5 shrink-0 text-red-500\" />\n            <div>\n              <p className=\"font-medium text-red-800\">Query Failed</p>\n              <p className=\"mt-1 text-sm text-red-600\">{error}</p>\n              <button\n                onClick={() => submitQuery(query)}\n                className=\"mt-3 rounded-md bg-red-100 px-3 py-1.5 text-sm font-medium text-red-700 transition-colors hover:bg-red-200\"\n              >\n                Try Again\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Query Results */}\n      {loadingState === \"success\" && currentResponse && (\n        <div className=\"mt-6 space-y-4\">\n          {/* Query Understood Indicator */}\n          {!currentResponse.query_understood && (\n            <div className=\"rounded-lg border border-yellow-200 bg-yellow-50 p-3\">\n              <p className=\"text-sm text-yellow-700\">\n                Could not fully understand your query. Try rephrasing using\n                keywords like &quot;violations&quot;, &quot;policies&quot;, or\n                &quot;trends&quot;.\n              </p>\n            </div>\n          )}\n\n          {/* Answer Section */}\n          <div className=\"rounded-lg bg-indigo-50 p-4\">\n            <div className=\"mb-2 flex items-center gap-2\">\n              <Sparkles className=\"h-4 w-4 text-indigo-600\" />\n              <span className=\"text-xs font-medium uppercase text-indigo-700\">\n                Answer\n              </span>\n            </div>\n            <p className=\"text-sm leading-relaxed text-gray-700\">\n              {currentResponse.answer}\n            </p>\n          </div>\n\n          {/* Data Section */}\n          {Object.keys(currentResponse.data).length > 0 && (\n            <div className=\"rounded-lg border border-gray-200 bg-gray-50 p-4\">\n              <div className=\"mb-2 flex items-center gap-2\">\n                <MessageSquare className=\"h-4 w-4 text-gray-600\" />\n                <span className=\"text-xs font-medium uppercase text-gray-600\">\n                  Related Data\n                </span>\n              </div>\n              <div className=\"space-y-2\">\n                {Object.entries(currentResponse.data).map(([key, value]) => (\n                  <div\n                    key={key}\n                    className=\"flex items-start justify-between gap-4 text-sm\"\n                  >\n                    <span className=\"font-medium text-gray-600\">\n                      {key.replace(/_/g, \" \")}:\n                    </span>\n                    <span className=\"text-right text-gray-800\">\n                      {Array.isArray(value) ? (\n                        <span className=\"inline-flex flex-wrap justify-end gap-1\">\n                          {(value as unknown[]).map((item, i) => (\n                            <span\n                              key={i}\n                              className=\"rounded-full bg-gray-200 px-2 py-0.5 text-xs\"\n                            >\n                              {String(item)}\n                            </span>\n                          ))}\n                        </span>\n                      ) : (\n                        formatDataValue(value)\n                      )}\n                    </span>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n\n          {/* Metadata Footer */}\n          <div className=\"flex items-center justify-between text-xs text-gray-400\">\n            <span>Query: &quot;{currentResponse.query}&quot;</span>\n            {currentResponse.generated_at && (\n              <span>\n                Generated: {formatTimestamp(new Date(currentResponse.generated_at))}\n              </span>\n            )}\n          </div>\n\n          {/* Ask Another Button */}\n          <button\n            onClick={handleClear}\n            className=\"w-full rounded-lg border border-gray-300 py-2 text-sm font-medium text-gray-600 transition-colors hover:bg-gray-50\"\n          >\n            Ask Another Question\n          </button>\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default QueryInterface;\n",
        "timestamp": "2026-01-03T18:35:24.567548"
      },
      "worktree_state": {
        "content": "/**\n * QueryInterface Component\n *\n * Natural language query interface for governance analytics.\n * Features:\n * - Text input for natural language questions\n * - Sample query suggestions\n * - Query result display with answer and data\n * - Loading, error, and success states\n * - Query history (recent queries)\n */\n\nimport { useCallback, useState, useRef, useEffect } from \"react\";\nimport {\n  AlertCircle,\n  ChevronDown,\n  ChevronUp,\n  Clock,\n  MessageSquare,\n  Search,\n  Send,\n  Sparkles,\n  X,\n} from \"lucide-react\";\nimport { LoadingState, API_BASE_URL } from \"../lib\";\n\n/** Query response data structure from the API */\ninterface QueryResponse {\n  query: string;\n  answer: string;\n  data: Record<string, unknown>;\n  query_understood: boolean;\n  generated_at: string;\n}\n\n/** Query history item */\ninterface QueryHistoryItem {\n  query: string;\n  response: QueryResponse;\n  timestamp: Date;\n}\n\n/** Maximum number of queries to keep in history */\nconst MAX_HISTORY_ITEMS = 5;\n\n/** Sample queries to help users get started */\nconst SAMPLE_QUERIES = [\n  \"Show violations this week\",\n  \"Which policy is violated most?\",\n  \"What is the compliance trend?\",\n  \"How many violations occurred yesterday?\",\n  \"List critical security incidents\",\n];\n\n/**\n * Formats a timestamp for display\n */\nfunction formatTimestamp(date: Date): string {\n  return date.toLocaleString(undefined, {\n    dateStyle: \"short\",\n    timeStyle: \"short\",\n  });\n}\n\n/**\n * Formats data for display in a readable way\n */\nfunction formatDataValue(value: unknown): string {\n  if (value === null || value === undefined) {\n    return \"N/A\";\n  }\n  if (typeof value === \"object\") {\n    return JSON.stringify(value, null, 2);\n  }\n  return String(value);\n}\n\n/**\n * QueryInterface - Natural language query component for governance data\n *\n * Features:\n * - Text input with submit button\n * - Sample query suggestions\n * - Query result display\n * - Recent query history\n * - Loading and error states\n */\nexport function QueryInterface(): JSX.Element {\n  const [query, setQuery] = useState(\"\");\n  const [loadingState, setLoadingState] = useState<LoadingState>(\"idle\");\n  const [error, setError] = useState<string | null>(null);\n  const [currentResponse, setCurrentResponse] = useState<QueryResponse | null>(\n    null\n  );\n  const [queryHistory, setQueryHistory] = useState<QueryHistoryItem[]>([]);\n  const [showHistory, setShowHistory] = useState(false);\n  const [showSamples, setShowSamples] = useState(true);\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  /**\n   * Focus input on mount\n   */\n  useEffect(() => {\n    if (inputRef.current) {\n      inputRef.current.focus();\n    }\n  }, []);\n\n  /**\n   * Submits a query to the API\n   */\n  const submitQuery = useCallback(async (queryText: string) => {\n    if (!queryText.trim()) {\n      return;\n    }\n\n    setLoadingState(\"loading\");\n    setError(null);\n    setShowSamples(false);\n\n    try {\n      const response = await fetch(`${API_BASE_URL}/query`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Accept: \"application/json\",\n        },\n        body: JSON.stringify({ question: queryText }),\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(\n          errorData.detail || `Query failed: ${response.status}`\n        );\n      }\n\n      const data: QueryResponse = await response.json();\n      setCurrentResponse(data);\n      setLoadingState(\"success\");\n\n      // Add to history\n      setQueryHistory((prev) => {\n        const newItem: QueryHistoryItem = {\n          query: queryText,\n          response: data,\n          timestamp: new Date(),\n        };\n        const updated = [newItem, ...prev.slice(0, MAX_HISTORY_ITEMS - 1)];\n        return updated;\n      });\n    } catch (err) {\n      const message =\n        err instanceof Error ? err.message : \"Failed to process query\";\n      setError(message);\n      setLoadingState(\"error\");\n    }\n  }, []);\n\n  /**\n   * Handle form submission\n   */\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    submitQuery(query);\n  };\n\n  /**\n   * Handle sample query click\n   */\n  const handleSampleClick = (sampleQuery: string) => {\n    setQuery(sampleQuery);\n    submitQuery(sampleQuery);\n  };\n\n  /**\n   * Handle history item click\n   */\n  const handleHistoryClick = (item: QueryHistoryItem) => {\n    setQuery(item.query);\n    setCurrentResponse(item.response);\n    setLoadingState(\"success\");\n    setShowHistory(false);\n  };\n\n  /**\n   * Clear current response and reset\n   */\n  const handleClear = () => {\n    setQuery(\"\");\n    setCurrentResponse(null);\n    setLoadingState(\"idle\");\n    setError(null);\n    setShowSamples(true);\n    inputRef.current?.focus();\n  };\n\n  return (\n    <div className=\"rounded-lg bg-white p-6 shadow\">\n      {/* Header */}\n      <div className=\"mb-4 flex items-center gap-2\">\n        <MessageSquare className=\"h-5 w-5 text-indigo-600\" />\n        <h2 className=\"text-lg font-semibold text-gray-900\">\n          Ask About Governance\n        </h2>\n        <Sparkles className=\"h-4 w-4 text-yellow-500\" />\n      </div>\n\n      {/* Query Input Form */}\n      <form onSubmit={handleSubmit} className=\"relative\">\n        <div className=\"flex gap-2\">\n          <div className=\"relative flex-1\">\n            <input\n              ref={inputRef}\n              type=\"text\"\n              value={query}\n              onChange={(e) => setQuery(e.target.value)}\n              placeholder=\"Ask a question about governance data...\"\n              className=\"w-full rounded-lg border border-gray-300 py-3 pl-10 pr-4 text-sm transition-colors focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500\"\n              disabled={loadingState === \"loading\"}\n              maxLength={500}\n              aria-label=\"Query input\"\n            />\n            <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400\" />\n            {query && loadingState !== \"loading\" && (\n              <button\n                type=\"button\"\n                onClick={handleClear}\n                className=\"absolute right-3 top-1/2 -translate-y-1/2 rounded-full p-1 text-gray-400 hover:bg-gray-100 hover:text-gray-600\"\n                title=\"Clear\"\n                aria-label=\"Clear query\"\n              >\n                <X className=\"h-4 w-4\" />\n              </button>\n            )}\n          </div>\n          <button\n            type=\"submit\"\n            disabled={!query.trim() || loadingState === \"loading\"}\n            className=\"flex items-center gap-2 rounded-lg bg-indigo-600 px-4 py-3 text-sm font-medium text-white transition-colors hover:bg-indigo-700 disabled:cursor-not-allowed disabled:opacity-50\"\n            aria-label=\"Submit query\"\n          >\n            {loadingState === \"loading\" ? (\n              <div className=\"h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent\" />\n            ) : (\n              <Send className=\"h-4 w-4\" />\n            )}\n            <span className=\"hidden sm:inline\">Ask</span>\n          </button>\n        </div>\n\n        {/* History Toggle */}\n        {queryHistory.length > 0 && (\n          <button\n            type=\"button\"\n            onClick={() => setShowHistory(!showHistory)}\n            className=\"mt-2 flex items-center gap-1 text-xs text-gray-500 hover:text-gray-700\"\n          >\n            <Clock className=\"h-3 w-3\" />\n            Recent queries ({queryHistory.length})\n            {showHistory ? (\n              <ChevronUp className=\"h-3 w-3\" />\n            ) : (\n              <ChevronDown className=\"h-3 w-3\" />\n            )}\n          </button>\n        )}\n      </form>\n\n      {/* Query History */}\n      {showHistory && queryHistory.length > 0 && (\n        <div className=\"mt-3 rounded-lg border border-gray-200 bg-gray-50 p-3\">\n          <div className=\"space-y-2\">\n            {queryHistory.map((item, index) => (\n              <button\n                key={index}\n                onClick={() => handleHistoryClick(item)}\n                className=\"block w-full rounded-md px-3 py-2 text-left text-sm text-gray-700 transition-colors hover:bg-gray-100\"\n              >\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"line-clamp-1\">{item.query}</span>\n                  <span className=\"ml-2 shrink-0 text-xs text-gray-400\">\n                    {formatTimestamp(item.timestamp)}\n                  </span>\n                </div>\n              </button>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Sample Queries */}\n      {showSamples && loadingState === \"idle\" && !currentResponse && (\n        <div className=\"mt-4\">\n          <p className=\"mb-2 text-xs font-medium uppercase text-gray-500\">\n            Try asking:\n          </p>\n          <div className=\"flex flex-wrap gap-2\">\n            {SAMPLE_QUERIES.map((sample) => (\n              <button\n                key={sample}\n                onClick={() => handleSampleClick(sample)}\n                className=\"rounded-full border border-gray-200 bg-gray-50 px-3 py-1.5 text-xs text-gray-600 transition-colors hover:border-indigo-300 hover:bg-indigo-50 hover:text-indigo-700\"\n              >\n                {sample}\n              </button>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Loading State */}\n      {loadingState === \"loading\" && (\n        <div className=\"mt-6 flex items-center justify-center py-8\">\n          <div className=\"text-center\">\n            <div className=\"mx-auto h-8 w-8 animate-spin rounded-full border-4 border-indigo-600 border-t-transparent\"></div>\n            <p className=\"mt-4 text-sm text-gray-500\">\n              Processing your query...\n            </p>\n          </div>\n        </div>\n      )}\n\n      {/* Error State */}\n      {loadingState === \"error\" && (\n        <div className=\"mt-6 rounded-lg bg-red-50 p-4\">\n          <div className=\"flex items-start gap-3\">\n            <AlertCircle className=\"h-5 w-5 shrink-0 text-red-500\" />\n            <div>\n              <p className=\"font-medium text-red-800\">Query Failed</p>\n              <p className=\"mt-1 text-sm text-red-600\">{error}</p>\n              <button\n                onClick={() => submitQuery(query)}\n                className=\"mt-3 rounded-md bg-red-100 px-3 py-1.5 text-sm font-medium text-red-700 transition-colors hover:bg-red-200\"\n              >\n                Try Again\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Query Results */}\n      {loadingState === \"success\" && currentResponse && (\n        <div className=\"mt-6 space-y-4\">\n          {/* Query Understood Indicator */}\n          {!currentResponse.query_understood && (\n            <div className=\"rounded-lg border border-yellow-200 bg-yellow-50 p-3\">\n              <p className=\"text-sm text-yellow-700\">\n                Could not fully understand your query. Try rephrasing using\n                keywords like &quot;violations&quot;, &quot;policies&quot;, or\n                &quot;trends&quot;.\n              </p>\n            </div>\n          )}\n\n          {/* Answer Section */}\n          <div className=\"rounded-lg bg-indigo-50 p-4\">\n            <div className=\"mb-2 flex items-center gap-2\">\n              <Sparkles className=\"h-4 w-4 text-indigo-600\" />\n              <span className=\"text-xs font-medium uppercase text-indigo-700\">\n                Answer\n              </span>\n            </div>\n            <p className=\"text-sm leading-relaxed text-gray-700\">\n              {currentResponse.answer}\n            </p>\n          </div>\n\n          {/* Data Section */}\n          {Object.keys(currentResponse.data).length > 0 && (\n            <div className=\"rounded-lg border border-gray-200 bg-gray-50 p-4\">\n              <div className=\"mb-2 flex items-center gap-2\">\n                <MessageSquare className=\"h-4 w-4 text-gray-600\" />\n                <span className=\"text-xs font-medium uppercase text-gray-600\">\n                  Related Data\n                </span>\n              </div>\n              <div className=\"space-y-2\">\n                {Object.entries(currentResponse.data).map(([key, value]) => (\n                  <div\n                    key={key}\n                    className=\"flex items-start justify-between gap-4 text-sm\"\n                  >\n                    <span className=\"font-medium text-gray-600\">\n                      {key.replace(/_/g, \" \")}:\n                    </span>\n                    <span className=\"text-right text-gray-800\">\n                      {Array.isArray(value) ? (\n                        <span className=\"inline-flex flex-wrap justify-end gap-1\">\n                          {(value as unknown[]).map((item, i) => (\n                            <span\n                              key={i}\n                              className=\"rounded-full bg-gray-200 px-2 py-0.5 text-xs\"\n                            >\n                              {String(item)}\n                            </span>\n                          ))}\n                        </span>\n                      ) : (\n                        formatDataValue(value)\n                      )}\n                    </span>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n\n          {/* Metadata Footer */}\n          <div className=\"flex items-center justify-between text-xs text-gray-400\">\n            <span>Query: &quot;{currentResponse.query}&quot;</span>\n            {currentResponse.generated_at && (\n              <span>\n                Generated: {formatTimestamp(new Date(currentResponse.generated_at))}\n              </span>\n            )}\n          </div>\n\n          {/* Ask Another Button */}\n          <button\n            onClick={handleClear}\n            className=\"w-full rounded-lg border border-gray-300 py-2 text-sm font-medium text-gray-600 transition-colors hover:bg-gray-50\"\n          >\n            Ask Another Question\n          </button>\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default QueryInterface;\n",
        "last_modified": "2026-01-03T19:10:12.018940"
      },
      "task_intent": {
        "title": "054-extract-duplicated-loadingstate-and-api-config-in-",
        "description": "The analytics-dashboard has 4 widget components (PredictionWidget, AnomalyWidget, InsightWidget, QueryInterface) that each independently define the same LoadingState type and API_BASE_URL constant. This pattern is repeated across 7+ files when including tests, leading to maintenance burden and potential inconsistencies.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-03T18:35:24.582127",
  "last_updated": "2026-01-03T18:35:24.584199"
}