{
  "file_path": "./examples/04-end-to-end-governance-workflow/policies/audit.rego",
  "main_branch_history": [],
  "task_views": {
    "061-create-end-to-end-governance-workflow-examples-wit": {
      "task_id": "061-create-end-to-end-governance-workflow-examples-wit",
      "branch_point": {
        "commit_hash": "fc6e42927298263034acf989773f3200e422ad17",
        "content": "# Constitutional Hash: cdd01ef066bc6cf2\n# ACGS-2 Example 04: End-to-End Governance Workflow\n# Audit Policy - Defines what should be logged and compliance metadata\n\npackage acgs2.audit\n\nimport rego.v1\n\n# =============================================================================\n# AUDIT LOGGING REQUIREMENTS\n# =============================================================================\n\n# Default behavior: Always log governance decisions\n# All actions should be logged for accountability and compliance\ndefault should_log := true\n\n# =============================================================================\n# RETENTION PERIOD CALCULATION\n# =============================================================================\n\n# Retention periods are based on data sensitivity and regulatory requirements\n# Longer retention for sensitive data and compliance requirements\n\n# 7 years (2555 days) for PII access - GDPR/HIPAA compliance\nretention_days := 2555 if {\n\tinput.action.type == \"access_pii\"\n}\n\n# 7 years for health-related data - HIPAA compliance\nretention_days := 2555 if {\n\tcontains(lower(input.action.resource), \"health\")\n}\n\n# 7 years for financial data - SOX/PCI compliance\nretention_days := 2555 if {\n\tcontains(lower(input.action.resource), \"financial\")\n}\n\n# 7 years for any denied action - security audit trail\nretention_days := 2555 if {\n\tinput.decision == \"deny\"\n}\n\n# 3 years (1095 days) for production environment - operational compliance\nretention_days := 1095 if {\n\tinput.context.environment == \"production\"\n\tnot extended_retention_required\n}\n\n# 1 year (365 days) for other environments - default retention\nretention_days := 365 if {\n\tnot extended_retention_required\n\tinput.context.environment != \"production\"\n}\n\n# Default to 1 year if environment not specified\nretention_days := 365 if {\n\tnot input.context.environment\n\tnot extended_retention_required\n}\n\n# Helper rule to check if extended retention is required\nextended_retention_required if {\n\tinput.action.type == \"access_pii\"\n}\n\nextended_retention_required if {\n\tcontains(lower(input.action.resource), \"health\")\n}\n\nextended_retention_required if {\n\tcontains(lower(input.action.resource), \"financial\")\n}\n\nextended_retention_required if {\n\tinput.decision == \"deny\"\n}\n\n# =============================================================================\n# COMPLIANCE TAGGING\n# =============================================================================\n\n# Compliance tags help identify which regulatory frameworks apply\n# Multiple tags can apply to a single action\n\n# SOC2 - System and Organization Controls (production operations)\ncompliance_tags contains \"SOC2\" if {\n\tinput.context.environment == \"production\"\n}\n\n# SOC2 - All denials for security audit\ncompliance_tags contains \"SOC2\" if {\n\tinput.decision == \"deny\"\n}\n\n# SOC2 - High-risk actions requiring HITL\ncompliance_tags contains \"SOC2\" if {\n\tinput.hitl_required == true\n}\n\n# GDPR - General Data Protection Regulation (PII access)\ncompliance_tags contains \"GDPR\" if {\n\tinput.action.type == \"access_pii\"\n}\n\n# GDPR - Any action on customer data\ncompliance_tags contains \"GDPR\" if {\n\tcontains(lower(input.action.resource), \"customer\")\n}\n\n# GDPR - Any action on personal data\ncompliance_tags contains \"GDPR\" if {\n\tcontains(lower(input.action.resource), \"personal\")\n}\n\n# HIPAA - Health Insurance Portability and Accountability Act\ncompliance_tags contains \"HIPAA\" if {\n\tcontains(lower(input.action.resource), \"health\")\n}\n\n# HIPAA - Medical or patient data\ncompliance_tags contains \"HIPAA\" if {\n\tcontains(lower(input.action.resource), \"medical\")\n}\n\ncompliance_tags contains \"HIPAA\" if {\n\tcontains(lower(input.action.resource), \"patient\")\n}\n\n# PCI-DSS - Payment Card Industry Data Security Standard\ncompliance_tags contains \"PCI-DSS\" if {\n\tcontains(lower(input.action.resource), \"payment\")\n}\n\ncompliance_tags contains \"PCI-DSS\" if {\n\tcontains(lower(input.action.resource), \"card\")\n}\n\ncompliance_tags contains \"PCI-DSS\" if {\n\tcontains(lower(input.action.resource), \"financial\")\n}\n\n# ISO 27001 - Information Security Management\ncompliance_tags contains \"ISO27001\" if {\n\tinput.action.type == \"modify_config\"\n\tinput.context.environment == \"production\"\n}\n\ncompliance_tags contains \"ISO27001\" if {\n\tinput.action.type == \"delete_resource\"\n}\n\n# =============================================================================\n# LOG DETAIL LEVEL\n# =============================================================================\n\n# Log detail level determines how much information to capture\n# More detailed logging for sensitive or denied actions\n\n# Detailed logging for all denials (need to understand why actions were blocked)\nlog_level := \"detailed\" if {\n\tinput.decision == \"deny\"\n}\n\n# Detailed logging for HITL-required actions (need full context for human review)\nlog_level := \"detailed\" if {\n\tinput.hitl_required == true\n}\n\n# Detailed logging for high-risk actions (risk >= 0.7)\nlog_level := \"detailed\" if {\n\tinput.risk_score >= 0.7\n}\n\n# Detailed logging for production environment changes\nlog_level := \"detailed\" if {\n\tinput.context.environment == \"production\"\n\tproduction_change_action\n}\n\n# Detailed logging for PII access\nlog_level := \"detailed\" if {\n\tinput.action.type == \"access_pii\"\n}\n\n# Detailed logging for any compliance-tagged action\nlog_level := \"detailed\" if {\n\tcount(compliance_tags) > 0\n}\n\n# Summary logging for low-risk approved actions\nlog_level := \"summary\" if {\n\tinput.risk_score < 0.3\n\tinput.decision == \"allow\"\n\tnot input.hitl_required\n}\n\n# Default to normal logging if none of the above apply\nlog_level := \"normal\" if {\n\tnot input.decision == \"deny\"\n\tnot input.hitl_required\n\tinput.risk_score >= 0.3\n\tinput.risk_score < 0.7\n}\n\n# =============================================================================\n# METADATA INCLUSION\n# =============================================================================\n\n# Include full metadata for compliance-tagged actions\ndefault include_metadata := false\n\ninclude_metadata if {\n\tcount(compliance_tags) > 0\n}\n\n# Include metadata for production environment\ninclude_metadata if {\n\tinput.context.environment == \"production\"\n}\n\n# Include metadata for HITL actions\ninclude_metadata if {\n\tinput.hitl_required == true\n}\n\n# Include metadata for denied actions\ninclude_metadata if {\n\tinput.decision == \"deny\"\n}\n\n# Include metadata for high-risk actions\ninclude_metadata if {\n\tinput.risk_score >= 0.7\n}\n\n# =============================================================================\n# SENSITIVE DATA DETECTION\n# =============================================================================\n\n# Identify if the action involves sensitive data that requires extra logging care\nsensitive_data_involved if {\n\tinput.action.type == \"access_pii\"\n}\n\nsensitive_data_involved if {\n\tcontains(lower(input.action.resource), \"health\")\n}\n\nsensitive_data_involved if {\n\tcontains(lower(input.action.resource), \"medical\")\n}\n\nsensitive_data_involved if {\n\tcontains(lower(input.action.resource), \"financial\")\n}\n\nsensitive_data_involved if {\n\tcontains(lower(input.action.resource), \"payment\")\n}\n\nsensitive_data_involved if {\n\tcontains(lower(input.action.resource), \"personal\")\n}\n\nsensitive_data_involved if {\n\tcontains(lower(input.action.resource), \"customer\")\n}\n\n# =============================================================================\n# HELPER RULES\n# =============================================================================\n\n# Production change actions that need detailed logging\nproduction_change_action if {\n\tinput.action.type == \"modify_config\"\n}\n\nproduction_change_action if {\n\tinput.action.type == \"deploy_model\"\n}\n\nproduction_change_action if {\n\tinput.action.type == \"delete_resource\"\n}\n\nproduction_change_action if {\n\tinput.action.type == \"execute_code\"\n}\n\n# String helper for case-insensitive contains\nlower(s) := lower_s if {\n\tlower_s := lower(s)\n}\n\n# =============================================================================\n# RESULT STRUCTURE\n# =============================================================================\n\n# Main result that includes all audit requirements\nresult := {\n\t\"should_log\": should_log,\n\t\"retention_days\": retention_days,\n\t\"compliance_tags\": compliance_tags,\n\t\"log_level\": log_level,\n\t\"include_metadata\": include_metadata,\n\t\"sensitive_data\": sensitive_data_involved,\n\t\"action_type\": input.action.type,\n\t\"environment\": input.context.environment,\n\t\"decision\": input.decision,\n}\n",
        "timestamp": "2026-01-04T05:35:49.744738"
      },
      "worktree_state": null,
      "task_intent": {
        "title": "061-create-end-to-end-governance-workflow-examples-wit",
        "description": "Create comprehensive examples demonstrating complete governance workflows from policy creation through enforcement to audit logging, targeting Enterprise DevOps/MLOps engineers deploying AI systems. The examples will show: defining constitutional policies, enforcing them on agent actions, handling HITL approvals, and auditing decisions.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-03T19:36:07.420120",
  "last_updated": "2026-01-04T05:35:49.796028"
}