{
  "file_path": "src/core/enhanced_agent_bus/security_helpers.py",
  "main_branch_history": [],
  "task_views": {
    "056-reduce-excessive-any-type-usage-in-python-codebase": {
      "task_id": "056-reduce-excessive-any-type-usage-in-python-codebase",
      "branch_point": {
        "commit_hash": "fc6e42927298263034acf989773f3200e422ad17",
        "content": "\"\"\"\nACGS-2 Enhanced Agent Bus - Security Helpers\nConstitutional Hash: cdd01ef066bc6cf2\n\"\"\"\n\nimport re\nfrom typing import Any, List, Optional\n\nfrom .security.tenant_validator import TenantValidator\n\n\ndef normalize_tenant_id(tenant_id: Optional[str]) -> Optional[str]:\n    \"\"\"Normalize tenant identifiers to a canonical optional value.\"\"\"\n    return TenantValidator.normalize(tenant_id)\n\n\ndef format_tenant_id(tenant_id: Optional[str]) -> str:\n    \"\"\"Format tenant identifiers for logging and validation messages.\"\"\"\n    return tenant_id if tenant_id else \"none\"\n\n\ndef validate_tenant_consistency(\n    agents_registry: dict, from_agent: str, to_agent: Optional[str], message_tenant: Optional[str]\n) -> List[str]:\n    \"\"\"Validate tenant_id consistency for sender/recipient.\"\"\"\n    errors: List[str] = []\n    norm_msg_tenant = normalize_tenant_id(message_tenant)\n\n    if from_agent in agents_registry:\n        sender_tenant = normalize_tenant_id(agents_registry[from_agent].get(\"tenant_id\"))\n        if sender_tenant != norm_msg_tenant:\n            errors.append(\n                f\"Tenant mismatch: message tenant_id '{format_tenant_id(norm_msg_tenant)}' \"\n                f\"does not match sender tenant_id '{format_tenant_id(sender_tenant)}'\"\n            )\n\n    if to_agent and to_agent in agents_registry:\n        recipient_tenant = normalize_tenant_id(agents_registry[to_agent].get(\"tenant_id\"))\n        if recipient_tenant != norm_msg_tenant:\n            errors.append(\n                f\"Tenant mismatch: message tenant_id '{format_tenant_id(norm_msg_tenant)}' \"\n                f\"does not match recipient tenant_id '{format_tenant_id(recipient_tenant)}'\"\n            )\n\n    return errors\n\n\nPROMPT_INJECTION_PATTERNS = [\n    r\"ignore (all )?previous instructions\",\n    r\"system prompt (leak|override)\",\n    r\"do anything now\",\n    r\"jailbreak\",\n    r\"persona (adoption|override)\",\n    r\"\\(note to self: .*\\)\",\n    r\"\\[INST\\].*\\[/INST\\]\",\n]\n_INJECTION_RE = re.compile(\"|\".join(PROMPT_INJECTION_PATTERNS), re.IGNORECASE)\n\n\ndef detect_prompt_injection(content: Any) -> bool:\n    \"\"\"Detect potential prompt injection attacks.\"\"\"\n    content_str = content if isinstance(content, str) else str(content)\n    return bool(_INJECTION_RE.search(content_str))\n",
        "timestamp": "2026-01-04T05:35:58.374613"
      },
      "worktree_state": null,
      "task_intent": {
        "title": "056-reduce-excessive-any-type-usage-in-python-codebase",
        "description": "Found 373 occurrences of ': Any' type annotations across 120+ Python files, with high concentrations in integration-service (16 occurrences), src/core/breakthrough (79 occurrences), and src/core/enhanced_agent_bus (50+ occurrences). Excessive use of 'Any' defeats the purpose of type hints and can mask type-related bugs.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-03T19:36:18.163800",
  "last_updated": "2026-01-04T05:35:59.209325"
}