{
  "file_path": "acgs2-observability/monitoring/dashboard/CDN_OPTIMIZATION.md",
  "main_branch_history": [],
  "task_views": {
    "052-replace-recharts-with-lightweight-chart-library": {
      "task_id": "052-replace-recharts-with-lightweight-chart-library",
      "branch_point": {
        "commit_hash": "fc6e42927298263034acf989773f3200e422ad17",
        "content": "# ACGS-2 Monitoring Dashboard - Frontend and CDN Optimization Guide\n\n**Constitutional Hash**: cdd01ef066bc6cf2\n\n## Overview\n\nThis document outlines the frontend performance optimizations applied to the ACGS-2 Monitoring Dashboard and provides recommendations for CDN configuration and caching strategies.\n\n## Applied Optimizations\n\n### 1. React Component Optimizations\n\nAll components have been optimized with:\n\n- **React.memo()**: Prevents unnecessary re-renders when props haven't changed\n- **useMemo()**: Memoizes expensive computations (sorting, formatting, data transformations)\n- **useCallback()**: Memoizes callback functions to maintain referential equality\n- **Component Extraction**: Breaking down large components into smaller, memoized sub-components\n\n#### Components Optimized:\n- `StatusBadge.tsx` - Memoized with static lookup tables\n- `MetricCard.tsx` - Memoized with value formatting optimization\n- `MetricsChart.tsx` - Lazy-loaded Recharts with data transformation memoization\n- `HealthPanel.tsx` - Memoized with computed health values\n- `AlertsList.tsx` - Memoized with severity sorting optimization\n- `ServiceGrid.tsx` - Memoized with status sorting optimization\n\n### 2. Bundle Optimization (Vite Configuration)\n\n```javascript\n// vite.config.ts optimizations applied:\n- Manual chunk splitting for vendor libraries\n- CSS code splitting and minification\n- ESNext target for modern browsers\n- Content-hash based file naming for cache invalidation\n- Tree shaking and dead code elimination\n```\n\n#### Chunk Strategy:\n| Chunk Name | Contents | Update Frequency |\n|------------|----------|------------------|\n| vendor-react | react, react-dom | Rare |\n| vendor-recharts | recharts | Rare |\n| vendor-icons | lucide-react | Rare |\n| index | Application code | Frequent |\n\n### 3. Lazy Loading\n\n- **Recharts Components**: Lazy-loaded to reduce initial bundle size (~200KB saved on initial load)\n- **Suspense Boundaries**: Loading fallbacks for better perceived performance\n\n### 4. Core Web Vitals Optimizations\n\n#### Largest Contentful Paint (LCP)\n- Inline critical CSS for faster first paint\n- Preconnect to API server\n- Loading skeleton during app initialization\n\n#### First Input Delay (FID)\n- Disabled chart animations for immediate interactivity\n- Memoized event handlers with useCallback\n\n#### Cumulative Layout Shift (CLS)\n- Fixed heights on loading skeletons\n- Explicit dimensions on chart containers\n\n## CDN Configuration Recommendations\n\n### Recommended CDN Providers\n1. **CloudFront** (AWS) - Best for AWS infrastructure\n2. **Cloudflare** - Best for global distribution\n3. **Fastly** - Best for real-time purging needs\n\n### Cache Headers Configuration\n\n#### Static Assets (JS, CSS, Images)\n```nginx\n# Nginx configuration\nlocation ~* \\.(js|css|png|jpg|jpeg|gif|ico|svg|woff2)$ {\n    expires 1y;\n    add_header Cache-Control \"public, max-age=31536000, immutable\";\n    add_header Vary \"Accept-Encoding\";\n}\n```\n\n#### HTML Files\n```nginx\nlocation ~* \\.html$ {\n    expires 5m;\n    add_header Cache-Control \"public, max-age=300, must-revalidate\";\n}\n```\n\n### CloudFront Configuration\n\n```yaml\n# cloudfront-distribution.yaml\nCacheBehaviors:\n  - PathPattern: \"/assets/*\"\n    CachePolicyId: \"658327ea-f89d-4fab-a63d-7e88639e58f6\"  # CachingOptimized\n    ResponseHeadersPolicyId: \"5cc3b908-e619-4b99-88e5-2cf7f45965bd\"  # CORS-S3Origin\n    Compress: true\n    ViewerProtocolPolicy: redirect-to-https\n\n  - PathPattern: \"/*.js\"\n    TTL:\n      DefaultTTL: 31536000\n      MaxTTL: 31536000\n      MinTTL: 31536000\n    Compress: true\n\n  - PathPattern: \"/*.css\"\n    TTL:\n      DefaultTTL: 31536000\n      MaxTTL: 31536000\n      MinTTL: 31536000\n    Compress: true\n```\n\n### Cloudflare Page Rules\n\n```\n# Rule 1: Static assets - long cache\nURL: *acgs-dashboard.example.com/assets/*\nSettings:\n  - Cache Level: Cache Everything\n  - Edge Cache TTL: 1 year\n  - Browser Cache TTL: 1 year\n\n# Rule 2: HTML - short cache with revalidation\nURL: *acgs-dashboard.example.com/*.html\nSettings:\n  - Cache Level: Cache Everything\n  - Edge Cache TTL: 5 minutes\n  - Browser Cache TTL: 5 minutes\n\n# Rule 3: API bypass\nURL: *acgs-dashboard.example.com/dashboard/*\nSettings:\n  - Cache Level: Bypass\n```\n\n## Expected Performance Improvements\n\n### Bundle Size Reduction\n| Metric | Before | After | Improvement |\n|--------|--------|-------|-------------|\n| Initial JS | ~400KB | ~150KB | 62.5% |\n| Recharts Chunk | N/A | ~200KB (lazy) | Deferred |\n| Total Transferred | ~450KB | ~180KB | 60% |\n\n### Core Web Vitals Targets\n| Metric | Target | Expected |\n|--------|--------|----------|\n| LCP | < 2.5s | < 1.5s |\n| FID | < 100ms | < 50ms |\n| CLS | < 0.1 | < 0.05 |\n\n### Re-render Reduction\n- **Dashboard**: 50-70% fewer re-renders with memoization\n- **Lists**: Individual item updates don't trigger list re-render\n- **Charts**: Data transformation cached between renders\n\n## Deployment Checklist\n\n- [ ] Run `npm install` to install @types/node\n- [ ] Run `npm run build` to generate optimized production bundle\n- [ ] Verify chunk splitting in build output\n- [ ] Configure CDN with recommended cache headers\n- [ ] Set up cache invalidation strategy (content-hash naming handles this)\n- [ ] Enable Brotli/Gzip compression on CDN\n- [ ] Configure CORS if needed for API requests\n- [ ] Test with Lighthouse for Core Web Vitals scores\n\n## Monitoring Recommendations\n\n### Performance Monitoring\n- Use Web Vitals library to track real user metrics\n- Set up Lighthouse CI in deployment pipeline\n- Monitor bundle size in CI to prevent regression\n\n### CDN Metrics to Track\n- Cache hit ratio (target: > 95%)\n- Time to First Byte (TTFB)\n- Origin response time\n- Bandwidth savings\n\n## Additional Optimization Opportunities\n\n### Future Enhancements\n1. **Service Worker**: Add offline caching for static assets\n2. **HTTP/3**: Enable QUIC protocol support on CDN\n3. **Image Optimization**: Add responsive images if screenshots are added\n4. **Preloading**: Add predictive prefetching for common navigation paths\n5. **Bundle Analysis**: Use `vite-plugin-bundle-analyzer` for regular audits\n\n### Production Considerations\n- Remove source maps in production (`sourcemap: false`)\n- Enable Brotli compression (better than gzip for text)\n- Consider edge rendering for initial HTML if latency is critical\n- Monitor WebSocket connections separately from static asset CDN\n\n---\n\n*Last Updated: 2024*\n*Constitutional Hash: cdd01ef066bc6cf2*\n",
        "timestamp": "2026-01-04T05:36:13.611399"
      },
      "worktree_state": null,
      "task_intent": {
        "title": "052-replace-recharts-with-lightweight-chart-library",
        "description": "Replace recharts (~500KB unparsed, ~150KB gzipped) with a lightweight charting library like visx (~40KB) or uPlot (~30KB) to reduce bundle size and improve dashboard performance. Used in PredictionWidget (analytics-dashboard) and MetricsChart (observability dashboard).",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-03T19:36:23.124005",
  "last_updated": "2026-01-04T05:36:13.690399"
}