{
  "file_path": "claude-flow/src/config/envSchema.ts",
  "main_branch_history": [],
  "task_views": {
    "059-add-jsdoc-coverage-for-claude-flow-typescript-serv": {
      "task_id": "059-add-jsdoc-coverage-for-claude-flow-typescript-serv",
      "branch_point": {
        "commit_hash": "fc6e42927298263034acf989773f3200e422ad17",
        "content": "/**\n * Environment Variable Schema Definitions\n *\n * This module defines Zod schemas for all environment variables used by the ACGS-2 services.\n * All environment variables are validated at application startup to ensure fail-fast behavior.\n *\n * @module envSchema\n */\n\nimport { z } from 'zod';\n\n/**\n * Transforms a string to a boolean value.\n * Accepts: 'true', '1', 'yes' for true; 'false', '0', 'no', '' for false.\n */\nconst booleanTransform = z\n  .string()\n  .optional()\n  .default('false')\n  .transform((val) => {\n    const lowered = val.toLowerCase().trim();\n    return lowered === 'true' || lowered === '1' || lowered === 'yes';\n  })\n  .describe('Boolean string (true/false, 1/0, yes/no)');\n\n/**\n * Transforms a string to a positive integer with optional default value.\n */\nconst positiveIntTransform = (defaultValue: number) =>\n  z\n    .string()\n    .optional()\n    .default(String(defaultValue))\n    .transform((val) => {\n      const parsed = parseInt(val, 10);\n      if (isNaN(parsed) || parsed < 1) {\n        throw new Error(`Expected positive integer, got: ${val}`);\n      }\n      return parsed;\n    });\n\n/**\n * URL schema with optional protocol validation.\n * Accepts redis://, http://, https://, kafka:// protocols.\n */\nconst urlSchema = (protocols: string[] = ['http', 'https']) =>\n  z\n    .string()\n    .optional()\n    .refine(\n      (val) => {\n        if (!val) return true; // Optional URLs pass if not provided\n        try {\n          const url = new URL(val);\n          const protocol = url.protocol.replace(':', '');\n          return protocols.includes(protocol);\n        } catch {\n          return false;\n        }\n      },\n      (val) => ({\n        message: `Invalid URL format. Expected protocols: ${protocols.join(', ')}. Got: ${val}`,\n      })\n    );\n\n/**\n * Log level enum values.\n */\nconst LogLevelEnum = z.enum(['DEBUG', 'INFO', 'WARN', 'ERROR']).describe(\n  'Logging level: DEBUG for verbose output, INFO for standard, WARN for warnings only, ERROR for errors only'\n);\n\n/**\n * Environment enum values.\n */\nconst EnvironmentEnum = z\n  .enum(['development', 'staging', 'production'])\n  .describe('Deployment environment: development, staging, or production');\n\n/**\n * Shared environment variable schema for ACGS-2 services.\n *\n * This schema validates all environment variables required for service operation,\n * including infrastructure configuration, timeouts, and logging settings.\n */\nexport const EnvSchema = z.object({\n  // ============================================\n  // Environment Configuration\n  // ============================================\n\n  /**\n   * Tenant identifier for multi-tenancy support.\n   * Example: 'acgs-dev', 'acgs-prod'\n   */\n  TENANT_ID: z\n    .string()\n    .min(1, 'TENANT_ID is required and cannot be empty')\n    .default('acgs-dev')\n    .describe('Unique tenant identifier for multi-tenancy support'),\n\n  /**\n   * Deployment environment name.\n   * Controls security policies and logging verbosity.\n   */\n  ENVIRONMENT: EnvironmentEnum.default('development'),\n\n  /**\n   * Logging level for application output.\n   */\n  LOG_LEVEL: LogLevelEnum.default('INFO'),\n\n  /**\n   * Enable debug mode for verbose logging.\n   * WARNING: Must be disabled in production environments.\n   */\n  DEBUG: booleanTransform,\n\n  /**\n   * Enable hot-reload for development.\n   * Only effective in development environments.\n   */\n  RELOAD: booleanTransform,\n\n  // ============================================\n  // Infrastructure Configuration\n  // ============================================\n\n  /**\n   * Redis connection URL.\n   * Format: redis://host:port or redis://user:password@host:port\n   */\n  REDIS_URL: urlSchema(['redis', 'rediss'])\n    .default('redis://localhost:6379')\n    .describe('Redis connection URL (redis:// or rediss:// for TLS)'),\n\n  /**\n   * Redis authentication password.\n   * Sensitive: Should be at least 8 characters in production.\n   */\n  REDIS_PASSWORD: z\n    .string()\n    .optional()\n    .default('')\n    .describe('Redis authentication password (sensitive)'),\n\n  /**\n   * Kafka bootstrap server address.\n   * Format: host:port or kafka://host:port\n   */\n  KAFKA_BOOTSTRAP: z\n    .string()\n    .optional()\n    .default('')\n    .describe('Kafka bootstrap server address (host:port)'),\n\n  /**\n   * Kafka authentication password.\n   * Sensitive: Required for secured Kafka clusters.\n   */\n  KAFKA_PASSWORD: z\n    .string()\n    .optional()\n    .default('')\n    .describe('Kafka authentication password (sensitive)'),\n\n  /**\n   * Agent Bus service URL.\n   * Used for inter-agent communication.\n   */\n  AGENT_BUS_URL: urlSchema(['http', 'https'])\n    .default('http://localhost:8000')\n    .describe('Agent Bus service URL for inter-agent communication'),\n\n  /**\n   * Open Policy Agent (OPA) service URL.\n   * Used for policy evaluation and enforcement.\n   */\n  OPA_URL: urlSchema(['http', 'https'])\n    .default('http://localhost:8181')\n    .describe('OPA service URL for policy evaluation'),\n\n  /**\n   * Human-in-the-Loop (HITL) Approvals service URL.\n   */\n  HITL_APPROVALS_URL: urlSchema(['http', 'https'])\n    .default('http://localhost:8002')\n    .describe('HITL Approvals service URL'),\n\n  /**\n   * Human-in-the-Loop (HITL) Approvals service port.\n   * Must be a valid port number (1-65535).\n   */\n  HITL_APPROVALS_PORT: z\n    .string()\n    .optional()\n    .default('8002')\n    .transform((val) => {\n      const port = parseInt(val, 10);\n      if (isNaN(port) || port < 1 || port > 65535) {\n        throw new Error(`Invalid port number. Must be 1-65535, got: ${val}`);\n      }\n      return port;\n    })\n    .describe('HITL Approvals service port (1-65535)'),\n\n  // ============================================\n  // Timeout Configuration\n  // ============================================\n\n  /**\n   * Default timeout for escalation requests in minutes.\n   * Used when no specific timeout is configured.\n   */\n  DEFAULT_ESCALATION_TIMEOUT_MINUTES: positiveIntTransform(30).describe(\n    'Default escalation timeout in minutes (default: 30)'\n  ),\n\n  /**\n   * Timeout for critical escalation requests in minutes.\n   * Should be shorter than default for faster response.\n   */\n  CRITICAL_ESCALATION_TIMEOUT_MINUTES: positiveIntTransform(15).describe(\n    'Critical escalation timeout in minutes (default: 15)'\n  ),\n\n  /**\n   * Timeout for emergency escalation requests in minutes.\n   * Used for extended monitoring periods.\n   */\n  EMERGENCY_ESCALATION_TIMEOUT_MINUTES: positiveIntTransform(60).describe(\n    'Emergency escalation timeout in minutes (default: 60)'\n  ),\n});\n\n/**\n * Type definition for validated environment configuration.\n * Generated from the EnvSchema Zod schema.\n */\nexport type EnvConfig = z.infer<typeof EnvSchema>;\n\n/**\n * Type definition for raw environment input (before transformation).\n * All values are optional strings as they come from process.env.\n */\nexport type EnvInput = z.input<typeof EnvSchema>;\n\n/**\n * Schema for validating that required sensitive fields meet security requirements.\n * Applied after base schema validation in production environments.\n */\nexport const ProductionSecuritySchema = z\n  .object({\n    REDIS_PASSWORD: z\n      .string()\n      .min(8, 'REDIS_PASSWORD must be at least 8 characters in production'),\n    KAFKA_PASSWORD: z\n      .string()\n      .min(8, 'KAFKA_PASSWORD must be at least 8 characters in production')\n      .optional(),\n  })\n  .describe('Security requirements for production environment');\n\n/**\n * Export schema for external use and testing.\n */\nexport default EnvSchema;\n",
        "timestamp": "2026-01-04T05:35:52.969195"
      },
      "worktree_state": null,
      "task_intent": {
        "title": "Add JSDoc coverage for claude-flow TypeScript service public exports",
        "description": "Add comprehensive JSDoc documentation to the 45 exported functions/classes across 17 TypeScript files in the claude-flow CLI tool to improve API documentation for enterprise users",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-04T05:35:53.046159",
  "last_updated": "2026-01-04T05:35:53.049211"
}