{
  "file_path": ".agent/workflows/base/context.py",
  "main_branch_history": [],
  "task_views": {
    "056-reduce-excessive-any-type-usage-in-python-codebase": {
      "task_id": "056-reduce-excessive-any-type-usage-in-python-codebase",
      "branch_point": {
        "commit_hash": "fc6e42927298263034acf989773f3200e422ad17",
        "content": "\"\"\"\nACGS-2 Workflow Context\nConstitutional Hash: cdd01ef066bc6cf2\n\nState container passed through workflow execution.\nAccumulates results from each step and provides shared state.\n\"\"\"\n\nimport uuid\nfrom dataclasses import dataclass, field\nfrom datetime import datetime, timezone\nfrom typing import Any, Dict, List, Optional\n\ntry:\n    from shared.constants import CONSTITUTIONAL_HASH\nexcept ImportError:\n    CONSTITUTIONAL_HASH = \"cdd01ef066bc6cf2\"\n\n\n@dataclass\nclass WorkflowContext:\n    \"\"\"\n    Context passed through workflow execution.\n\n    Accumulates results from each step and provides shared state.\n    Thread-safe for concurrent step execution.\n\n    Attributes:\n        workflow_id: Unique workflow instance identifier\n        constitutional_hash: Expected constitutional hash for validation\n        tenant_id: Multi-tenant isolation identifier\n        correlation_id: Tracing correlation identifier\n        step_results: Results from completed steps\n        errors: Accumulated errors during execution\n        metadata: Additional context data\n        started_at: Workflow start timestamp\n    \"\"\"\n\n    workflow_id: str\n    constitutional_hash: str = CONSTITUTIONAL_HASH\n    tenant_id: Optional[str] = None\n    correlation_id: Optional[str] = None\n    step_results: Dict[str, Any] = field(default_factory=dict)\n    errors: List[str] = field(default_factory=list)\n    metadata: Dict[str, Any] = field(default_factory=dict)\n    started_at: datetime = field(default_factory=lambda: datetime.now(timezone.utc))\n    parent_workflow_id: Optional[str] = None\n    trace_id: Optional[str] = None\n\n    def __post_init__(self):\n        \"\"\"Initialize derived fields.\"\"\"\n        if self.trace_id is None:\n            self.trace_id = str(uuid.uuid4())\n        if self.correlation_id is None:\n            self.correlation_id = self.trace_id\n\n    def get_step_result(self, step_name: str) -> Optional[Any]:\n        \"\"\"\n        Get result from a previously completed step.\n\n        Args:\n            step_name: Name of the step\n\n        Returns:\n            Step result if available, None otherwise\n        \"\"\"\n        return self.step_results.get(step_name)\n\n    def set_step_result(self, step_name: str, result: Any) -> None:\n        \"\"\"\n        Store result from a completed step.\n\n        Args:\n            step_name: Name of the step\n            result: Step execution result\n        \"\"\"\n        self.step_results[step_name] = result\n\n    def has_step_result(self, step_name: str) -> bool:\n        \"\"\"Check if a step has completed with a result.\"\"\"\n        return step_name in self.step_results\n\n    def add_error(self, error: str) -> None:\n        \"\"\"Add an error to the context.\"\"\"\n        self.errors.append(error)\n\n    def has_errors(self) -> bool:\n        \"\"\"Check if any errors have been recorded.\"\"\"\n        return len(self.errors) > 0\n\n    def get_elapsed_time_ms(self) -> float:\n        \"\"\"Get elapsed time since workflow start in milliseconds.\"\"\"\n        elapsed = datetime.now(timezone.utc) - self.started_at\n        return elapsed.total_seconds() * 1000\n\n    def to_dict(self) -> Dict[str, Any]:\n        \"\"\"Convert context to dictionary for serialization.\"\"\"\n        return {\n            \"workflow_id\": self.workflow_id,\n            \"constitutional_hash\": self.constitutional_hash,\n            \"tenant_id\": self.tenant_id,\n            \"correlation_id\": self.correlation_id,\n            \"step_results\": self.step_results.copy(),\n            \"errors\": self.errors.copy(),\n            \"metadata\": self.metadata.copy(),\n            \"started_at\": self.started_at.isoformat(),\n            \"parent_workflow_id\": self.parent_workflow_id,\n            \"trace_id\": self.trace_id,\n            \"elapsed_time_ms\": self.get_elapsed_time_ms(),\n        }\n\n    @classmethod\n    def from_dict(cls, data: Dict[str, Any]) -> \"WorkflowContext\":\n        \"\"\"Create context from dictionary.\"\"\"\n        started_at = data.get(\"started_at\")\n        if isinstance(started_at, str):\n            started_at = datetime.fromisoformat(started_at.replace(\"Z\", \"+00:00\"))\n        elif started_at is None:\n            started_at = datetime.now(timezone.utc)\n\n        return cls(\n            workflow_id=data[\"workflow_id\"],\n            constitutional_hash=data.get(\"constitutional_hash\", CONSTITUTIONAL_HASH),\n            tenant_id=data.get(\"tenant_id\"),\n            correlation_id=data.get(\"correlation_id\"),\n            step_results=data.get(\"step_results\", {}),\n            errors=data.get(\"errors\", []),\n            metadata=data.get(\"metadata\", {}),\n            started_at=started_at,\n            parent_workflow_id=data.get(\"parent_workflow_id\"),\n            trace_id=data.get(\"trace_id\"),\n        )\n\n    @classmethod\n    def create(\n        cls,\n        tenant_id: Optional[str] = None,\n        parent_workflow_id: Optional[str] = None,\n        metadata: Optional[Dict[str, Any]] = None,\n    ) -> \"WorkflowContext\":\n        \"\"\"\n        Factory method to create a new workflow context.\n\n        Args:\n            tenant_id: Optional tenant identifier\n            parent_workflow_id: Optional parent workflow for sub-workflows\n            metadata: Optional initial metadata\n\n        Returns:\n            New WorkflowContext instance\n        \"\"\"\n        return cls(\n            workflow_id=str(uuid.uuid4()),\n            tenant_id=tenant_id,\n            parent_workflow_id=parent_workflow_id,\n            metadata=metadata or {},\n        )\n\n    def create_child_context(self, child_workflow_id: Optional[str] = None) -> \"WorkflowContext\":\n        \"\"\"\n        Create a child context for sub-workflow execution.\n\n        Inherits tenant_id, correlation_id, and metadata from parent.\n\n        Args:\n            child_workflow_id: Optional specific ID for child workflow\n\n        Returns:\n            New child WorkflowContext\n        \"\"\"\n        return WorkflowContext(\n            workflow_id=child_workflow_id or str(uuid.uuid4()),\n            constitutional_hash=self.constitutional_hash,\n            tenant_id=self.tenant_id,\n            correlation_id=self.correlation_id,\n            metadata=self.metadata.copy(),\n            parent_workflow_id=self.workflow_id,\n            trace_id=self.trace_id,\n        )\n\n    def merge_child_results(self, child_context: \"WorkflowContext\", prefix: str = \"\") -> None:\n        \"\"\"\n        Merge results from a child workflow context.\n\n        Args:\n            child_context: Child workflow context\n            prefix: Optional prefix for step result keys\n        \"\"\"\n        for step_name, result in child_context.step_results.items():\n            key = f\"{prefix}{step_name}\" if prefix else step_name\n            self.step_results[key] = result\n\n        self.errors.extend(child_context.errors)\n\n\n__all__ = [\"WorkflowContext\"]\n",
        "timestamp": "2026-01-04T05:35:58.374613"
      },
      "worktree_state": null,
      "task_intent": {
        "title": "056-reduce-excessive-any-type-usage-in-python-codebase",
        "description": "Found 373 occurrences of ': Any' type annotations across 120+ Python files, with high concentrations in integration-service (16 occurrences), acgs2-core/breakthrough (79 occurrences), and acgs2-core/enhanced_agent_bus (50+ occurrences). Excessive use of 'Any' defeats the purpose of type hints and can mask type-related bugs.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-03T19:36:18.191410",
  "last_updated": "2026-01-04T05:35:59.117742"
}