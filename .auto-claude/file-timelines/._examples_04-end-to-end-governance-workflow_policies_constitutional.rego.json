{
  "file_path": "./examples/04-end-to-end-governance-workflow/policies/constitutional.rego",
  "main_branch_history": [],
  "task_views": {
    "061-create-end-to-end-governance-workflow-examples-wit": {
      "task_id": "061-create-end-to-end-governance-workflow-examples-wit",
      "branch_point": {
        "commit_hash": "fc6e42927298263034acf989773f3200e422ad17",
        "content": "# Constitutional Hash: cdd01ef066bc6cf2\n# ACGS-2 Example 04: End-to-End Governance Workflow\n# Constitutional Policy - Validates actions against constitutional principles\n\npackage acgs2.constitutional\n\nimport rego.v1\n\n# =============================================================================\n# CONSTITUTIONAL HASH VALIDATION\n# =============================================================================\n\n# The expected constitutional hash that must match input\nexpected_hash := \"cdd01ef066bc6cf2\"\n\n# =============================================================================\n# MAIN DECISION RULES\n# =============================================================================\n\n# Default deny - constitutional validation must be explicit\ndefault valid := false\n\n# Valid if hash matches AND no principles are violated\nvalid if {\n\thash_valid\n\tcount(principles_violated) == 0\n}\n\n# =============================================================================\n# HASH VALIDATION\n# =============================================================================\n\n# Hash is valid if it matches the expected constitutional hash\nhash_valid if {\n\tinput.context.constitutional_hash == expected_hash\n}\n\n# =============================================================================\n# CONSTITUTIONAL PRINCIPLES\n# =============================================================================\n\n# Principle 1: Transparency\n# Actions must be auditable and explainable\n# Required: action type and requester identification\ntransparency_principle if {\n\tinput.action.type\n\tinput.requester.id\n\tinput.requester.role\n}\n\n# Principle 2: Accountability\n# Actions must have an identified responsible party with clear role\naccountability_principle if {\n\tinput.requester.id\n\tinput.requester.type\n\t# Requester must be an identified entity (not anonymous)\n\tinput.requester.id != \"\"\n\tinput.requester.id != \"anonymous\"\n}\n\n# Principle 3: Privacy Protection\n# PII access must be limited to necessary and lawful purposes\nprivacy_principle if {\n\tnot violates_privacy\n}\n\n# Privacy violation: accessing PII for training without consent\nviolates_privacy if {\n\tinput.action.type == \"access_pii\"\n\tinput.action.parameters.purpose == \"training\"\n}\n\n# Privacy violation: accessing PII without stating purpose\nviolates_privacy if {\n\tinput.action.type == \"access_pii\"\n\tnot input.action.parameters.purpose\n}\n\n# Privacy violation: accessing PII for unauthorized purposes\nviolates_privacy if {\n\tinput.action.type == \"access_pii\"\n\tinput.action.parameters.purpose\n\tnot valid_pii_purpose(input.action.parameters.purpose)\n}\n\n# Valid PII purposes (lawful and necessary)\nvalid_pii_purpose(purpose) if {\n\tpurpose in [\"analytics\", \"compliance\", \"user_request\", \"legal_requirement\", \"security_investigation\"]\n}\n\n# Principle 4: Data Minimization\n# Only access data needed for the stated purpose\ndata_minimization_principle if {\n\tnot violates_data_minimization\n}\n\n# Data minimization violation: accessing all data when scope could be limited\nviolates_data_minimization if {\n\tinput.action.type in [\"read_data\", \"access_pii\"]\n\tinput.action.parameters.scope == \"all\"\n\tnot input.action.parameters.justification\n}\n\n# Data minimization violation: no time bounds on historical data access\nviolates_data_minimization if {\n\tinput.action.type in [\"read_data\", \"access_pii\"]\n\tinput.action.parameters.include_historical == true\n\tnot input.action.parameters.time_range\n}\n\n# Principle 5: Human Oversight\n# High-risk actions must be subject to human review\n# Note: This principle checks if oversight CAPABILITY exists, not if approval happened\n# Actual HITL approval is handled by the hitl_approval.rego policy\nhuman_oversight_principle if {\n\tnot violates_human_oversight\n}\n\n# Human oversight violation: attempting to bypass oversight for sensitive actions\nviolates_human_oversight if {\n\tinput.action.type in [\"delete_resource\", \"deploy_model\", \"execute_code\"]\n\tinput.context.environment == \"production\"\n\tinput.action.parameters.bypass_review == true\n}\n\n# Principle 6: Fairness\n# Actions must not discriminate or introduce bias\nfairness_principle if {\n\tnot violates_fairness\n}\n\n# Fairness violation: deploying models without bias testing\nviolates_fairness if {\n\tinput.action.type == \"deploy_model\"\n\tinput.action.parameters.bias_tested == false\n}\n\n# Fairness violation: accessing data in ways that could enable discrimination\nviolates_fairness if {\n\tinput.action.type == \"access_pii\"\n\tinput.action.parameters.purpose == \"targeting\"\n\tnot input.action.parameters.fairness_reviewed\n}\n\n# =============================================================================\n# PRINCIPLE TRACKING\n# =============================================================================\n\n# Collect all principles that passed\nprinciples_passed contains \"Transparency\" if {\n\ttransparency_principle\n}\n\nprinciples_passed contains \"Accountability\" if {\n\taccountability_principle\n}\n\nprinciples_passed contains \"Privacy Protection\" if {\n\tprivacy_principle\n}\n\nprinciples_passed contains \"Data Minimization\" if {\n\tdata_minimization_principle\n}\n\nprinciples_passed contains \"Human Oversight\" if {\n\thuman_oversight_principle\n}\n\nprinciples_passed contains \"Fairness\" if {\n\tfairness_principle\n}\n\n# Collect all principles that were violated\nprinciples_violated contains \"Transparency\" if {\n\tnot transparency_principle\n}\n\nprinciples_violated contains \"Accountability\" if {\n\tnot accountability_principle\n}\n\nprinciples_violated contains \"Privacy Protection\" if {\n\tviolates_privacy\n}\n\nprinciples_violated contains \"Data Minimization\" if {\n\tviolates_data_minimization\n}\n\nprinciples_violated contains \"Human Oversight\" if {\n\tviolates_human_oversight\n}\n\nprinciples_violated contains \"Fairness\" if {\n\tviolates_fairness\n}\n\n# =============================================================================\n# DENIAL REASONS\n# =============================================================================\n\n# Hash mismatch\ndenial_reasons contains msg if {\n\tnot hash_valid\n\tinput.context.constitutional_hash\n\tmsg := sprintf(\"Constitutional hash mismatch: expected %s, got %s\", [expected_hash, input.context.constitutional_hash])\n}\n\ndenial_reasons contains msg if {\n\tnot hash_valid\n\tnot input.context.constitutional_hash\n\tmsg := sprintf(\"Missing constitutional hash in context (expected: %s)\", [expected_hash])\n}\n\n# Transparency violations\ndenial_reasons contains msg if {\n\tnot transparency_principle\n\tnot input.action.type\n\tmsg := \"Transparency violation: missing action type\"\n}\n\ndenial_reasons contains msg if {\n\tnot transparency_principle\n\tnot input.requester.id\n\tmsg := \"Transparency violation: missing requester ID\"\n}\n\ndenial_reasons contains msg if {\n\tnot transparency_principle\n\tnot input.requester.role\n\tmsg := \"Transparency violation: missing requester role\"\n}\n\n# Accountability violations\ndenial_reasons contains msg if {\n\tnot accountability_principle\n\tinput.requester.id in [\"\", \"anonymous\"]\n\tmsg := \"Accountability violation: anonymous requesters not permitted\"\n}\n\ndenial_reasons contains msg if {\n\tnot accountability_principle\n\tnot input.requester.type\n\tmsg := \"Accountability violation: missing requester type\"\n}\n\n# Privacy violations\ndenial_reasons contains msg if {\n\tviolates_privacy\n\tinput.action.type == \"access_pii\"\n\tinput.action.parameters.purpose == \"training\"\n\tmsg := \"Privacy violation: PII cannot be used for model training without explicit consent\"\n}\n\ndenial_reasons contains msg if {\n\tviolates_privacy\n\tinput.action.type == \"access_pii\"\n\tnot input.action.parameters.purpose\n\tmsg := \"Privacy violation: PII access requires a stated purpose\"\n}\n\ndenial_reasons contains msg if {\n\tviolates_privacy\n\tinput.action.type == \"access_pii\"\n\tinput.action.parameters.purpose\n\tnot valid_pii_purpose(input.action.parameters.purpose)\n\tmsg := sprintf(\"Privacy violation: '%s' is not a valid PII access purpose (allowed: analytics, compliance, user_request, legal_requirement, security_investigation)\", [input.action.parameters.purpose])\n}\n\n# Data minimization violations\ndenial_reasons contains msg if {\n\tviolates_data_minimization\n\tinput.action.parameters.scope == \"all\"\n\tnot input.action.parameters.justification\n\tmsg := \"Data minimization violation: accessing all data requires justification\"\n}\n\ndenial_reasons contains msg if {\n\tviolates_data_minimization\n\tinput.action.parameters.include_historical == true\n\tnot input.action.parameters.time_range\n\tmsg := \"Data minimization violation: historical data access requires time range specification\"\n}\n\n# Human oversight violations\ndenial_reasons contains msg if {\n\tviolates_human_oversight\n\tinput.action.parameters.bypass_review == true\n\tmsg := sprintf(\"Human oversight violation: cannot bypass review for %s in production\", [input.action.type])\n}\n\n# Fairness violations\ndenial_reasons contains msg if {\n\tviolates_fairness\n\tinput.action.type == \"deploy_model\"\n\tinput.action.parameters.bias_tested == false\n\tmsg := \"Fairness violation: models must undergo bias testing before deployment\"\n}\n\ndenial_reasons contains msg if {\n\tviolates_fairness\n\tinput.action.type == \"access_pii\"\n\tinput.action.parameters.purpose == \"targeting\"\n\tnot input.action.parameters.fairness_reviewed\n\tmsg := \"Fairness violation: PII access for targeting requires fairness review\"\n}\n\n# =============================================================================\n# OUTPUT STRUCTURE\n# =============================================================================\n\n# Complete validation result with all details\nresult := {\n\t\"valid\": valid,\n\t\"hash_valid\": hash_valid,\n\t\"expected_hash\": expected_hash,\n\t\"principles_passed\": principles_passed,\n\t\"principles_violated\": principles_violated,\n\t\"denial_reasons\": denial_reasons,\n\t\"total_principles\": 6,\n\t\"passed_count\": count(principles_passed),\n\t\"violated_count\": count(principles_violated),\n}\n",
        "timestamp": "2026-01-04T05:35:49.744738"
      },
      "worktree_state": null,
      "task_intent": {
        "title": "061-create-end-to-end-governance-workflow-examples-wit",
        "description": "Create comprehensive examples demonstrating complete governance workflows from policy creation through enforcement to audit logging, targeting Enterprise DevOps/MLOps engineers deploying AI systems. The examples will show: defining constitutional policies, enforcing them on agent actions, handling HITL approvals, and auditing decisions.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-03T19:36:07.480747",
  "last_updated": "2026-01-04T05:35:49.793414"
}