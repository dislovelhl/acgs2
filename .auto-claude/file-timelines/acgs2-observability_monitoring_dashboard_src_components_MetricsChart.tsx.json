{
  "file_path": "acgs2-observability/monitoring/dashboard/src/components/MetricsChart.tsx",
  "main_branch_history": [],
  "task_views": {
    "052-replace-recharts-with-lightweight-chart-library": {
      "task_id": "052-replace-recharts-with-lightweight-chart-library",
      "branch_point": {
        "commit_hash": "fc6e42927298263034acf989773f3200e422ad17",
        "content": "/**\n * ACGS-2 Metrics Chart Component\n * Constitutional Hash: cdd01ef066bc6cf2\n *\n * Displays performance and system metrics as charts.\n * Optimized with React.memo and useMemo for expensive chart data processing.\n * Uses visx charting library (~40KB vs ~150KB recharts).\n */\n\nimport { memo, useMemo } from \"react\";\nimport type { MetricsResponse, SystemMetrics } from \"../types/api\";\nimport { ResponsiveChart, LineChart } from \"./charts\";\nimport type { LineSeries } from \"./charts/types\";\n\ninterface MetricsChartProps {\n  metrics: MetricsResponse | null;\n  loading: boolean;\n}\n\n// Memoized time formatter\nconst formatTime = (timestamp: string): string => {\n  const date = new Date(timestamp);\n  return date.toLocaleTimeString(\"en-US\", {\n    hour: \"2-digit\",\n    minute: \"2-digit\",\n  });\n};\n\n// Loading skeleton component\nconst ChartSkeleton = memo(function ChartSkeleton() {\n  return (\n    <div className=\"bg-white rounded-lg border border-gray-200 p-6 shadow-sm\">\n      <div className=\"h-8 bg-gray-200 rounded w-1/4 mb-4 animate-pulse\" />\n      <div className=\"h-64 bg-gray-200 rounded animate-pulse\" />\n    </div>\n  );\n});\n\n// Metric summary card - extracted for memoization\ninterface MetricSummaryProps {\n  value: number;\n  label: string;\n  colorClass: string;\n  textColorClass: string;\n}\n\nconst MetricSummary = memo(function MetricSummary({\n  value,\n  label,\n  colorClass,\n  textColorClass,\n}: MetricSummaryProps) {\n  return (\n    <div className={`text-center p-3 ${colorClass} rounded-lg`}>\n      <div className={`text-2xl font-bold ${textColorClass}`}>\n        {value.toFixed(1)}%\n      </div>\n      <div className={`text-sm ${textColorClass.replace(\"600\", \"700\")}`}>{label}</div>\n    </div>\n  );\n});\n\nfunction MetricsChartComponent({ metrics, loading }: MetricsChartProps): JSX.Element {\n  // Memoize chart data transformation - expensive operation\n  const chartData = useMemo(() => {\n    if (!metrics) return [];\n\n    const data = metrics.history.map((m: SystemMetrics) => ({\n      timestamp: new Date(m.timestamp),\n      time: formatTime(m.timestamp),\n      cpu: m.cpu_percent,\n      memory: m.memory_percent,\n      disk: m.disk_percent,\n    }));\n\n    // Add current metrics at the end\n    data.push({\n      timestamp: new Date(metrics.system.timestamp),\n      time: formatTime(metrics.system.timestamp),\n      cpu: metrics.system.cpu_percent,\n      memory: metrics.system.memory_percent,\n      disk: metrics.system.disk_percent,\n    });\n\n    return data;\n  }, [metrics]);\n\n  // Define line series configuration\n  const lineSeries = useMemo<LineSeries[]>(() => [\n    {\n      dataKey: 'cpu',\n      label: 'CPU',\n      stroke: '#3b82f6',\n      strokeWidth: 2,\n      type: 'monotone',\n    },\n    {\n      dataKey: 'memory',\n      label: 'Memory',\n      stroke: '#a855f7',\n      strokeWidth: 2,\n      type: 'monotone',\n    },\n    {\n      dataKey: 'disk',\n      label: 'Disk',\n      stroke: '#f97316',\n      strokeWidth: 2,\n      type: 'monotone',\n    },\n  ], []);\n\n  // Memoize formatted performance values\n  const performanceValues = useMemo(() => {\n    if (!metrics) return null;\n    return {\n      p99Latency: metrics.performance.p99_latency_ms.toFixed(3),\n      throughput: metrics.performance.throughput_rps.toLocaleString(),\n      cacheHitRate: (metrics.performance.cache_hit_rate * 100).toFixed(1),\n      compliance: metrics.performance.constitutional_compliance?.toFixed(1),\n    };\n  }, [metrics]);\n\n  if (loading || !metrics) {\n    return <ChartSkeleton />;\n  }\n\n  return (\n    <div className=\"bg-white rounded-lg border border-gray-200 p-6 shadow-sm\">\n      <h2 className=\"text-xl font-semibold text-gray-900 mb-4\">System Metrics</h2>\n\n      {/* Current Metrics Summary */}\n      <div className=\"grid grid-cols-3 gap-4 mb-6\">\n        <MetricSummary\n          value={metrics.system.cpu_percent}\n          label=\"CPU Usage\"\n          colorClass=\"bg-blue-50\"\n          textColorClass=\"text-blue-600\"\n        />\n        <MetricSummary\n          value={metrics.system.memory_percent}\n          label=\"Memory Usage\"\n          colorClass=\"bg-purple-50\"\n          textColorClass=\"text-purple-600\"\n        />\n        <MetricSummary\n          value={metrics.system.disk_percent}\n          label=\"Disk Usage\"\n          colorClass=\"bg-orange-50\"\n          textColorClass=\"text-orange-600\"\n        />\n      </div>\n\n      {/* Metrics Chart */}\n      <div className=\"h-64\">\n        {chartData.length > 1 ? (\n          <ResponsiveChart>\n            {({ width, height }) => (\n              <LineChart\n                data={chartData}\n                width={width}\n                height={height}\n                xKey=\"timestamp\"\n                series={lineSeries}\n                xScaleType=\"time\"\n                showGrid={true}\n                gridColor=\"#e5e7eb\"\n                showLegend={true}\n                xAxis={{\n                  tickColor: '#6b7280',\n                  tickFontSize: 12,\n                  stroke: '#6b7280',\n                  tickFormatter: (value) => {\n                    if (value instanceof Date) {\n                      return formatTime(value.toISOString());\n                    }\n                    return String(value);\n                  },\n                }}\n                yAxis={{\n                  domain: [0, 100],\n                  tickColor: '#6b7280',\n                  tickFontSize: 12,\n                  stroke: '#6b7280',\n                  tickFormatter: (value) => `${value}%`,\n                }}\n                tooltip={(data) => (\n                  <div>\n                    <div className=\"text-xs font-semibold mb-1 text-gray-700\">\n                      {data.time}\n                    </div>\n                    <div className=\"space-y-1 text-xs\">\n                      <div className=\"flex items-center justify-between gap-4\">\n                        <span className=\"text-gray-600\">CPU:</span>\n                        <span className=\"font-semibold\" style={{ color: '#3b82f6' }}>\n                          {typeof data.cpu === 'number' ? data.cpu.toFixed(1) : data.cpu}%\n                        </span>\n                      </div>\n                      <div className=\"flex items-center justify-between gap-4\">\n                        <span className=\"text-gray-600\">Memory:</span>\n                        <span className=\"font-semibold\" style={{ color: '#a855f7' }}>\n                          {typeof data.memory === 'number' ? data.memory.toFixed(1) : data.memory}%\n                        </span>\n                      </div>\n                      <div className=\"flex items-center justify-between gap-4\">\n                        <span className=\"text-gray-600\">Disk:</span>\n                        <span className=\"font-semibold\" style={{ color: '#f97316' }}>\n                          {typeof data.disk === 'number' ? data.disk.toFixed(1) : data.disk}%\n                        </span>\n                      </div>\n                    </div>\n                  </div>\n                )}\n              />\n            )}\n          </ResponsiveChart>\n        ) : (\n          <div className=\"flex items-center justify-center h-full text-gray-500\">\n            Collecting metrics data...\n          </div>\n        )}\n      </div>\n\n      {/* Performance Metrics */}\n      {performanceValues && (\n        <div className=\"mt-6 pt-6 border-t border-gray-200\">\n          <h3 className=\"text-sm font-medium text-gray-700 mb-3\">Performance Metrics</h3>\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n            <div className=\"text-center p-3 bg-gray-50 rounded-lg\">\n              <div className=\"text-lg font-bold text-gray-900\">\n                {performanceValues.p99Latency}ms\n              </div>\n              <div className=\"text-xs text-gray-500\">P99 Latency</div>\n            </div>\n            <div className=\"text-center p-3 bg-gray-50 rounded-lg\">\n              <div className=\"text-lg font-bold text-gray-900\">\n                {performanceValues.throughput} RPS\n              </div>\n              <div className=\"text-xs text-gray-500\">Throughput</div>\n            </div>\n            <div className=\"text-center p-3 bg-gray-50 rounded-lg\">\n              <div className=\"text-lg font-bold text-gray-900\">\n                {performanceValues.cacheHitRate}%\n              </div>\n              <div className=\"text-xs text-gray-500\">Cache Hit Rate</div>\n            </div>\n            {performanceValues.compliance && (\n              <div className=\"text-center p-3 bg-green-50 rounded-lg\">\n                <div className=\"text-lg font-bold text-green-600\">\n                  {performanceValues.compliance}%\n                </div>\n                <div className=\"text-xs text-green-700\">Constitutional Compliance</div>\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\n// Memoize the entire component\nexport const MetricsChart = memo(MetricsChartComponent);\n",
        "timestamp": "2026-01-04T05:36:13.611399"
      },
      "worktree_state": null,
      "task_intent": {
        "title": "052-replace-recharts-with-lightweight-chart-library",
        "description": "Replace recharts (~500KB unparsed, ~150KB gzipped) with a lightweight charting library like visx (~40KB) or uPlot (~30KB) to reduce bundle size and improve dashboard performance. Used in PredictionWidget (analytics-dashboard) and MetricsChart (observability dashboard).",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-03T19:36:23.209404",
  "last_updated": "2026-01-04T05:36:13.688053"
}