{
  "file_path": "./examples/04-end-to-end-governance-workflow/compose.yaml",
  "main_branch_history": [],
  "task_views": {
    "061-create-end-to-end-governance-workflow-examples-wit": {
      "task_id": "061-create-end-to-end-governance-workflow-examples-wit",
      "branch_point": {
        "commit_hash": "fc6e42927298263034acf989773f3200e422ad17",
        "content": "# ACGS-2 Example 04: End-to-End Governance Workflow\n# Complete governance workflow with OPA, PostgreSQL audit logging, and optional Redis\n# Constitutional Hash: cdd01ef066bc6cf2\n#\n# Usage: docker compose up -d\n#\n# This example demonstrates a complete end-to-end AI governance workflow including\n# constitutional policy validation, agent action evaluation, HITL approvals, and\n# persistent audit logging. For the full ACGS-2 stack, use the root compose.yaml.\n#\n# Services:\n# - OPA: Policy evaluation engine\n# - PostgreSQL: Persistent audit log storage\n# - Redis: Optional state caching (use --profile enhanced)\n\nservices:\n  # Open Policy Agent for policy decisions\n  opa:\n    image: openpolicyagent/opa:latest-rootless\n    container_name: acgs2-example04-opa\n    command:\n      - \"run\"\n      - \"--server\"\n      - \"--log-level=info\"\n      - \"--addr=0.0.0.0:8181\"\n      - \"/policies\"\n    ports:\n      - \"${OPA_PORT:-8181}:8181\"\n    volumes:\n      - ./policies:/policies:ro\n    healthcheck:\n      test: [\"CMD\", \"wget\", \"-q\", \"--spider\", \"http://localhost:8181/health\"]\n      interval: 10s\n      timeout: 5s\n      retries: 3\n      start_period: 5s\n    networks:\n      - governance-network\n    restart: unless-stopped\n\n  # PostgreSQL database for audit trail storage\n  postgres:\n    image: postgres:16-alpine\n    container_name: acgs2-example04-postgres\n    environment:\n      POSTGRES_DB: ${DB_NAME:-governance_audit}\n      POSTGRES_USER: ${DB_USER:-postgres}\n      POSTGRES_PASSWORD: ${DB_PASSWORD:?Database password required}\n      POSTGRES_INITDB_ARGS: \"--encoding=UTF8 --locale=C\"\n    ports:\n      - \"${DB_PORT:-5432}:5432\"\n    volumes:\n      - postgres-data:/var/lib/postgresql/data\n      - ./scripts/init_db.sql:/docker-entrypoint-initdb.d/01-init.sql:ro\n      - ./scripts/seed_data.sql:/docker-entrypoint-initdb.d/02-seed.sql:ro\n    healthcheck:\n      test: [\"CMD-SHELL\", \"pg_isready -U ${DB_USER:-postgres}\"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n      start_period: 10s\n    networks:\n      - governance-network\n    restart: unless-stopped\n\n  # Redis for optional state caching and session management\n  redis:\n    image: redis:7-alpine\n    container_name: acgs2-example04-redis\n    ports:\n      - \"${REDIS_PORT:-6379}:6379\"\n    healthcheck:\n      test: [\"CMD\", \"redis-cli\", \"ping\"]\n      interval: 10s\n      timeout: 3s\n      retries: 3\n    networks:\n      - governance-network\n    restart: unless-stopped\n    profiles:\n      - enhanced  # Optional service - enable with: docker compose --profile enhanced up -d\n\nvolumes:\n  postgres-data:\n    name: acgs2-example04-postgres-data\n\nnetworks:\n  governance-network:\n    name: acgs2-example04-network\n    driver: bridge\n\n# =============================================================================\n# Quick Reference\n# =============================================================================\n#\n# Start services (OPA + PostgreSQL only):\n#   docker compose up -d\n#\n# Start all services including Redis:\n#   docker compose --profile enhanced up -d\n#\n# Check service health:\n#   curl http://localhost:8181/health  # OPA\n#   docker compose ps                   # All services\n#\n# View logs:\n#   docker compose logs -f opa          # OPA logs\n#   docker compose logs -f postgres     # Database logs\n#   docker compose logs -f              # All logs\n#\n# Query OPA directly:\n#   curl -X POST http://localhost:8181/v1/data/acgs2/constitutional/validate \\\n#     -H \"Content-Type: application/json\" \\\n#     -d '{\"input\": {\"context\": {\"constitutional_hash\": \"cdd01ef066bc6cf2\"}}}'\n#\n# Connect to database:\n#   docker compose exec postgres psql -U postgres -d governance_audit\n#\n# Query audit logs:\n#   docker compose exec postgres psql -U postgres -d governance_audit \\\n#     -c \"SELECT * FROM audit_log ORDER BY timestamp DESC LIMIT 10;\"\n#\n# Stop services:\n#   docker compose down\n#\n# Stop and remove data:\n#   docker compose down -v\n#\n# Environment Variables:\n#   OPA_PORT=8181           # OPA service port\n#   DB_PORT=5432            # PostgreSQL port\n#   DB_NAME=governance_audit # Database name\n#   DB_USER=postgres        # Database user\n#   DB_PASSWORD=<required>  # Database password (must be set)\n#   REDIS_PORT=6379         # Redis port (if using enhanced profile)\n#\n# Port conflicts?\n#   OPA_PORT=8182 DB_PORT=5433 docker compose up -d\n#\n# Troubleshooting:\n#   - If OPA fails to start, check that port 8181 is available\n#   - If PostgreSQL fails, ensure DB_PASSWORD is set in .env file\n#   - For database connection issues, check health: docker compose ps\n#   - View detailed logs: docker compose logs <service-name>\n# =============================================================================\n",
        "timestamp": "2026-01-04T05:35:49.744738"
      },
      "worktree_state": null,
      "task_intent": {
        "title": "061-create-end-to-end-governance-workflow-examples-wit",
        "description": "Create comprehensive examples demonstrating complete governance workflows from policy creation through enforcement to audit logging, targeting Enterprise DevOps/MLOps engineers deploying AI systems. The examples will show: defining constitutional policies, enforcing them on agent actions, handling HITL approvals, and auditing decisions.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-03T19:36:07.445675",
  "last_updated": "2026-01-04T05:35:49.855928"
}