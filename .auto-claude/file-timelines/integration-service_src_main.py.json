{
  "file_path": "integration-service/src/main.py",
  "main_branch_history": [],
  "task_views": {
    "003-import-your-data": {
      "task_id": "003-import-your-data",
      "branch_point": {
        "commit_hash": "cc53a509f89115bbb36940c140031e6159320791",
        "content": "\"\"\"\nACGS-2 Integration Service\nThird-party integration ecosystem for enterprise tool connectivity\n\"\"\"\n\nimport logging\nimport os\nfrom contextlib import asynccontextmanager\n\nfrom fastapi import FastAPI\nfrom fastapi.middleware.cors import CORSMiddleware\n\nfrom .api.health import configure_health_router\nfrom .api.health import router as health_router\nfrom .api.policy_check import router as policy_check_router\nfrom .api.webhooks import router as webhooks_router\n\n# Configure logging\nlogging.basicConfig(level=logging.INFO)\nlogger = logging.getLogger(__name__)\n\n# Environment configuration\nENVIRONMENT = os.getenv(\"APP_ENV\", \"development\")\nSERVICE_NAME = \"integration-service\"\nSERVICE_VERSION = \"1.0.0\"\nSERVICE_PORT = int(os.getenv(\"INTEGRATION_SERVICE_PORT\", \"8100\"))\n\n# Service URLs from environment\nAGENT_BUS_URL = os.getenv(\"AGENT_BUS_URL\", \"http://localhost:8000\")\nOPA_URL = os.getenv(\"OPA_URL\", \"http://localhost:8181\")\nREDIS_URL = os.getenv(\"REDIS_URL\", \"redis://localhost:6379/0\")\nKAFKA_BOOTSTRAP = os.getenv(\"KAFKA_BOOTSTRAP_SERVERS\", \"localhost:9092\")\n\n# CORS configuration\nCORS_ORIGINS = os.getenv(\"CORS_ORIGINS\", \"*\").split(\",\")\n\n\n@asynccontextmanager\nasync def lifespan(app: FastAPI):\n    \"\"\"Application lifespan manager\"\"\"\n    # Startup\n    logger.info(f\"Starting {SERVICE_NAME} v{SERVICE_VERSION}\")\n    logger.info(f\"Environment: {ENVIRONMENT}\")\n    logger.info(f\"Agent Bus URL: {AGENT_BUS_URL}\")\n    logger.info(f\"OPA URL: {OPA_URL}\")\n    logger.info(f\"Listening on port {SERVICE_PORT}\")\n\n    # Configure health router with service settings\n    configure_health_router(\n        service_name=SERVICE_NAME,\n        service_version=SERVICE_VERSION,\n        environment=ENVIRONMENT,\n        service_port=SERVICE_PORT,\n        agent_bus_url=AGENT_BUS_URL,\n        opa_url=OPA_URL,\n    )\n\n    yield\n\n    # Shutdown\n    logger.info(f\"Shutting down {SERVICE_NAME}\")\n\n\napp = FastAPI(\n    title=\"ACGS-2 Integration Service\",\n    description=\"Third-party integration ecosystem for connecting ACGS-2 with enterprise tools\",\n    version=SERVICE_VERSION,\n    docs_url=\"/docs\",\n    redoc_url=\"/redoc\",\n    lifespan=lifespan,\n)\n\n# Add CORS middleware\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=CORS_ORIGINS,\n    allow_credentials=True,\n    allow_methods=[\"*\"],\n    allow_headers=[\"*\"],\n)\n\n# Include routers\napp.include_router(health_router)\napp.include_router(policy_check_router)\napp.include_router(webhooks_router)\n\n\n# Root endpoint\n@app.get(\"/\")\nasync def root():\n    \"\"\"Root endpoint with service information\"\"\"\n    return {\n        \"service\": SERVICE_NAME,\n        \"version\": SERVICE_VERSION,\n        \"description\": \"ACGS-2 Third-Party Integration Service\",\n        \"documentation\": \"/docs\",\n        \"health\": \"/health\",\n        \"environment\": ENVIRONMENT,\n    }\n\n\nif __name__ == \"__main__\":\n    import uvicorn\n\n    uvicorn.run(\n        \"main:app\",\n        host=\"0.0.0.0\",\n        port=SERVICE_PORT,\n        reload=True,\n        log_level=\"info\",\n    )\n",
        "timestamp": "2026-01-03T17:00:00.287145"
      },
      "worktree_state": {
        "content": "\"\"\"\nACGS-2 Integration Service\nThird-party integration ecosystem for enterprise tool connectivity\n\"\"\"\n\nimport logging\nimport os\nfrom contextlib import asynccontextmanager\n\nimport redis.asyncio as redis\nfrom fastapi import FastAPI\nfrom fastapi.middleware.cors import CORSMiddleware\n\nfrom .api.health import configure_health_router\nfrom .api.health import router as health_router\nfrom .api.import_router import router as import_router\nfrom .api.policy_check import router as policy_check_router\nfrom .api.webhooks import router as webhooks_router\n\n# Configure logging\nlogging.basicConfig(level=logging.INFO)\nlogger = logging.getLogger(__name__)\n\n# Environment configuration\nENVIRONMENT = os.getenv(\"APP_ENV\", \"development\")\nSERVICE_NAME = \"integration-service\"\nSERVICE_VERSION = \"1.0.0\"\nSERVICE_PORT = int(os.getenv(\"INTEGRATION_SERVICE_PORT\", \"8100\"))\n\n# Service URLs from environment\nAGENT_BUS_URL = os.getenv(\"AGENT_BUS_URL\", \"http://localhost:8000\")\nOPA_URL = os.getenv(\"OPA_URL\", \"http://localhost:8181\")\nREDIS_URL = os.getenv(\"REDIS_URL\", \"redis://localhost:6379/0\")\nKAFKA_BOOTSTRAP = os.getenv(\"KAFKA_BOOTSTRAP_SERVERS\", \"localhost:9092\")\n\n# CORS configuration\nCORS_ORIGINS = os.getenv(\"CORS_ORIGINS\", \"*\").split(\",\")\n\n# Redis client for job tracking\nredis_client = None\n\n\n@asynccontextmanager\nasync def lifespan(app: FastAPI):\n    \"\"\"Application lifespan manager\"\"\"\n    global redis_client\n\n    # Startup\n    logger.info(f\"Starting {SERVICE_NAME} v{SERVICE_VERSION}\")\n    logger.info(f\"Environment: {ENVIRONMENT}\")\n    logger.info(f\"Agent Bus URL: {AGENT_BUS_URL}\")\n    logger.info(f\"OPA URL: {OPA_URL}\")\n    logger.info(f\"Listening on port {SERVICE_PORT}\")\n\n    # Configure health router with service settings\n    configure_health_router(\n        service_name=SERVICE_NAME,\n        service_version=SERVICE_VERSION,\n        environment=ENVIRONMENT,\n        service_port=SERVICE_PORT,\n        agent_bus_url=AGENT_BUS_URL,\n        opa_url=OPA_URL,\n    )\n\n    # Initialize Redis for job tracking\n    try:\n        redis_client = redis.from_url(REDIS_URL, encoding=\"utf-8\", decode_responses=True)\n        await redis_client.ping()\n        logger.info(f\"Redis connected for job tracking: {REDIS_URL}\")\n    except Exception as e:\n        logger.warning(f\"Redis connection failed: {e}. Job tracking will use in-memory storage.\")\n        redis_client = None\n\n    yield\n\n    # Shutdown\n    if redis_client:\n        await redis_client.close()\n        logger.info(\"Redis connection closed\")\n    logger.info(f\"Shutting down {SERVICE_NAME}\")\n\n\napp = FastAPI(\n    title=\"ACGS-2 Integration Service\",\n    description=\"Third-party integration ecosystem for connecting ACGS-2 with enterprise tools\",\n    version=SERVICE_VERSION,\n    docs_url=\"/docs\",\n    redoc_url=\"/redoc\",\n    lifespan=lifespan,\n)\n\n# Add CORS middleware\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=CORS_ORIGINS,\n    allow_credentials=True,\n    allow_methods=[\"*\"],\n    allow_headers=[\"*\"],\n)\n\n# Include routers\napp.include_router(health_router)\napp.include_router(import_router)\napp.include_router(policy_check_router)\napp.include_router(webhooks_router)\n\n\n# Root endpoint\n@app.get(\"/\")\nasync def root():\n    \"\"\"Root endpoint with service information\"\"\"\n    return {\n        \"service\": SERVICE_NAME,\n        \"version\": SERVICE_VERSION,\n        \"description\": \"ACGS-2 Third-Party Integration Service\",\n        \"documentation\": \"/docs\",\n        \"health\": \"/health\",\n        \"environment\": ENVIRONMENT,\n    }\n\n\nif __name__ == \"__main__\":\n    import uvicorn\n\n    uvicorn.run(\n        \"main:app\",\n        host=\"0.0.0.0\",\n        port=SERVICE_PORT,\n        reload=True,\n        log_level=\"info\",\n    )\n",
        "last_modified": "2026-01-03T19:09:00.298256"
      },
      "task_intent": {
        "title": "003-import-your-data",
        "description": "",
        "from_plan": false
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    },
    "046-add-security-headers-middleware-to-fastapi-service": {
      "task_id": "046-add-security-headers-middleware-to-fastapi-service",
      "branch_point": {
        "commit_hash": "4a99fe22e8e0087919301b1aa185d4e2c6da716c",
        "content": "\"\"\"\nACGS-2 Integration Service\nThird-party integration ecosystem for enterprise tool connectivity\n\"\"\"\n\nimport logging\nimport os\nfrom contextlib import asynccontextmanager\n\nfrom fastapi import FastAPI\nfrom fastapi.middleware.cors import CORSMiddleware\n\nfrom .api.health import configure_health_router\nfrom .api.health import router as health_router\nfrom .api.policy_check import router as policy_check_router\nfrom .api.webhooks import router as webhooks_router\n\n# Configure logging\nlogging.basicConfig(level=logging.INFO)\nlogger = logging.getLogger(__name__)\n\n# Environment configuration\nENVIRONMENT = os.getenv(\"APP_ENV\", \"development\")\nSERVICE_NAME = \"integration-service\"\nSERVICE_VERSION = \"1.0.0\"\nSERVICE_PORT = int(os.getenv(\"INTEGRATION_SERVICE_PORT\", \"8100\"))\n\n# Service URLs from environment\nAGENT_BUS_URL = os.getenv(\"AGENT_BUS_URL\", \"http://localhost:8000\")\nOPA_URL = os.getenv(\"OPA_URL\", \"http://localhost:8181\")\nREDIS_URL = os.getenv(\"REDIS_URL\", \"redis://localhost:6379/0\")\nKAFKA_BOOTSTRAP = os.getenv(\"KAFKA_BOOTSTRAP_SERVERS\", \"localhost:9092\")\n\n# CORS configuration\nCORS_ORIGINS = os.getenv(\"CORS_ORIGINS\", \"*\").split(\",\")\n\n\n@asynccontextmanager\nasync def lifespan(app: FastAPI):\n    \"\"\"Application lifespan manager\"\"\"\n    # Startup\n    logger.info(f\"Starting {SERVICE_NAME} v{SERVICE_VERSION}\")\n    logger.info(f\"Environment: {ENVIRONMENT}\")\n    logger.info(f\"Agent Bus URL: {AGENT_BUS_URL}\")\n    logger.info(f\"OPA URL: {OPA_URL}\")\n    logger.info(f\"Listening on port {SERVICE_PORT}\")\n\n    # Configure health router with service settings\n    configure_health_router(\n        service_name=SERVICE_NAME,\n        service_version=SERVICE_VERSION,\n        environment=ENVIRONMENT,\n        service_port=SERVICE_PORT,\n        agent_bus_url=AGENT_BUS_URL,\n        opa_url=OPA_URL,\n    )\n\n    yield\n\n    # Shutdown\n    logger.info(f\"Shutting down {SERVICE_NAME}\")\n\n\napp = FastAPI(\n    title=\"ACGS-2 Integration Service\",\n    description=\"Third-party integration ecosystem for connecting ACGS-2 with enterprise tools\",\n    version=SERVICE_VERSION,\n    docs_url=\"/docs\",\n    redoc_url=\"/redoc\",\n    lifespan=lifespan,\n)\n\n# Add CORS middleware\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=CORS_ORIGINS,\n    allow_credentials=True,\n    allow_methods=[\"*\"],\n    allow_headers=[\"*\"],\n)\n\n# Include routers\napp.include_router(health_router)\napp.include_router(policy_check_router)\napp.include_router(webhooks_router)\n\n\n# Root endpoint\n@app.get(\"/\")\nasync def root():\n    \"\"\"Root endpoint with service information\"\"\"\n    return {\n        \"service\": SERVICE_NAME,\n        \"version\": SERVICE_VERSION,\n        \"description\": \"ACGS-2 Third-Party Integration Service\",\n        \"documentation\": \"/docs\",\n        \"health\": \"/health\",\n        \"environment\": ENVIRONMENT,\n    }\n\n\nif __name__ == \"__main__\":\n    import uvicorn\n\n    uvicorn.run(\n        \"main:app\",\n        host=\"0.0.0.0\",\n        port=SERVICE_PORT,\n        reload=True,\n        log_level=\"info\",\n    )\n",
        "timestamp": "2026-01-03T19:07:31.669524"
      },
      "worktree_state": {
        "content": "\"\"\"\nACGS-2 Integration Service\nThird-party integration ecosystem for enterprise tool connectivity\n\"\"\"\n\nimport logging\nimport os\nimport sys\nfrom contextlib import asynccontextmanager\nfrom pathlib import Path\n\nfrom fastapi import FastAPI\nfrom fastapi.middleware.cors import CORSMiddleware\n\n# Add src/core to path for shared modules\ncore_path = Path(__file__).parent.parent.parent / \"src/core\"\nif str(core_path) not in sys.path:\n    sys.path.insert(0, str(core_path))\n\nfrom shared.security import SecurityHeadersConfig, SecurityHeadersMiddleware\n\nfrom .api.health import configure_health_router\nfrom .api.health import router as health_router\nfrom .api.policy_check import router as policy_check_router\nfrom .api.webhooks import router as webhooks_router\n\n# Configure logging\nlogging.basicConfig(level=logging.INFO)\nlogger = logging.getLogger(__name__)\n\n# Environment configuration\nENVIRONMENT = os.getenv(\"APP_ENV\", \"development\")\nSERVICE_NAME = \"integration-service\"\nSERVICE_VERSION = \"1.0.0\"\nSERVICE_PORT = int(os.getenv(\"INTEGRATION_SERVICE_PORT\", \"8100\"))\n\n# Service URLs from environment\nAGENT_BUS_URL = os.getenv(\"AGENT_BUS_URL\", \"http://localhost:8000\")\nOPA_URL = os.getenv(\"OPA_URL\", \"http://localhost:8181\")\nREDIS_URL = os.getenv(\"REDIS_URL\", \"redis://localhost:6379/0\")\nKAFKA_BOOTSTRAP = os.getenv(\"KAFKA_BOOTSTRAP_SERVERS\", \"localhost:9092\")\n\n# CORS configuration\nCORS_ORIGINS = os.getenv(\"CORS_ORIGINS\", \"*\").split(\",\")\n\n\n@asynccontextmanager\nasync def lifespan(app: FastAPI):\n    \"\"\"Application lifespan manager\"\"\"\n    # Startup\n    logger.info(f\"Starting {SERVICE_NAME} v{SERVICE_VERSION}\")\n    logger.info(f\"Environment: {ENVIRONMENT}\")\n    logger.info(f\"Agent Bus URL: {AGENT_BUS_URL}\")\n    logger.info(f\"OPA URL: {OPA_URL}\")\n    logger.info(f\"Listening on port {SERVICE_PORT}\")\n\n    # Configure health router with service settings\n    configure_health_router(\n        service_name=SERVICE_NAME,\n        service_version=SERVICE_VERSION,\n        environment=ENVIRONMENT,\n        service_port=SERVICE_PORT,\n        agent_bus_url=AGENT_BUS_URL,\n        opa_url=OPA_URL,\n    )\n\n    yield\n\n    # Shutdown\n    logger.info(f\"Shutting down {SERVICE_NAME}\")\n\n\napp = FastAPI(\n    title=\"ACGS-2 Integration Service\",\n    description=\"Third-party integration ecosystem for connecting ACGS-2 with enterprise tools\",\n    version=SERVICE_VERSION,\n    docs_url=\"/docs\",\n    redoc_url=\"/redoc\",\n    lifespan=lifespan,\n)\n\n# Add CORS middleware\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=CORS_ORIGINS,\n    allow_credentials=True,\n    allow_methods=[\"*\"],\n    allow_headers=[\"*\"],\n)\n\n# Add security headers middleware\n# Configure for integration service (allows webhooks and external integrations)\nsecurity_config = SecurityHeadersConfig.for_integration_service()\napp.add_middleware(SecurityHeadersMiddleware, config=security_config)\nlogger.info(f\"Security headers middleware configured for integration service (environment: {ENVIRONMENT})\")\n\n# Include routers\napp.include_router(health_router)\napp.include_router(policy_check_router)\napp.include_router(webhooks_router)\n\n\n# Root endpoint\n@app.get(\"/\")\nasync def root():\n    \"\"\"Root endpoint with service information\"\"\"\n    return {\n        \"service\": SERVICE_NAME,\n        \"version\": SERVICE_VERSION,\n        \"description\": \"ACGS-2 Third-Party Integration Service\",\n        \"documentation\": \"/docs\",\n        \"health\": \"/health\",\n        \"environment\": ENVIRONMENT,\n    }\n\n\nif __name__ == \"__main__\":\n    import uvicorn\n\n    uvicorn.run(\n        \"main:app\",\n        host=\"0.0.0.0\",\n        port=SERVICE_PORT,\n        reload=True,\n        log_level=\"info\",\n    )\n",
        "last_modified": "2026-01-03T19:08:32.491275"
      },
      "task_intent": {
        "title": "046-add-security-headers-middleware-to-fastapi-service",
        "description": "Multiple FastAPI services (integration-service, compliance-docs, observability dashboard) lack security headers middleware. Missing headers include Content-Security-Policy, X-Content-Type-Options, X-Frame-Options, Strict-Transport-Security, X-XSS-Protection, and Referrer-Policy.",
        "from_plan": true
      },
      "commits_behind_main": 11,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-03T17:00:00.296057",
  "last_updated": "2026-01-03T19:07:31.798847"
}