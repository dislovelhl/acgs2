{
  "file_path": "analytics-dashboard/src/components/widgets/InsightWidget.tsx",
  "main_branch_history": [],
  "task_views": {
    "054-extract-duplicated-loadingstate-and-api-config-in-": {
      "task_id": "054-extract-duplicated-loadingstate-and-api-config-in-",
      "branch_point": {
        "commit_hash": "4a99fe22e8e0087919301b1aa185d4e2c6da716c",
        "content": "/**\n * InsightWidget Component\n *\n * Displays AI-generated governance insights including:\n * - Executive summary of governance trends\n * - Business impact analysis\n * - Recommended actions for compliance improvement\n */\n\nimport { useCallback, useEffect, useState } from \"react\";\nimport {\n  AlertCircle,\n  Brain,\n  CheckCircle,\n  Lightbulb,\n  RefreshCw,\n  TrendingUp,\n} from \"lucide-react\";\n\n/** Insight data structure from the API */\ninterface InsightData {\n  summary: string;\n  business_impact: string;\n  recommended_action: string;\n  confidence: number;\n  generated_at: string;\n  model_used: string | null;\n  cached: boolean;\n}\n\n/** Widget loading state */\ntype LoadingState = \"idle\" | \"loading\" | \"success\" | \"error\";\n\n/** API URL from environment */\nconst API_BASE_URL =\n  import.meta.env.VITE_ANALYTICS_API_URL || \"http://localhost:8080\";\n\n/**\n * Formats a confidence score as a percentage with color coding\n */\nfunction getConfidenceDisplay(confidence: number): {\n  text: string;\n  color: string;\n} {\n  const percentage = Math.round(confidence * 100);\n  if (confidence >= 0.8) {\n    return { text: `${percentage}%`, color: \"text-green-600\" };\n  } else if (confidence >= 0.6) {\n    return { text: `${percentage}%`, color: \"text-yellow-600\" };\n  }\n  return { text: `${percentage}%`, color: \"text-red-600\" };\n}\n\n/**\n * Formats the generation timestamp for display\n */\nfunction formatTimestamp(timestamp: string): string {\n  try {\n    const date = new Date(timestamp);\n    return date.toLocaleString(undefined, {\n      dateStyle: \"short\",\n      timeStyle: \"short\",\n    });\n  } catch {\n    return \"Unknown\";\n  }\n}\n\n/**\n * InsightWidget - Displays AI-generated governance insights\n *\n * Features:\n * - Fetches insights from the analytics API\n * - Shows loading, error, and success states\n * - Displays summary, business impact, and recommended actions\n * - Supports manual refresh\n * - Shows confidence score and generation metadata\n */\nexport function InsightWidget(): JSX.Element {\n  const [insight, setInsight] = useState<InsightData | null>(null);\n  const [loadingState, setLoadingState] = useState<LoadingState>(\"idle\");\n  const [error, setError] = useState<string | null>(null);\n\n  /**\n   * Fetches insight data from the API\n   */\n  const fetchInsight = useCallback(async (forceRefresh = false) => {\n    setLoadingState(\"loading\");\n    setError(null);\n\n    try {\n      const url = new URL(`${API_BASE_URL}/insights`);\n      if (forceRefresh) {\n        url.searchParams.set(\"refresh\", \"true\");\n      }\n\n      const response = await fetch(url.toString(), {\n        method: \"GET\",\n        headers: {\n          Accept: \"application/json\",\n        },\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(\n          errorData.detail || `Failed to fetch insights: ${response.status}`\n        );\n      }\n\n      const data: InsightData = await response.json();\n      setInsight(data);\n      setLoadingState(\"success\");\n    } catch (err) {\n      const message =\n        err instanceof Error ? err.message : \"Failed to load insights\";\n      setError(message);\n      setLoadingState(\"error\");\n    }\n  }, []);\n\n  // Fetch insights on mount\n  useEffect(() => {\n    fetchInsight();\n  }, [fetchInsight]);\n\n  /**\n   * Handle refresh button click\n   */\n  const handleRefresh = () => {\n    fetchInsight(true);\n  };\n\n  // Loading state\n  if (loadingState === \"loading\" && !insight) {\n    return (\n      <div className=\"h-full rounded-lg bg-white p-4 shadow\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <Brain className=\"h-5 w-5 text-indigo-600\" />\n            <h3 className=\"text-lg font-semibold text-gray-900\">AI Insights</h3>\n          </div>\n        </div>\n        <div className=\"mt-4 space-y-3\">\n          <div className=\"h-4 w-3/4 animate-pulse rounded bg-gray-200\" />\n          <div className=\"h-4 w-full animate-pulse rounded bg-gray-200\" />\n          <div className=\"h-4 w-5/6 animate-pulse rounded bg-gray-200\" />\n        </div>\n      </div>\n    );\n  }\n\n  // Error state\n  if (loadingState === \"error\") {\n    return (\n      <div className=\"h-full rounded-lg bg-white p-4 shadow\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <Brain className=\"h-5 w-5 text-indigo-600\" />\n            <h3 className=\"text-lg font-semibold text-gray-900\">AI Insights</h3>\n          </div>\n          <button\n            onClick={handleRefresh}\n            className=\"rounded p-1 text-gray-400 transition-colors hover:bg-gray-100 hover:text-gray-600\"\n            title=\"Retry\"\n            aria-label=\"Retry loading insights\"\n          >\n            <RefreshCw className=\"h-4 w-4\" />\n          </button>\n        </div>\n        <div className=\"mt-4 flex flex-col items-center justify-center py-8\">\n          <AlertCircle className=\"h-8 w-8 text-red-500\" />\n          <p className=\"mt-2 text-center text-sm text-red-600\">{error}</p>\n          <button\n            onClick={handleRefresh}\n            className=\"mt-4 rounded-md bg-red-50 px-4 py-2 text-sm font-medium text-red-700 transition-colors hover:bg-red-100\"\n          >\n            Try Again\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  // Success state with insight data\n  const confidenceDisplay = insight\n    ? getConfidenceDisplay(insight.confidence)\n    : { text: \"N/A\", color: \"text-gray-500\" };\n\n  return (\n    <div className=\"flex h-full flex-col rounded-lg bg-white p-4 shadow\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center gap-2\">\n          <Brain className=\"h-5 w-5 text-indigo-600\" />\n          <h3 className=\"text-lg font-semibold text-gray-900\">AI Insights</h3>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          {insight?.cached && (\n            <span className=\"rounded-full bg-gray-100 px-2 py-0.5 text-xs text-gray-500\">\n              Cached\n            </span>\n          )}\n          <button\n            onClick={handleRefresh}\n            disabled={loadingState === \"loading\"}\n            className=\"rounded p-1 text-gray-400 transition-colors hover:bg-gray-100 hover:text-gray-600 disabled:cursor-not-allowed disabled:opacity-50\"\n            title=\"Refresh insights\"\n            aria-label=\"Refresh insights\"\n          >\n            <RefreshCw\n              className={`h-4 w-4 ${loadingState === \"loading\" ? \"animate-spin\" : \"\"}`}\n            />\n          </button>\n        </div>\n      </div>\n\n      {/* Content */}\n      <div className=\"mt-4 flex-1 space-y-4 overflow-y-auto\">\n        {/* Summary Section */}\n        <div className=\"rounded-lg bg-indigo-50 p-3\">\n          <div className=\"mb-1 flex items-center gap-1.5\">\n            <Lightbulb className=\"h-4 w-4 text-indigo-600\" />\n            <span className=\"text-xs font-medium uppercase text-indigo-700\">\n              Summary\n            </span>\n          </div>\n          <p className=\"text-sm text-gray-700\">\n            {insight?.summary || \"No summary available\"}\n          </p>\n        </div>\n\n        {/* Business Impact Section */}\n        <div className=\"rounded-lg bg-amber-50 p-3\">\n          <div className=\"mb-1 flex items-center gap-1.5\">\n            <TrendingUp className=\"h-4 w-4 text-amber-600\" />\n            <span className=\"text-xs font-medium uppercase text-amber-700\">\n              Business Impact\n            </span>\n          </div>\n          <p className=\"text-sm text-gray-700\">\n            {insight?.business_impact || \"No business impact analysis available\"}\n          </p>\n        </div>\n\n        {/* Recommended Action Section */}\n        <div className=\"rounded-lg bg-green-50 p-3\">\n          <div className=\"mb-1 flex items-center gap-1.5\">\n            <CheckCircle className=\"h-4 w-4 text-green-600\" />\n            <span className=\"text-xs font-medium uppercase text-green-700\">\n              Recommended Action\n            </span>\n          </div>\n          <p className=\"text-sm text-gray-700\">\n            {insight?.recommended_action || \"No recommendation available\"}\n          </p>\n        </div>\n      </div>\n\n      {/* Footer with metadata */}\n      <div className=\"mt-4 flex items-center justify-between border-t border-gray-100 pt-3 text-xs text-gray-500\">\n        <div className=\"flex items-center gap-4\">\n          <span>\n            Confidence:{\" \"}\n            <span className={`font-medium ${confidenceDisplay.color}`}>\n              {confidenceDisplay.text}\n            </span>\n          </span>\n          {insight?.model_used && (\n            <span>\n              Model:{\" \"}\n              <span className=\"font-medium text-gray-700\">\n                {insight.model_used}\n              </span>\n            </span>\n          )}\n        </div>\n        {insight?.generated_at && (\n          <span title={insight.generated_at}>\n            {formatTimestamp(insight.generated_at)}\n          </span>\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport default InsightWidget;\n",
        "timestamp": "2026-01-03T18:35:24.567548"
      },
      "worktree_state": {
        "content": "/**\n * InsightWidget Component\n *\n * Displays AI-generated governance insights including:\n * - Executive summary of governance trends\n * - Business impact analysis\n * - Recommended actions for compliance improvement\n */\n\nimport { useCallback, useEffect, useState } from \"react\";\nimport {\n  AlertCircle,\n  Brain,\n  CheckCircle,\n  Lightbulb,\n  RefreshCw,\n  TrendingUp,\n} from \"lucide-react\";\nimport { LoadingState, API_BASE_URL } from \"../../lib\";\n\n/** Insight data structure from the API */\ninterface InsightData {\n  summary: string;\n  business_impact: string;\n  recommended_action: string;\n  confidence: number;\n  generated_at: string;\n  model_used: string | null;\n  cached: boolean;\n}\n\n/**\n * Formats a confidence score as a percentage with color coding\n */\nfunction getConfidenceDisplay(confidence: number): {\n  text: string;\n  color: string;\n} {\n  const percentage = Math.round(confidence * 100);\n  if (confidence >= 0.8) {\n    return { text: `${percentage}%`, color: \"text-green-600\" };\n  } else if (confidence >= 0.6) {\n    return { text: `${percentage}%`, color: \"text-yellow-600\" };\n  }\n  return { text: `${percentage}%`, color: \"text-red-600\" };\n}\n\n/**\n * Formats the generation timestamp for display\n */\nfunction formatTimestamp(timestamp: string): string {\n  try {\n    const date = new Date(timestamp);\n    return date.toLocaleString(undefined, {\n      dateStyle: \"short\",\n      timeStyle: \"short\",\n    });\n  } catch {\n    return \"Unknown\";\n  }\n}\n\n/**\n * InsightWidget - Displays AI-generated governance insights\n *\n * Features:\n * - Fetches insights from the analytics API\n * - Shows loading, error, and success states\n * - Displays summary, business impact, and recommended actions\n * - Supports manual refresh\n * - Shows confidence score and generation metadata\n */\nexport function InsightWidget(): JSX.Element {\n  const [insight, setInsight] = useState<InsightData | null>(null);\n  const [loadingState, setLoadingState] = useState<LoadingState>(\"idle\");\n  const [error, setError] = useState<string | null>(null);\n\n  /**\n   * Fetches insight data from the API\n   */\n  const fetchInsight = useCallback(async (forceRefresh = false) => {\n    setLoadingState(\"loading\");\n    setError(null);\n\n    try {\n      const url = new URL(`${API_BASE_URL}/insights`);\n      if (forceRefresh) {\n        url.searchParams.set(\"refresh\", \"true\");\n      }\n\n      const response = await fetch(url.toString(), {\n        method: \"GET\",\n        headers: {\n          Accept: \"application/json\",\n        },\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(\n          errorData.detail || `Failed to fetch insights: ${response.status}`\n        );\n      }\n\n      const data: InsightData = await response.json();\n      setInsight(data);\n      setLoadingState(\"success\");\n    } catch (err) {\n      const message =\n        err instanceof Error ? err.message : \"Failed to load insights\";\n      setError(message);\n      setLoadingState(\"error\");\n    }\n  }, []);\n\n  // Fetch insights on mount\n  useEffect(() => {\n    fetchInsight();\n  }, [fetchInsight]);\n\n  /**\n   * Handle refresh button click\n   */\n  const handleRefresh = () => {\n    fetchInsight(true);\n  };\n\n  // Loading state\n  if (loadingState === \"loading\" && !insight) {\n    return (\n      <div className=\"h-full rounded-lg bg-white p-4 shadow\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <Brain className=\"h-5 w-5 text-indigo-600\" />\n            <h3 className=\"text-lg font-semibold text-gray-900\">AI Insights</h3>\n          </div>\n        </div>\n        <div className=\"mt-4 space-y-3\">\n          <div className=\"h-4 w-3/4 animate-pulse rounded bg-gray-200\" />\n          <div className=\"h-4 w-full animate-pulse rounded bg-gray-200\" />\n          <div className=\"h-4 w-5/6 animate-pulse rounded bg-gray-200\" />\n        </div>\n      </div>\n    );\n  }\n\n  // Error state\n  if (loadingState === \"error\") {\n    return (\n      <div className=\"h-full rounded-lg bg-white p-4 shadow\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <Brain className=\"h-5 w-5 text-indigo-600\" />\n            <h3 className=\"text-lg font-semibold text-gray-900\">AI Insights</h3>\n          </div>\n          <button\n            onClick={handleRefresh}\n            className=\"rounded p-1 text-gray-400 transition-colors hover:bg-gray-100 hover:text-gray-600\"\n            title=\"Retry\"\n            aria-label=\"Retry loading insights\"\n          >\n            <RefreshCw className=\"h-4 w-4\" />\n          </button>\n        </div>\n        <div className=\"mt-4 flex flex-col items-center justify-center py-8\">\n          <AlertCircle className=\"h-8 w-8 text-red-500\" />\n          <p className=\"mt-2 text-center text-sm text-red-600\">{error}</p>\n          <button\n            onClick={handleRefresh}\n            className=\"mt-4 rounded-md bg-red-50 px-4 py-2 text-sm font-medium text-red-700 transition-colors hover:bg-red-100\"\n          >\n            Try Again\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  // Success state with insight data\n  const confidenceDisplay = insight\n    ? getConfidenceDisplay(insight.confidence)\n    : { text: \"N/A\", color: \"text-gray-500\" };\n\n  return (\n    <div className=\"flex h-full flex-col rounded-lg bg-white p-4 shadow\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center gap-2\">\n          <Brain className=\"h-5 w-5 text-indigo-600\" />\n          <h3 className=\"text-lg font-semibold text-gray-900\">AI Insights</h3>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          {insight?.cached && (\n            <span className=\"rounded-full bg-gray-100 px-2 py-0.5 text-xs text-gray-500\">\n              Cached\n            </span>\n          )}\n          <button\n            onClick={handleRefresh}\n            disabled={loadingState === \"loading\"}\n            className=\"rounded p-1 text-gray-400 transition-colors hover:bg-gray-100 hover:text-gray-600 disabled:cursor-not-allowed disabled:opacity-50\"\n            title=\"Refresh insights\"\n            aria-label=\"Refresh insights\"\n          >\n            <RefreshCw\n              className={`h-4 w-4 ${loadingState === \"loading\" ? \"animate-spin\" : \"\"}`}\n            />\n          </button>\n        </div>\n      </div>\n\n      {/* Content */}\n      <div className=\"mt-4 flex-1 space-y-4 overflow-y-auto\">\n        {/* Summary Section */}\n        <div className=\"rounded-lg bg-indigo-50 p-3\">\n          <div className=\"mb-1 flex items-center gap-1.5\">\n            <Lightbulb className=\"h-4 w-4 text-indigo-600\" />\n            <span className=\"text-xs font-medium uppercase text-indigo-700\">\n              Summary\n            </span>\n          </div>\n          <p className=\"text-sm text-gray-700\">\n            {insight?.summary || \"No summary available\"}\n          </p>\n        </div>\n\n        {/* Business Impact Section */}\n        <div className=\"rounded-lg bg-amber-50 p-3\">\n          <div className=\"mb-1 flex items-center gap-1.5\">\n            <TrendingUp className=\"h-4 w-4 text-amber-600\" />\n            <span className=\"text-xs font-medium uppercase text-amber-700\">\n              Business Impact\n            </span>\n          </div>\n          <p className=\"text-sm text-gray-700\">\n            {insight?.business_impact || \"No business impact analysis available\"}\n          </p>\n        </div>\n\n        {/* Recommended Action Section */}\n        <div className=\"rounded-lg bg-green-50 p-3\">\n          <div className=\"mb-1 flex items-center gap-1.5\">\n            <CheckCircle className=\"h-4 w-4 text-green-600\" />\n            <span className=\"text-xs font-medium uppercase text-green-700\">\n              Recommended Action\n            </span>\n          </div>\n          <p className=\"text-sm text-gray-700\">\n            {insight?.recommended_action || \"No recommendation available\"}\n          </p>\n        </div>\n      </div>\n\n      {/* Footer with metadata */}\n      <div className=\"mt-4 flex items-center justify-between border-t border-gray-100 pt-3 text-xs text-gray-500\">\n        <div className=\"flex items-center gap-4\">\n          <span>\n            Confidence:{\" \"}\n            <span className={`font-medium ${confidenceDisplay.color}`}>\n              {confidenceDisplay.text}\n            </span>\n          </span>\n          {insight?.model_used && (\n            <span>\n              Model:{\" \"}\n              <span className=\"font-medium text-gray-700\">\n                {insight.model_used}\n              </span>\n            </span>\n          )}\n        </div>\n        {insight?.generated_at && (\n          <span title={insight.generated_at}>\n            {formatTimestamp(insight.generated_at)}\n          </span>\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport default InsightWidget;\n",
        "last_modified": "2026-01-03T19:10:12.020444"
      },
      "task_intent": {
        "title": "054-extract-duplicated-loadingstate-and-api-config-in-",
        "description": "The analytics-dashboard has 4 widget components (PredictionWidget, AnomalyWidget, InsightWidget, QueryInterface) that each independently define the same LoadingState type and API_BASE_URL constant. This pattern is repeated across 7+ files when including tests, leading to maintenance burden and potential inconsistencies.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-03T18:35:24.589600",
  "last_updated": "2026-01-03T18:35:24.591770"
}