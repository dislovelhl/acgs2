{
  "file_path": "acgs2-core/services/core/constraint_generation_system/language_constraints.py",
  "main_branch_history": [],
  "task_views": {
    "056-reduce-excessive-any-type-usage-in-python-codebase": {
      "task_id": "056-reduce-excessive-any-type-usage-in-python-codebase",
      "branch_point": {
        "commit_hash": "fc6e42927298263034acf989773f3200e422ad17",
        "content": "\"\"\"Constitutional Hash: cdd01ef066bc6cf2\nACGS-2 Language Constraints\n\u4e3a\u4e0d\u540c\u7f16\u7a0b\u8bed\u8a00\u5b9a\u4e49CFG\u548cJSON Schema\u7ea6\u675f\n\"\"\"\n\nimport logging\nfrom typing import Any, Dict\n\nlogger = logging.getLogger(__name__)\n\n\nclass LanguageConstraints:\n    \"\"\"\n    \u8bed\u8a00\u7ea6\u675f\u7ba1\u7406\u5668 - \u4e3a\u6bcf\u79cd\u7f16\u7a0b\u8bed\u8a00\u5b9a\u4e49\u8bed\u6cd5\u7ea6\u675f\n    \"\"\"\n\n    def __init__(self):\n        \"\"\"\u521d\u59cb\u5316\u8bed\u8a00\u7ea6\u675f\"\"\"\n        self.constraints = {}\n        self._load_base_constraints()\n\n    def _load_base_constraints(self):\n        \"\"\"\u52a0\u8f7d\u57fa\u7840\u8bed\u8a00\u7ea6\u675f\"\"\"\n        # Python\u7ea6\u675f\n        self.constraints[\"python\"] = {\n            \"language\": \"python\",\n            \"file_extension\": \".py\",\n            \"indent_style\": \"spaces\",\n            \"indent_size\": 4,\n            \"max_line_length\": 79,\n            \"grammar_rules\": self._get_python_grammar(),\n            \"json_schema\": self._get_python_schema(),\n            \"syntax_patterns\": [\n                r\"^def\\s+\\w+\\s*\\([^)]*\\)\\s*:\",\n                r\"^class\\s+\\w+.*:\",\n                r\"^if\\s+.*:\",\n                r\"^for\\s+.*:\",\n                r\"^while\\s+.*:\",\n                r\"^try\\s*:\",\n                r\"^except\\s+.*:\",\n                r\"^with\\s+.*:\",\n            ],\n            \"forbidden_patterns\": [\n                r\"^\\s*except\\s*:\",  # \u7a7a\u7684except\u5757\n                r\"^\\s*pass\\s*$\",  # \u5b64\u7acb\u7684pass\n            ],\n        }\n\n        # JavaScript\u7ea6\u675f\n        self.constraints[\"javascript\"] = {\n            \"language\": \"javascript\",\n            \"file_extension\": \".js\",\n            \"indent_style\": \"spaces\",\n            \"indent_size\": 2,\n            \"max_line_length\": 80,\n            \"grammar_rules\": self._get_javascript_grammar(),\n            \"json_schema\": self._get_javascript_schema(),\n            \"syntax_patterns\": [\n                r\"^function\\s+\\w+\\s*\\([^)]*\\)\\s*{\",\n                r\"^const\\s+\\w+\\s*=\",\n                r\"^let\\s+\\w+\\s*=\",\n                r\"^var\\s+\\w+\\s*=\",\n                r\"^if\\s*\\([^)]*\\)\\s*{\",\n                r\"^for\\s*\\([^)]*\\)\\s*{\",\n                r\"^while\\s*\\([^)]*\\)\\s*{\",\n                r\"^try\\s*{\",\n                r\"^catch\\s*\\([^)]*\\)\\s*{\",\n            ],\n            \"forbidden_patterns\": [\n                r\"^\\s*}\\s*$\",  # \u5b64\u7acb\u7684\u5927\u62ec\u53f7\n                r\"console\\.log\\s*\\([^)]*$\",  # \u672a\u95ed\u5408\u7684console.log\n            ],\n        }\n\n        # TypeScript\u7ea6\u675f\uff08\u7ee7\u627fJavaScript\uff09\n        self.constraints[\"typescript\"] = self.constraints[\"javascript\"].copy()\n        self.constraints[\"typescript\"].update(\n            {\n                \"language\": \"typescript\",\n                \"file_extension\": \".ts\",\n                \"type_annotations\": True,\n                \"interface_support\": True,\n            }\n        )\n\n        # Java\u7ea6\u675f\n        self.constraints[\"java\"] = {\n            \"language\": \"java\",\n            \"file_extension\": \".java\",\n            \"indent_style\": \"spaces\",\n            \"indent_size\": 4,\n            \"max_line_length\": 100,\n            \"grammar_rules\": self._get_java_grammar(),\n            \"json_schema\": self._get_java_schema(),\n            \"syntax_patterns\": [\n                r\"^public\\s+class\\s+\\w+\",\n                r\"^public\\s+static\\s+void\\s+main\",\n                r\"^public\\s+\\w+\\s+\\w+\\s*\\([^)]*\\)\\s*{\",\n                r\"^if\\s*\\([^)]*\\)\\s*{\",\n                r\"^for\\s*\\([^)]*\\)\\s*{\",\n                r\"^while\\s*\\([^)]*\\)\\s*{\",\n                r\"^try\\s*{\",\n                r\"^catch\\s*\\([^)]*\\)\\s*{\",\n            ],\n            \"forbidden_patterns\": [\n                r\"^\\s*}\\s*$\",  # \u5b64\u7acb\u7684\u5927\u62ec\u53f7\n                r\"System\\.out\\.println\\s*\\([^)]*$\",  # \u672a\u95ed\u5408\u7684println\n            ],\n        }\n\n        # C++\u7ea6\u675f\n        self.constraints[\"cpp\"] = {\n            \"language\": \"cpp\",\n            \"file_extension\": \".cpp\",\n            \"indent_style\": \"spaces\",\n            \"indent_size\": 4,\n            \"max_line_length\": 100,\n            \"grammar_rules\": self._get_cpp_grammar(),\n            \"json_schema\": self._get_cpp_schema(),\n            \"syntax_patterns\": [\n                r\"#include\\s*<.*>\",\n                r\"int\\s+main\\s*\\([^)]*\\)\\s*{\",\n                r\"void\\s+\\w+\\s*\\([^)]*\\)\\s*{\",\n                r\"class\\s+\\w+\\s*{\",\n                r\"if\\s*\\([^)]*\\)\\s*{\",\n                r\"for\\s*\\([^)]*\\)\\s*{\",\n                r\"while\\s*\\([^)]*\\)\\s*{\",\n                r\"try\\s*{\",\n                r\"catch\\s*\\([^)]*\\)\\s*{\",\n            ],\n            \"forbidden_patterns\": [\n                r\"^\\s*}\\s*$\",  # \u5b64\u7acb\u7684\u5927\u62ec\u53f7\n                r\"std::cout\\s*<<\\s*[^;]*$\",  # \u672a\u7ed3\u675f\u7684cout\n            ],\n        }\n\n        # Go\u7ea6\u675f\n        self.constraints[\"go\"] = {\n            \"language\": \"go\",\n            \"file_extension\": \".go\",\n            \"indent_style\": \"tabs\",\n            \"indent_size\": 1,\n            \"max_line_length\": 100,\n            \"grammar_rules\": self._get_go_grammar(),\n            \"json_schema\": self._get_go_schema(),\n            \"syntax_patterns\": [\n                r\"package\\s+\\w+\",\n                r\"import\\s*\\(\",\n                r\"func\\s+\\w+\\s*\\([^)]*\\)\\s*{\",\n                r\"if\\s+.*{\",\n                r\"for\\s+.*{\",\n                r\"switch\\s+.*{\",\n                r\"type\\s+\\w+\\s+struct\\s*{\",\n            ],\n            \"forbidden_patterns\": [\n                r\"^\\s*}\\s*$\",  # \u5b64\u7acb\u7684\u5927\u62ec\u53f7\n                r\"fmt\\.Printf?\\s*\\([^)]*$\",  # \u672a\u95ed\u5408\u7684fmt.Print\n            ],\n        }\n\n    def get_constraints(self, language: str) -> Dict[str, Any]:\n        \"\"\"\n        \u83b7\u53d6\u6307\u5b9a\u8bed\u8a00\u7684\u7ea6\u675f\n\n        Args:\n            language: \u7f16\u7a0b\u8bed\u8a00\u540d\u79f0\n\n        Returns:\n            \u8bed\u8a00\u7ea6\u675f\u5b57\u5178\n        \"\"\"\n        language = language.lower()\n        if language in self.constraints:\n            return self.constraints[language].copy()\n        else:\n            logger.warning(f\"No constraints defined for language: {language}\")\n            return self._get_default_constraints(language)\n\n    def _get_default_constraints(self, language: str) -> Dict[str, Any]:\n        \"\"\"\u83b7\u53d6\u9ed8\u8ba4\u7ea6\u675f\"\"\"\n        return {\n            \"language\": language,\n            \"file_extension\": f\".{language}\",\n            \"indent_style\": \"spaces\",\n            \"indent_size\": 4,\n            \"max_line_length\": 80,\n            \"syntax_patterns\": [],\n            \"forbidden_patterns\": [],\n        }\n\n    def _get_python_grammar(self) -> str:\n        \"\"\"Python CFG\u8bed\u6cd5\"\"\"\n        return r\"\"\"\n        start: statement+\n\n        statement: simple_statement | compound_statement\n        simple_statement: assignment | expression | pass_statement | return_statement\n        compound_statement: if_statement | for_statement | while_statement | try_statement | with_statement | def_statement | class_statement\n\n        assignment: NAME \"=\" expression\n        expression: NAME | NUMBER | STRING | call | binary_expr\n        call: NAME \"(\" arguments? \")\"\n        arguments: expression (\",\" expression)*\n\n        if_statement: \"if\" expression \":\" suite (\"elif\" expression \":\" suite)* (\"else\" \":\" suite)?\n        for_statement: \"for\" NAME \"in\" expression \":\" suite\n        while_statement: \"while\" expression \":\" suite\n        try_statement: \"try\" \":\" suite (\"except\" expression? \":\" suite)+ (\"finally\" \":\" suite)?\n        with_statement: \"with\" expression (\"as\" NAME)? \":\" suite\n        def_statement: \"def\" NAME \"(\" parameters? \")\" \":\" suite\n        class_statement: \"class\" NAME \":\" suite\n\n        parameters: NAME (\",\" NAME)*\n        suite: NEWLINE INDENT statement+ DEDENT\n\n        NAME: /[a-zA-Z_][a-zA-Z0-9_]*/\n        NUMBER: /\\d+/\n        STRING: /\"[^\"]*\"|'[^']*'/\n        NEWLINE: /\\n/\n        INDENT: /[ \\t]+/\n        DEDENT: //\n        \"\"\"\n\n    def _get_python_schema(self) -> Dict[str, Any]:\n        \"\"\"Python JSON Schema\"\"\"\n        return {\n            \"type\": \"object\",\n            \"properties\": {\n                \"code\": {\n                    \"type\": \"string\",\n                    \"description\": \"Python code that follows PEP 8 and is syntactically correct\",\n                },\n                \"functions\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"object\",\n                        \"properties\": {\n                            \"name\": {\"type\": \"string\"},\n                            \"parameters\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}},\n                            \"docstring\": {\"type\": \"string\"},\n                        },\n                    },\n                },\n                \"imports\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}},\n            },\n            \"required\": [\"code\"],\n        }\n\n    def _get_javascript_grammar(self) -> str:\n        \"\"\"JavaScript CFG\u8bed\u6cd5\"\"\"\n        return r\"\"\"\n        start: statement*\n\n        statement: var_declaration | function_declaration | if_statement | for_statement | expression_statement | block\n\n        var_declaration: (\"var\" | \"let\" | \"const\") NAME (\"=\" expression)? \";\"\n        function_declaration: \"function\" NAME \"(\" parameters? \")\" block\n        if_statement: \"if\" \"(\" expression \")\" statement (\"else\" statement)?\n        for_statement: \"for\" \"(\" var_declaration? \";\" expression? \";\" expression? \")\" statement\n        expression_statement: expression \";\"\n        block: \"{\" statement* \"}\"\n\n        expression: assignment | call | binary_expr | NAME | NUMBER | STRING\n        assignment: NAME \"=\" expression\n        call: NAME \"(\" arguments? \")\"\n        arguments: expression (\",\" expression)*\n        binary_expr: expression (\"+\" | \"-\" | \"*\" | \"/\") expression\n\n        parameters: NAME (\",\" NAME)*\n        NAME: /[a-zA-Z_$][a-zA-Z0-9_$]*/\n        NUMBER: /\\d+/\n        STRING: /\"[^\"]*\"|'[^']*'/\n        \"\"\"\n\n    def _get_javascript_schema(self) -> Dict[str, Any]:\n        \"\"\"JavaScript JSON Schema\"\"\"\n        return {\n            \"type\": \"object\",\n            \"properties\": {\n                \"code\": {\n                    \"type\": \"string\",\n                    \"description\": \"JavaScript code that follows best practices\",\n                },\n                \"functions\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"object\",\n                        \"properties\": {\n                            \"name\": {\"type\": \"string\"},\n                            \"parameters\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}},\n                            \"async\": {\"type\": \"boolean\"},\n                        },\n                    },\n                },\n                \"variables\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}},\n            },\n            \"required\": [\"code\"],\n        }\n\n    def _get_java_grammar(self) -> str:\n        \"\"\"Java CFG\u8bed\u6cd5\"\"\"\n        return r\"\"\"\n        start: class_declaration*\n\n        class_declaration: \"public\" \"class\" NAME \"{\" class_body \"}\"\n        class_body: (field_declaration | method_declaration)*\n\n        field_declaration: (\"public\" | \"private\") type NAME \";\"\n        method_declaration: (\"public\" | \"private\") type NAME \"(\" parameters? \")\" block\n\n        type: \"int\" | \"String\" | \"void\" | NAME\n        parameters: parameter (\",\" parameter)*\n        parameter: type NAME\n\n        block: \"{\" statement* \"}\"\n        statement: var_declaration | if_statement | for_statement | return_statement | expression_statement\n        var_declaration: type NAME (\"=\" expression)? \";\"\n        if_statement: \"if\" \"(\" expression \")\" statement (\"else\" statement)?\n        for_statement: \"for\" \"(\" var_declaration expression \";\" expression \")\" statement\n        return_statement: \"return\" expression? \";\"\n        expression_statement: expression \";\"\n\n        expression: assignment | call | binary_expr | NAME | NUMBER | STRING\n        assignment: NAME \"=\" expression\n        call: NAME \"(\" arguments? \")\"\n        arguments: expression (\",\" expression)*\n        binary_expr: expression (\"+\" | \"-\" | \"*\" | \"/\") expression\n\n        NAME: /[a-zA-Z_][a-zA-Z0-9_]*/\n        NUMBER: /\\d+/\n        STRING: /\"[^\"]*\"|'[^']*'/\n        \"\"\"\n\n    def _get_java_schema(self) -> Dict[str, Any]:\n        \"\"\"Java JSON Schema\"\"\"\n        return {\n            \"type\": \"object\",\n            \"properties\": {\n                \"code\": {\n                    \"type\": \"string\",\n                    \"description\": \"Java code that follows Java conventions\",\n                },\n                \"class_name\": {\"type\": \"string\"},\n                \"methods\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"object\",\n                        \"properties\": {\n                            \"name\": {\"type\": \"string\"},\n                            \"return_type\": {\"type\": \"string\"},\n                            \"parameters\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}},\n                        },\n                    },\n                },\n            },\n            \"required\": [\"code\", \"class_name\"],\n        }\n\n    def _get_cpp_grammar(self) -> str:\n        \"\"\"C++ CFG\u8bed\u6cd5\"\"\"\n        return r\"\"\"\n        start: (include_directive | function_definition | class_definition)*\n\n        include_directive: \"#include\" (\"<\" NAME \">\" | \"\\\"\" NAME \"\\\"\")\n        function_definition: type NAME \"(\" parameters? \")\" block\n        class_definition: \"class\" NAME \"{\" class_body \"}\" \";\"\n\n        class_body: (access_specifier \":\" member_declaration*)*\n        access_specifier: \"public\" | \"private\" | \"protected\"\n        member_declaration: field_declaration | method_declaration\n\n        type: \"int\" | \"void\" | \"string\" | NAME\n        parameters: parameter (\",\" parameter)*\n        parameter: type NAME\n\n        field_declaration: type NAME \";\"\n        method_declaration: type NAME \"(\" parameters? \")\" block\n\n        block: \"{\" statement* \"}\"\n        statement: var_declaration | if_statement | for_statement | return_statement | expression_statement\n        var_declaration: type NAME (\"=\" expression)? \";\"\n        if_statement: \"if\" \"(\" expression \")\" statement (\"else\" statement)?\n        for_statement: \"for\" \"(\" var_declaration expression \";\" expression \")\" statement\n        return_statement: \"return\" expression? \";\"\n        expression_statement: expression \";\"\n\n        expression: assignment | call | binary_expr | NAME | NUMBER | STRING\n        assignment: NAME \"=\" expression\n        call: NAME \"(\" arguments? \")\"\n        arguments: expression (\",\" expression)*\n        binary_expr: expression (\"+\" | \"-\" | \"*\" | \"/\") expression\n\n        NAME: /[a-zA-Z_][a-zA-Z0-9_]*/\n        NUMBER: /\\d+/\n        STRING: /\"[^\"]*\"|'[^']*'/\n        \"\"\"\n\n    def _get_cpp_schema(self) -> Dict[str, Any]:\n        \"\"\"C++ JSON Schema\"\"\"\n        return {\n            \"type\": \"object\",\n            \"properties\": {\n                \"code\": {\n                    \"type\": \"string\",\n                    \"description\": \"C++ code that follows C++ best practices\",\n                },\n                \"includes\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}},\n                \"functions\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"object\",\n                        \"properties\": {\n                            \"name\": {\"type\": \"string\"},\n                            \"return_type\": {\"type\": \"string\"},\n                            \"parameters\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}},\n                        },\n                    },\n                },\n            },\n            \"required\": [\"code\"],\n        }\n\n    def _get_go_grammar(self) -> str:\n        \"\"\"Go CFG\u8bed\u6cd5\"\"\"\n        return r\"\"\"\n        start: package_declaration import_declaration* (function_declaration | type_declaration)*\n\n        package_declaration: \"package\" NAME\n        import_declaration: \"import\" (\"(\" STRING+ \")\" | STRING)\n\n        function_declaration: \"func\" NAME \"(\" parameters? \")\" (type)? block\n        type_declaration: \"type\" NAME type_spec\n        type_spec: \"struct\" \"{\" field_declaration* \"}\" | \"interface\" \"{\" method_spec* \"}\"\n\n        field_declaration: NAME type\n        method_spec: NAME \"(\" parameters? \")\" type\n\n        type: \"int\" | \"string\" | \"bool\" | NAME\n        parameters: parameter (\",\" parameter)*\n        parameter: NAME type\n\n        block: \"{\" statement* \"}\"\n        statement: var_declaration | if_statement | for_statement | return_statement | expression_statement\n        var_declaration: (\"var\" NAME type (\"=\" expression)? | NAME \":=\" expression)\n        if_statement: \"if\" expression block (\"else\" (if_statement | block))?\n        for_statement: \"for\" expression? block\n        return_statement: \"return\" expression?\n        expression_statement: expression\n\n        expression: assignment | call | binary_expr | NAME | NUMBER | STRING\n        assignment: NAME \"=\" expression\n        call: NAME \"(\" arguments? \")\"\n        arguments: expression (\",\" expression)*\n        binary_expr: expression (\"+\" | \"-\" | \"*\" | \"/\") expression\n\n        NAME: /[a-zA-Z_][a-zA-Z0-9_]*/\n        NUMBER: /\\d+/\n        STRING: /\"[^\"]*\"|'[^']*'/\n        \"\"\"\n\n    def _get_go_schema(self) -> Dict[str, Any]:\n        \"\"\"Go JSON Schema\"\"\"\n        return {\n            \"type\": \"object\",\n            \"properties\": {\n                \"code\": {\"type\": \"string\", \"description\": \"Go code that follows Go conventions\"},\n                \"package\": {\"type\": \"string\"},\n                \"imports\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}},\n                \"functions\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"object\",\n                        \"properties\": {\n                            \"name\": {\"type\": \"string\"},\n                            \"parameters\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}},\n                            \"return_type\": {\"type\": \"string\"},\n                        },\n                    },\n                },\n            },\n            \"required\": [\"code\", \"package\"],\n        }\n\n    def add_custom_constraint(self, language: str, constraint_name: str, constraint_value: Any):\n        \"\"\"\n        \u6dfb\u52a0\u81ea\u5b9a\u4e49\u7ea6\u675f\n\n        Args:\n            language: \u7f16\u7a0b\u8bed\u8a00\n            constraint_name: \u7ea6\u675f\u540d\u79f0\n            constraint_value: \u7ea6\u675f\u503c\n        \"\"\"\n        language = language.lower()\n        if language not in self.constraints:\n            self.constraints[language] = self._get_default_constraints(language)\n\n        self.constraints[language][constraint_name] = constraint_value\n        logger.info(f\"Added custom constraint {constraint_name} for {language}\")\n\n    def update_constraint(self, language: str, constraint_name: str, constraint_value: Any):\n        \"\"\"\n        \u66f4\u65b0\u73b0\u6709\u7ea6\u675f\n\n        Args:\n            language: \u7f16\u7a0b\u8bed\u8a00\n            constraint_name: \u7ea6\u675f\u540d\u79f0\n            constraint_value: \u7ea6\u675f\u503c\n        \"\"\"\n        language = language.lower()\n        if language in self.constraints:\n            self.constraints[language][constraint_name] = constraint_value\n            logger.info(f\"Updated constraint {constraint_name} for {language}\")\n        else:\n            logger.warning(f\"Language {language} not found, cannot update constraint\")\n",
        "timestamp": "2026-01-04T05:35:58.374613"
      },
      "worktree_state": null,
      "task_intent": {
        "title": "056-reduce-excessive-any-type-usage-in-python-codebase",
        "description": "Found 373 occurrences of ': Any' type annotations across 120+ Python files, with high concentrations in integration-service (16 occurrences), acgs2-core/breakthrough (79 occurrences), and acgs2-core/enhanced_agent_bus (50+ occurrences). Excessive use of 'Any' defeats the purpose of type hints and can mask type-related bugs.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-03T19:36:18.208925",
  "last_updated": "2026-01-04T05:35:58.623271"
}