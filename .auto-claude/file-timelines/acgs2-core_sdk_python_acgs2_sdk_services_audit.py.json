{
  "file_path": "acgs2-core/sdk/python/acgs2_sdk/services/audit.py",
  "main_branch_history": [],
  "task_views": {
    "056-reduce-excessive-any-type-usage-in-python-codebase": {
      "task_id": "056-reduce-excessive-any-type-usage-in-python-codebase",
      "branch_point": {
        "commit_hash": "fc6e42927298263034acf989773f3200e422ad17",
        "content": "\"\"\"\nACGS-2 Audit Service\nConstitutional Hash: cdd01ef066bc6cf2\n\"\"\"\n\nfrom datetime import UTC, datetime\nfrom typing import TYPE_CHECKING, Any\n\nfrom acgs2_sdk.constants import AUDIT_ENDPOINT, CONSTITUTIONAL_HASH\nfrom acgs2_sdk.models import (\n    AuditEvent,\n    EventCategory,\n    EventSeverity,\n    PaginatedResponse,\n    QueryAuditEventsRequest,\n)\n\nif TYPE_CHECKING:\n    from acgs2_sdk.client import ACGS2Client\n\n\nclass AuditService:\n    \"\"\"Service for audit logging and querying.\"\"\"\n\n    def __init__(self, client: \"ACGS2Client\") -> None:\n        self._client = client\n        self._base_path = AUDIT_ENDPOINT\n\n    async def record(\n        self,\n        category: EventCategory,\n        severity: EventSeverity,\n        action: str,\n        actor: str,\n        resource: str,\n        outcome: str,\n        resource_id: str | None = None,\n        details: dict[str, Any] | None = None,\n        correlation_id: str | None = None,\n    ) -> AuditEvent:\n        \"\"\"Record an audit event.\"\"\"\n        data = await self._client.post(\n            f\"{self._base_path}/events\",\n            json={\n                \"category\": category.value,\n                \"severity\": severity.value,\n                \"action\": action,\n                \"actor\": actor,\n                \"resource\": resource,\n                \"resourceId\": resource_id,\n                \"outcome\": outcome,\n                \"details\": details,\n                \"correlationId\": correlation_id,\n                \"timestamp\": datetime.now(UTC).isoformat(),\n                \"constitutionalHash\": CONSTITUTIONAL_HASH,\n            },\n        )\n        return AuditEvent.model_validate(data.get(\"data\", data))\n\n    async def record_batch(\n        self,\n        events: list[dict[str, Any]],\n    ) -> list[AuditEvent]:\n        \"\"\"Record multiple audit events.\"\"\"\n        prepared = [\n            {\n                **event,\n                \"timestamp\": datetime.now(UTC).isoformat(),\n                \"constitutionalHash\": CONSTITUTIONAL_HASH,\n            }\n            for event in events\n        ]\n        data = await self._client.post(\n            f\"{self._base_path}/events/batch\",\n            json={\"events\": prepared},\n        )\n        return [AuditEvent.model_validate(e) for e in data.get(\"data\", [])]\n\n    async def get_event(self, event_id: str) -> AuditEvent:\n        \"\"\"Get an audit event by ID.\"\"\"\n        data = await self._client.get(f\"{self._base_path}/events/{event_id}\")\n        return AuditEvent.model_validate(data.get(\"data\", data))\n\n    async def query_events(\n        self,\n        request: QueryAuditEventsRequest | None = None,\n        **kwargs: Any,\n    ) -> PaginatedResponse[AuditEvent]:\n        \"\"\"Query audit events.\"\"\"\n        params = request.model_dump(by_alias=True, exclude_none=True) if request else kwargs\n\n        data = await self._client.get(f\"{self._base_path}/events\", params=params)\n        response_data = data.get(\"data\", data)\n        return PaginatedResponse[AuditEvent](\n            data=[AuditEvent.model_validate(e) for e in response_data.get(\"data\", [])],\n            total=response_data.get(\"total\", 0),\n            page=response_data.get(\"page\", 1),\n            page_size=response_data.get(\"pageSize\", 50),\n            total_pages=response_data.get(\"totalPages\", 0),\n        )\n\n    async def search_events(\n        self,\n        query: str,\n        page: int = 1,\n        page_size: int = 50,\n    ) -> PaginatedResponse[AuditEvent]:\n        \"\"\"Search audit events.\"\"\"\n        data = await self._client.get(\n            f\"{self._base_path}/events/search\",\n            params={\"query\": query, \"page\": page, \"pageSize\": page_size},\n        )\n        response_data = data.get(\"data\", data)\n        return PaginatedResponse[AuditEvent](\n            data=[AuditEvent.model_validate(e) for e in response_data.get(\"data\", [])],\n            total=response_data.get(\"total\", 0),\n            page=response_data.get(\"page\", page),\n            page_size=response_data.get(\"pageSize\", page_size),\n            total_pages=response_data.get(\"totalPages\", 0),\n        )\n\n    async def get_trail(\n        self,\n        resource_type: str,\n        resource_id: str,\n    ) -> dict[str, Any]:\n        \"\"\"Get audit trail for a resource.\"\"\"\n        data = await self._client.get(f\"{self._base_path}/trails/{resource_type}/{resource_id}\")\n        return data.get(\"data\", data)\n\n    async def create_export(\n        self,\n        format: str = \"json\",\n        query: QueryAuditEventsRequest | None = None,\n    ) -> dict[str, Any]:\n        \"\"\"Create an export job.\"\"\"\n        payload: dict[str, Any] = {\n            \"format\": format,\n            \"constitutionalHash\": CONSTITUTIONAL_HASH,\n        }\n        if query:\n            payload[\"query\"] = query.model_dump(by_alias=True, exclude_none=True)\n\n        data = await self._client.post(f\"{self._base_path}/exports\", json=payload)\n        return data.get(\"data\", data)\n\n    async def get_export(self, export_id: str) -> dict[str, Any]:\n        \"\"\"Get export job status.\"\"\"\n        data = await self._client.get(f\"{self._base_path}/exports/{export_id}\")\n        return data.get(\"data\", data)\n\n    async def get_statistics(\n        self,\n        start_date: str | None = None,\n        end_date: str | None = None,\n        category: EventCategory | None = None,\n    ) -> dict[str, Any]:\n        \"\"\"Get audit statistics.\"\"\"\n        params: dict[str, Any] = {}\n        if start_date:\n            params[\"startDate\"] = start_date\n        if end_date:\n            params[\"endDate\"] = end_date\n        if category:\n            params[\"category\"] = category.value\n\n        data = await self._client.get(f\"{self._base_path}/statistics\", params=params)\n        return data.get(\"data\", data)\n\n    async def verify_integrity(\n        self,\n        start_date: str | None = None,\n        end_date: str | None = None,\n        event_ids: list[str] | None = None,\n    ) -> dict[str, Any]:\n        \"\"\"Verify audit event integrity.\"\"\"\n        data = await self._client.post(\n            f\"{self._base_path}/verify\",\n            json={\n                \"startDate\": start_date,\n                \"endDate\": end_date,\n                \"eventIds\": event_ids,\n                \"constitutionalHash\": CONSTITUTIONAL_HASH,\n            },\n        )\n        return data.get(\"data\", data)\n",
        "timestamp": "2026-01-04T05:35:58.374613"
      },
      "worktree_state": null,
      "task_intent": {
        "title": "056-reduce-excessive-any-type-usage-in-python-codebase",
        "description": "Found 373 occurrences of ': Any' type annotations across 120+ Python files, with high concentrations in integration-service (16 occurrences), acgs2-core/breakthrough (79 occurrences), and acgs2-core/enhanced_agent_bus (50+ occurrences). Excessive use of 'Any' defeats the purpose of type hints and can mask type-related bugs.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-03T19:36:18.238917",
  "last_updated": "2026-01-04T05:35:58.469200"
}