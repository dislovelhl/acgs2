{
  "name": "Rate Limiting Policy Template",
  "description": "Comprehensive rate limiting policy for API protection, DDoS mitigation, and fair resource usage. Includes tiered limits, burst handling, and dynamic throttling based on user behavior.",
  "category": "rate_limiting",
  "format": "json",
  "version": "1.0.0",
  "author": "ACGS-2 Team",
  "tags": ["rate-limiting", "api-security", "throttling", "ddos", "traffic-management"],
  "policy": {
    "name": "rate-limiting",
    "version": "1.0.0",
    "description": "Rate limiting governance policy",
    "rate_limits": {
      "tiers": {
        "anonymous": {
          "requests_per_minute": 30,
          "requests_per_hour": 500,
          "requests_per_day": 5000,
          "burst_limit": 10
        },
        "free": {
          "requests_per_minute": 60,
          "requests_per_hour": 1000,
          "requests_per_day": 10000,
          "burst_limit": 20
        },
        "basic": {
          "requests_per_minute": 120,
          "requests_per_hour": 5000,
          "requests_per_day": 50000,
          "burst_limit": 50
        },
        "premium": {
          "requests_per_minute": 300,
          "requests_per_hour": 15000,
          "requests_per_day": 150000,
          "burst_limit": 100
        },
        "enterprise": {
          "requests_per_minute": 1000,
          "requests_per_hour": 50000,
          "requests_per_day": 500000,
          "burst_limit": 500
        }
      },
      "endpoint_overrides": {
        "/api/v1/auth/login": {"requests_per_minute": 10, "burst_limit": 3},
        "/api/v1/auth/password-reset": {"requests_per_minute": 5, "burst_limit": 2},
        "/api/v1/search": {"requests_per_minute": 30, "burst_limit": 10},
        "/api/v1/export": {"requests_per_hour": 10, "burst_limit": 1}
      }
    },
    "rules": [
      {
        "id": "rate-001",
        "name": "tier-based-limiting",
        "description": "Apply rate limits based on user tier",
        "severity": "high",
        "condition": {
          "all": [
            {"field": "user.tier", "operator": "defined"},
            {"field": "request.count", "operator": "less_than", "value": "{{tier.requests_per_minute}}"}
          ]
        },
        "action": "allow",
        "fallback": "throttle"
      },
      {
        "id": "rate-002",
        "name": "burst-protection",
        "description": "Handle burst traffic with token bucket algorithm",
        "severity": "high",
        "condition": {
          "all": [
            {"field": "request.burst_count", "operator": "less_than", "value": "{{tier.burst_limit}}"},
            {"field": "bucket.tokens", "operator": "greater_than", "value": 0}
          ]
        },
        "action": "allow",
        "algorithm": "token_bucket",
        "fallback": "queue_or_reject"
      },
      {
        "id": "rate-003",
        "name": "ip-based-limiting",
        "description": "Apply IP-based rate limiting for unauthenticated requests",
        "severity": "high",
        "condition": {
          "all": [
            {"field": "user.authenticated", "operator": "equals", "value": false},
            {"field": "ip.request_count_minute", "operator": "less_than", "value": 30}
          ]
        },
        "action": "allow",
        "fallback": "throttle"
      },
      {
        "id": "rate-004",
        "name": "endpoint-specific-limits",
        "description": "Apply stricter limits to sensitive endpoints",
        "severity": "critical",
        "condition": {
          "all": [
            {"field": "request.endpoint", "operator": "in", "value": "{{sensitive_endpoints}}"},
            {"field": "request.count", "operator": "less_than", "value": "{{endpoint.requests_per_minute}}"}
          ]
        },
        "action": "allow",
        "fallback": "deny"
      },
      {
        "id": "rate-005",
        "name": "ddos-detection",
        "description": "Detect and mitigate potential DDoS attacks",
        "severity": "critical",
        "condition": {
          "any": [
            {"field": "ip.requests_per_second", "operator": "greater_than", "value": 100},
            {"field": "user_agent.suspicious", "operator": "equals", "value": true},
            {"field": "request.pattern", "operator": "matches", "value": "{{ddos_patterns}}"}
          ]
        },
        "action": "block",
        "duration": "15_minutes",
        "notify": ["security_team"]
      },
      {
        "id": "rate-006",
        "name": "graceful-degradation",
        "description": "Implement graceful degradation under high load",
        "severity": "medium",
        "condition": {
          "all": [
            {"field": "system.load", "operator": "greater_than", "value": 80},
            {"field": "user.tier", "operator": "in", "value": ["anonymous", "free"]}
          ]
        },
        "action": "throttle",
        "reduce_limit_by": "50%",
        "message": "System under high load, reduced rate limits in effect"
      },
      {
        "id": "rate-007",
        "name": "retry-after-header",
        "description": "Include Retry-After header in rate limit responses",
        "severity": "low",
        "condition": {
          "all": [
            {"field": "response.status", "operator": "equals", "value": 429}
          ]
        },
        "action": "add_header",
        "headers": {
          "Retry-After": "{{calculated_retry_seconds}}",
          "X-RateLimit-Limit": "{{tier.requests_per_minute}}",
          "X-RateLimit-Remaining": "{{remaining_requests}}",
          "X-RateLimit-Reset": "{{reset_timestamp}}"
        }
      },
      {
        "id": "rate-008",
        "name": "whitelist-bypass",
        "description": "Allow trusted IPs to bypass rate limiting",
        "severity": "medium",
        "condition": {
          "all": [
            {"field": "ip.address", "operator": "in", "value": "{{whitelisted_ips}}"},
            {"field": "request.signed", "operator": "equals", "value": true}
          ]
        },
        "action": "bypass",
        "audit": true
      }
    ],
    "response_handling": {
      "throttled_status_code": 429,
      "throttled_message": "Rate limit exceeded. Please slow down your requests.",
      "include_headers": true,
      "queue_requests": false,
      "queue_timeout_seconds": 30
    },
    "metadata": {
      "algorithm": "sliding_window_with_token_bucket",
      "storage": "redis",
      "distributed": true,
      "last_reviewed": "2024-01-15",
      "review_frequency": "monthly"
    }
  }
}
