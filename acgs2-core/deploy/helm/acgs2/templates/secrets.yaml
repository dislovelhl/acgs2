{{/*
Secrets for ACGS-2 Enterprise Configuration
*/}}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "acgs2.fullname" . }}-jwt-secret
  labels:
    {{- include "acgs2.labels" . | nindent 4 }}
type: Opaque
data:
  jwt-secret: {{ .Values.jwt.secret | default (include "acgs2.generatePassword" .) | b64enc | quote }}
---
{{- if .Values.postgresql.enabled }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "acgs2.fullname" . }}-db-secret
  labels:
    {{- include "acgs2.labels" . | nindent 4 }}
type: Opaque
data:
  database-url: {{ include "acgs2.databaseUrl" . | b64enc | quote }}
  username: {{ .Values.postgresql.auth.username | b64enc | quote }}
  password: {{ .Values.postgresql.auth.password | b64enc | quote }}
  database: {{ .Values.postgresql.auth.database | b64enc | quote }}
{{- else }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "acgs2.fullname" . }}-db-secret
  labels:
    {{- include "acgs2.labels" . | nindent 4 }}
type: Opaque
data:
  database-url: {{ .Values.externalDatabase.url | b64enc | quote }}
{{- end }}
---
{{- if .Values.redis.enabled }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "acgs2.fullname" . }}-redis-secret
  labels:
    {{- include "acgs2.labels" . | nindent 4 }}
type: Opaque
data:
  redis-url: {{ include "acgs2.redisUrl" . | b64enc | quote }}
  {{- if .Values.redis.auth.enabled }}
  password: {{ .Values.redis.auth.password | b64enc | quote }}
  {{- end }}
{{- else }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "acgs2.fullname" . }}-redis-secret
  labels:
    {{- include "acgs2.labels" . | nindent 4 }}
type: Opaque
data:
  redis-url: {{ .Values.externalRedis.url | b64enc | quote }}
{{- end }}
---
{{- if .Values.kafka.enabled }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "acgs2.fullname" . }}-kafka-secret
  labels:
    {{- include "acgs2.labels" . | nindent 4 }}
type: Opaque
data:
  bootstrap-servers: {{ include "acgs2.kafkaBootstrapServers" . | b64enc | quote }}
  {{- if .Values.kafka.auth.enabled }}
  username: {{ .Values.kafka.auth.clientId | b64enc | quote }}
  password: {{ .Values.kafka.auth.clientSecret | b64enc | quote }}
  {{- end }}
{{- else }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "acgs2.fullname" . }}-kafka-secret
  labels:
    {{- include "acgs2.labels" . | nindent 4 }}
type: Opaque
data:
  bootstrap-servers: {{ .Values.externalKafka.bootstrapServers | b64enc | quote }}
{{- end }}
---
{{/*
TLS Certificates Secret
*/}}
{{- if .Values.tls.enabled }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "acgs2.fullname" . }}-tls-certs
  labels:
    {{- include "acgs2.labels" . | nindent 4 }}
type: kubernetes.io/tls
data:
  tls.crt: {{ .Values.tls.crt | b64enc | quote }}
  tls.key: {{ .Values.tls.key | b64enc | quote }}
  {{- if .Values.tls.ca }}
  ca.crt: {{ .Values.tls.ca | b64enc | quote }}
  {{- end }}
{{- end }}
---
{{/*
SIEM Integration Secrets
*/}}
{{- if .Values.siem.enabled }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "acgs2.fullname" . }}-siem-secret
  labels:
    {{- include "acgs2.labels" . | nindent 4 }}
type: Opaque
data:
  {{- if .Values.siem.splunk.enabled }}
  splunk-hec-token: {{ .Values.siem.splunk.hecToken | b64enc | quote }}
  splunk-hec-url: {{ .Values.siem.splunk.hecUrl | b64enc | quote }}
  {{- end }}
  {{- if .Values.siem.datadog.enabled }}
  datadog-api-key: {{ .Values.siem.datadog.apiKey | b64enc | quote }}
  datadog-site: {{ .Values.siem.datadog.site | default "datadoghq.com" | b64enc | quote }}
  {{- end }}
  {{- if .Values.siem.elasticsearch.enabled }}
  elasticsearch-url: {{ .Values.siem.elasticsearch.url | b64enc | quote }}
  elasticsearch-username: {{ .Values.siem.elasticsearch.username | b64enc | quote }}
  elasticsearch-password: {{ .Values.siem.elasticsearch.password | b64enc | quote }}
  {{- end }}
{{- end }}
---
{{/*
Identity Provider Secrets
*/}}
{{- if .Values.identityProviders.enabled }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "acgs2.fullname" . }}-idp-secret
  labels:
    {{- include "acgs2.labels" . | nindent 4 }}
type: Opaque
data:
  {{- if .Values.identityProviders.okta.enabled }}
  okta-client-id: {{ .Values.identityProviders.okta.clientId | b64enc | quote }}
  okta-client-secret: {{ .Values.identityProviders.okta.clientSecret | b64enc | quote }}
  okta-domain: {{ .Values.identityProviders.okta.domain | b64enc | quote }}
  {{- end }}
  {{- if .Values.identityProviders.azure.enabled }}
  azure-client-id: {{ .Values.identityProviders.azure.clientId | b64enc | quote }}
  azure-client-secret: {{ .Values.identityProviders.azure.clientSecret | b64enc | quote }}
  azure-tenant-id: {{ .Values.identityProviders.azure.tenantId | b64enc | quote }}
  {{- end }}
{{- end }}
---
{{/*
Monitoring Secrets
*/}}
{{- if .Values.monitoring.enabled }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "acgs2.fullname" . }}-monitoring-secret
  labels:
    {{- include "acgs2.labels" . | nindent 4 }}
type: Opaque
data:
  {{- if .Values.monitoring.pagerduty.enabled }}
  pagerduty-integration-key: {{ .Values.monitoring.pagerduty.integrationKey | b64enc | quote }}
  {{- end }}
  {{- if .Values.monitoring.slack.enabled }}
  slack-webhook-url: {{ .Values.monitoring.slack.webhookUrl | b64enc | quote }}
  {{- end }}
  {{- if .Values.monitoring.opsgenie.enabled }}
  opsgenie-api-key: {{ .Values.monitoring.opsgenie.apiKey | b64enc | quote }}
  {{- end }}
{{- end }}
---
{{/*
Backup and Disaster Recovery Secrets
*/}}
{{- if .Values.backup.enabled }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "acgs2.fullname" . }}-backup-secret
  labels:
    {{- include "acgs2.labels" . | nindent 4 }}
type: Opaque
data:
  {{- if .Values.backup.s3.enabled }}
  s3-access-key: {{ .Values.backup.s3.accessKey | b64enc | quote }}
  s3-secret-key: {{ .Values.backup.s3.secretKey | b64enc | quote }}
  s3-region: {{ .Values.backup.s3.region | b64enc | quote }}
  {{- end }}
  {{- if .Values.backup.gcs.enabled }}
  gcs-service-account-key: {{ .Values.backup.gcs.serviceAccountKey | b64enc | quote }}
  {{- end }}
  {{- if .Values.backup.azure.enabled }}
  azure-storage-account: {{ .Values.backup.azure.storageAccount | b64enc | quote }}
  azure-storage-key: {{ .Values.backup.azure.storageKey | b64enc | quote }}
  {{- end }}
{{- end }}
