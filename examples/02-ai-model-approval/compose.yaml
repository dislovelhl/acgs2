# ACGS-2 Example 02: AI Model Approval Workflow
# OPA setup for AI model governance and approval workflows
# Constitutional Hash: cdd01ef066bc6cf2
#
# Usage: docker compose up -d
#
# This example provides a standalone OPA instance for learning
# AI model governance policies. For the full ACGS-2 stack, use the root compose.yaml.

services:
  # Open Policy Agent for AI model approval decisions
  opa:
    image: openpolicyagent/opa:latest
    command: run --server --log-level info --addr 0.0.0.0:8181 /policies
    ports:
      - "${OPA_PORT:-8181}:8181"
    volumes:
      - ./policies:/policies:ro
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:8181/health"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 5s
    networks:
      - example-network
    restart: unless-stopped

networks:
  example-network:
    driver: bridge

# =============================================================================
# Quick Reference
# =============================================================================
#
# Start OPA:
#   docker compose up -d
#
# Check health:
#   curl http://localhost:8181/health
#
# Query model approval:
#   curl -X POST http://localhost:8181/v1/data/ai/model/approval/allowed \
#     -H "Content-Type: application/json" \
#     -d '{"input": {"model": {"id": "test", "risk_score": 0.3}, "compliance": {"bias_tested": true, "documentation_complete": true, "security_reviewed": true}, "deployment": {"environment": "staging"}}}'
#
# Query risk category:
#   curl -X POST http://localhost:8181/v1/data/ai/model/risk/category \
#     -H "Content-Type: application/json" \
#     -d '{"input": {"model": {"risk_score": 0.65}}}'
#
# View logs:
#   docker compose logs -f opa
#
# Stop OPA:
#   docker compose down
#
# Port conflict? Use: OPA_PORT=8182 docker compose up -d
# =============================================================================
